{"ast":null,"code":"/**\n * WhatsApp Integration Service\n * Uses Twilio or Meta Cloud API for sending messages\n */\n\nimport { API_BASE_URL } from '../utils/constants';\nclass WhatsAppService {\n  constructor() {\n    // In production, these would be securely stored\n    this.twilioAccountSid = process.env.REACT_APP_TWILIO_ACCOUNT_SID;\n    this.twilioAuthToken = process.env.REACT_APP_TWILIO_AUTH_TOKEN;\n    this.twilioPhoneNumber = process.env.REACT_APP_TWILIO_PHONE_NUMBER;\n    this.metaAccessToken = process.env.REACT_APP_META_ACCESS_TOKEN;\n    this.metaPhoneNumberId = process.env.REACT_APP_META_PHONE_NUMBER_ID;\n\n    // Message templates for common operations\n    this.templates = {\n      leadGreeting: {\n        he: (leadName, property) => `×©×œ×•× ${leadName || ''} ðŸ‘‹\\n\\n×ª×•×“×” ×¢×œ ×”×”×ª×¢× ×™×™× ×•×ª ×‘-*${property}*.\\n×× ×™ ×›××Ÿ ×›×“×™ ×œ×¢×–×•×¨ ×¢× ×¤×¨×˜×™× ×•×–×ž×™× ×•×ª.\\n\\n×”×× ×ª×¨×¦×• ×©× ×‘×“×•×§ ×ª××¨×™×›×™× ×ž×•×¢×“×¤×™×?`,\n        en: (leadName, property) => `Hi ${leadName || ''} ðŸ‘‹\\n\\nThanks for your interest in *${property}*.\\nI can help with details and availability.\\n\\nWould you like me to check preferred dates?`,\n        el: (leadName, property) => `Î“ÎµÎ¹Î± ${leadName || ''} ðŸ‘‹\\n\\nÎ•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Î³Î¹Î± Ï„Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ ÏƒÎ±Ï‚ ÏƒÏ„Î¿ *${property}*.\\nÎœÏ€Î¿ÏÏŽ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÏ‰ Î¼Îµ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±.\\n\\nÎ˜Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎ»Î­Î³Î¾Ï‰ Ï€ÏÎ¿Ï„Î¹Î¼ÏŽÎ¼ÎµÎ½ÎµÏ‚ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚;`\n      },\n      towelRequest: {\n        he: room => `ðŸ¨ *×‘×§×©×” ×—×“×©×”*\\n\\n×ž×’×‘×•×ª × ×“×¨×©×•×ª ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“×`,\n        en: room => `ðŸ¨ *New Request*\\n\\nTowels needed in room *${room}*\\n\\nâ° Please handle ASAP`\n      },\n      cleaningRequest: {\n        he: room => `ðŸ§¹ *×‘×§×©×ª × ×™×§×™×•×Ÿ*\\n\\n× ×™×§×™×•×Ÿ × ×“×¨×© ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×ª×× ×¢× ×”×¦×•×•×ª`,\n        en: room => `ðŸ§¹ *Cleaning Request*\\n\\nCleaning needed in room *${room}*\\n\\nâ° Please coordinate with team`\n      },\n      maintenanceRequest: {\n        he: (room, issue) => `ðŸ”§ *×ª×—×–×•×§×”*\\n\\n×‘×¢×™×” ×‘×—×“×¨ *${room}*:\\n${issue}\\n\\nâš ï¸ ×“×—×™×¤×•×ª ×’×‘×•×”×”`,\n        en: (room, issue) => `ðŸ”§ *Maintenance*\\n\\nIssue in room *${room}*:\\n${issue}\\n\\nâš ï¸ High priority`\n      },\n      checkout: {\n        he: (room, guest) => `âœ… *×¦'×§-×××•×˜*\\n\\n×—×“×¨ *${room}* ×”×ª×¤× ×”\\n××•×¨×—: ${guest}\\n\\nðŸ§¹ × × ×œ×”×ª×—×™×œ ×‘× ×™×§×™×•×Ÿ`,\n        en: (room, guest) => `âœ… *Checkout*\\n\\nRoom *${room}* is now available\\nGuest: ${guest}\\n\\nðŸ§¹ Please begin cleaning`\n      },\n      taskAssignment: {\n        he: (task, room, deadline) => `ðŸ“‹ *×ž×©×™×ž×” ×—×“×©×”*\\n\\n${task}\\n×—×“×¨: *${room}*\\n×–×ž×Ÿ ×¡×™×•×: ${deadline}`,\n        en: (task, room, deadline) => `ðŸ“‹ *New Task*\\n\\n${task}\\nRoom: *${room}*\\nDeadline: ${deadline}`\n      },\n      urgentAlert: {\n        he: message => `ðŸš¨ *×”×ª×¨××” ×“×—×•×¤×”*\\n\\n${message}\\n\\nâš¡ × ×“×¨×©×ª ×¤×¢×•×œ×” ×ž×™×™×“×™×ª`,\n        en: message => `ðŸš¨ *Urgent Alert*\\n\\n${message}\\n\\nâš¡ Immediate action required`\n      }\n    };\n\n    // Staff contact list (in production, fetch from database)\n    this.staffContacts = [{\n      id: 1,\n      name: '×™×•×¡×™ - ×ž×©×§ ×‘×™×ª',\n      phone: '+972501234567',\n      department: 'housekeeping'\n    }, {\n      id: 2,\n      name: '×“× ×” - ×ª×—×–×•×§×”',\n      phone: '+972509876543',\n      department: 'maintenance'\n    }, {\n      id: 3,\n      name: '××‘×™ - ×§×‘×œ×”',\n      phone: '+972505555555',\n      department: 'reception'\n    }, {\n      id: 4,\n      name: '×ž×™×›×œ - ×©×™×¨×•×ª ×—×“×¨×™×',\n      phone: '+972503333333',\n      department: 'room_service'\n    }];\n  }\n  getAuthHeaders() {\n    try {\n      var _parsed$state, _parsed$state2;\n      const raw = localStorage.getItem('hotel-enterprise-storage');\n      if (!raw) return {};\n      const parsed = JSON.parse(raw);\n      const token = parsed === null || parsed === void 0 ? void 0 : (_parsed$state = parsed.state) === null || _parsed$state === void 0 ? void 0 : _parsed$state.authToken;\n      const tenantId = parsed === null || parsed === void 0 ? void 0 : (_parsed$state2 = parsed.state) === null || _parsed$state2 === void 0 ? void 0 : _parsed$state2.activeTenantId;\n      const headers = {};\n      if (token) headers.Authorization = `Bearer ${token}`;\n      if (tenantId) headers['X-Tenant-Id'] = tenantId;\n      return headers;\n    } catch (error) {\n      return {};\n    }\n  }\n\n  /**\n   * Send WhatsApp message via Twilio\n   */\n  async sendViaTwilio(to, message) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/send`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders()\n        },\n        body: JSON.stringify({\n          to,\n          message,\n          provider: 'twilio'\n        })\n      });\n      if (!response.ok) {\n        throw new Error('Failed to send WhatsApp message');\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Twilio send error:', error);\n      // Fallback to simulation for demo\n      return this.simulateSend(to, message);\n    }\n  }\n\n  /**\n   * Send WhatsApp message via Meta Cloud API\n   */\n  async sendViaMeta(to, message, templateName = null) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/send`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders()\n        },\n        body: JSON.stringify({\n          to,\n          message,\n          templateName,\n          provider: 'meta'\n        })\n      });\n      if (!response.ok) {\n        throw new Error('Failed to send WhatsApp message');\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Meta send error:', error);\n      // Fallback to simulation for demo\n      return this.simulateSend(to, message);\n    }\n  }\n\n  /**\n   * Simulate message sending for demo purposes\n   */\n  simulateSend(to, message) {\n    console.log(`[WhatsApp Simulation] Sending to ${to}:`, message);\n    return {\n      success: true,\n      messageId: `sim_${Date.now()}`,\n      to,\n      message,\n      timestamp: new Date().toISOString(),\n      status: 'delivered'\n    };\n  }\n\n  /**\n   * Send message to department\n   */\n  async sendToDepartment(department, message, lang = 'he') {\n    const staffMembers = this.staffContacts.filter(s => s.department === department);\n    if (staffMembers.length === 0) {\n      console.warn(`[WhatsApp] No staff found for department: ${department}`);\n      return [];\n    }\n    const results = await Promise.all(staffMembers.map(staff => this.sendViaTwilio(staff.phone, message)));\n    return results;\n  }\n\n  /**\n   * Send towel request notification\n   */\n  async notifyTowelRequest(room, lang = 'he') {\n    const message = this.templates.towelRequest[lang](room);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send cleaning request notification\n   */\n  async notifyCleaningRequest(room, lang = 'he') {\n    const message = this.templates.cleaningRequest[lang](room);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send maintenance request notification\n   */\n  async notifyMaintenanceRequest(room, issue, lang = 'he') {\n    const message = this.templates.maintenanceRequest[lang](room, issue);\n    return this.sendToDepartment('maintenance', message, lang);\n  }\n\n  /**\n   * Send checkout notification\n   */\n  async notifyCheckout(room, guestName, lang = 'he') {\n    const message = this.templates.checkout[lang](room, guestName);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send task assignment\n   */\n  async assignTask(staffId, task, room, deadline, lang = 'he') {\n    const staff = this.staffContacts.find(s => s.id === staffId);\n    if (!staff) {\n      throw new Error(`Staff member not found: ${staffId}`);\n    }\n    const message = this.templates.taskAssignment[lang](task, room, deadline);\n    return this.sendViaTwilio(staff.phone, message);\n  }\n\n  /**\n   * Send urgent alert to all staff\n   */\n  async sendUrgentAlert(alertMessage, lang = 'he') {\n    const message = this.templates.urgentAlert[lang](alertMessage);\n    const results = await Promise.all(this.staffContacts.map(staff => this.sendViaTwilio(staff.phone, message)));\n    return results;\n  }\n\n  /**\n   * Send personalized greeting to a lead\n   */\n  async sendLeadGreeting(lead, lang = 'he') {\n    if (!lead || !lead.phone) {\n      console.warn('[WhatsApp] Lead missing phone, skipping greeting');\n      return null;\n    }\n    const leadName = lead.contact || lead.name || '';\n    const propertyName = lead.property || lead.name || 'your property';\n    const template = this.templates.leadGreeting[lang] || this.templates.leadGreeting.en;\n    const message = template(leadName, propertyName);\n    return this.sendViaTwilio(lead.phone, message);\n  }\n\n  /**\n   * Get message delivery status\n   */\n  async getMessageStatus(messageId) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/status/${messageId}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders()\n        }\n      });\n      if (!response.ok) {\n        throw new Error('Failed to get message status');\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Status check error:', error);\n      return {\n        status: 'unknown',\n        messageId\n      };\n    }\n  }\n\n  /**\n   * Set up webhook for incoming messages\n   */\n  async setupWebhook(callbackUrl) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/webhook/setup`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders()\n        },\n        body: JSON.stringify({\n          callbackUrl\n        })\n      });\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Webhook setup error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Process incoming webhook message\n   */\n  processIncomingMessage(webhookData) {\n    // Parse incoming WhatsApp message\n    const {\n      from,\n      body,\n      timestamp,\n      type\n    } = webhookData;\n    return {\n      from,\n      message: body,\n      timestamp: new Date(timestamp).toISOString(),\n      type,\n      processed: true\n    };\n  }\n}\n\n// Singleton instance\nexport const whatsappService = new WhatsAppService();\nexport default whatsappService;","map":{"version":3,"names":["API_BASE_URL","WhatsAppService","constructor","twilioAccountSid","process","env","REACT_APP_TWILIO_ACCOUNT_SID","twilioAuthToken","REACT_APP_TWILIO_AUTH_TOKEN","twilioPhoneNumber","REACT_APP_TWILIO_PHONE_NUMBER","metaAccessToken","REACT_APP_META_ACCESS_TOKEN","metaPhoneNumberId","REACT_APP_META_PHONE_NUMBER_ID","templates","leadGreeting","he","leadName","property","en","el","towelRequest","room","cleaningRequest","maintenanceRequest","issue","checkout","guest","taskAssignment","task","deadline","urgentAlert","message","staffContacts","id","name","phone","department","getAuthHeaders","_parsed$state","_parsed$state2","raw","localStorage","getItem","parsed","JSON","parse","token","state","authToken","tenantId","activeTenantId","headers","Authorization","error","sendViaTwilio","to","response","fetch","method","body","stringify","provider","ok","Error","json","console","simulateSend","sendViaMeta","templateName","log","success","messageId","Date","now","timestamp","toISOString","status","sendToDepartment","lang","staffMembers","filter","s","length","warn","results","Promise","all","map","staff","notifyTowelRequest","notifyCleaningRequest","notifyMaintenanceRequest","notifyCheckout","guestName","assignTask","staffId","find","sendUrgentAlert","alertMessage","sendLeadGreeting","lead","contact","propertyName","template","getMessageStatus","setupWebhook","callbackUrl","processIncomingMessage","webhookData","from","type","processed","whatsappService"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/services/whatsapp.js"],"sourcesContent":["/**\n * WhatsApp Integration Service\n * Uses Twilio or Meta Cloud API for sending messages\n */\n\nimport { API_BASE_URL } from '../utils/constants';\n\nclass WhatsAppService {\n  constructor() {\n    // In production, these would be securely stored\n    this.twilioAccountSid = process.env.REACT_APP_TWILIO_ACCOUNT_SID;\n    this.twilioAuthToken = process.env.REACT_APP_TWILIO_AUTH_TOKEN;\n    this.twilioPhoneNumber = process.env.REACT_APP_TWILIO_PHONE_NUMBER;\n    this.metaAccessToken = process.env.REACT_APP_META_ACCESS_TOKEN;\n    this.metaPhoneNumberId = process.env.REACT_APP_META_PHONE_NUMBER_ID;\n    \n    // Message templates for common operations\n    this.templates = {\n      leadGreeting: {\n        he: (leadName, property) =>\n          `×©×œ×•× ${leadName || ''} ðŸ‘‹\\n\\n×ª×•×“×” ×¢×œ ×”×”×ª×¢× ×™×™× ×•×ª ×‘-*${property}*.\\n×× ×™ ×›××Ÿ ×›×“×™ ×œ×¢×–×•×¨ ×¢× ×¤×¨×˜×™× ×•×–×ž×™× ×•×ª.\\n\\n×”×× ×ª×¨×¦×• ×©× ×‘×“×•×§ ×ª××¨×™×›×™× ×ž×•×¢×“×¤×™×?`,\n        en: (leadName, property) =>\n          `Hi ${leadName || ''} ðŸ‘‹\\n\\nThanks for your interest in *${property}*.\\nI can help with details and availability.\\n\\nWould you like me to check preferred dates?`,\n        el: (leadName, property) =>\n          `Î“ÎµÎ¹Î± ${leadName || ''} ðŸ‘‹\\n\\nÎ•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Î³Î¹Î± Ï„Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ ÏƒÎ±Ï‚ ÏƒÏ„Î¿ *${property}*.\\nÎœÏ€Î¿ÏÏŽ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÏ‰ Î¼Îµ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±.\\n\\nÎ˜Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎ»Î­Î³Î¾Ï‰ Ï€ÏÎ¿Ï„Î¹Î¼ÏŽÎ¼ÎµÎ½ÎµÏ‚ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚;`,\n      },\n      towelRequest: {\n        he: (room) => `ðŸ¨ *×‘×§×©×” ×—×“×©×”*\\n\\n×ž×’×‘×•×ª × ×“×¨×©×•×ª ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“×`,\n        en: (room) => `ðŸ¨ *New Request*\\n\\nTowels needed in room *${room}*\\n\\nâ° Please handle ASAP`,\n      },\n      cleaningRequest: {\n        he: (room) => `ðŸ§¹ *×‘×§×©×ª × ×™×§×™×•×Ÿ*\\n\\n× ×™×§×™×•×Ÿ × ×“×¨×© ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×ª×× ×¢× ×”×¦×•×•×ª`,\n        en: (room) => `ðŸ§¹ *Cleaning Request*\\n\\nCleaning needed in room *${room}*\\n\\nâ° Please coordinate with team`,\n      },\n      maintenanceRequest: {\n        he: (room, issue) => `ðŸ”§ *×ª×—×–×•×§×”*\\n\\n×‘×¢×™×” ×‘×—×“×¨ *${room}*:\\n${issue}\\n\\nâš ï¸ ×“×—×™×¤×•×ª ×’×‘×•×”×”`,\n        en: (room, issue) => `ðŸ”§ *Maintenance*\\n\\nIssue in room *${room}*:\\n${issue}\\n\\nâš ï¸ High priority`,\n      },\n      checkout: {\n        he: (room, guest) => `âœ… *×¦'×§-×××•×˜*\\n\\n×—×“×¨ *${room}* ×”×ª×¤× ×”\\n××•×¨×—: ${guest}\\n\\nðŸ§¹ × × ×œ×”×ª×—×™×œ ×‘× ×™×§×™×•×Ÿ`,\n        en: (room, guest) => `âœ… *Checkout*\\n\\nRoom *${room}* is now available\\nGuest: ${guest}\\n\\nðŸ§¹ Please begin cleaning`,\n      },\n      taskAssignment: {\n        he: (task, room, deadline) => `ðŸ“‹ *×ž×©×™×ž×” ×—×“×©×”*\\n\\n${task}\\n×—×“×¨: *${room}*\\n×–×ž×Ÿ ×¡×™×•×: ${deadline}`,\n        en: (task, room, deadline) => `ðŸ“‹ *New Task*\\n\\n${task}\\nRoom: *${room}*\\nDeadline: ${deadline}`,\n      },\n      urgentAlert: {\n        he: (message) => `ðŸš¨ *×”×ª×¨××” ×“×—×•×¤×”*\\n\\n${message}\\n\\nâš¡ × ×“×¨×©×ª ×¤×¢×•×œ×” ×ž×™×™×“×™×ª`,\n        en: (message) => `ðŸš¨ *Urgent Alert*\\n\\n${message}\\n\\nâš¡ Immediate action required`,\n      },\n    };\n\n    // Staff contact list (in production, fetch from database)\n    this.staffContacts = [\n      { id: 1, name: '×™×•×¡×™ - ×ž×©×§ ×‘×™×ª', phone: '+972501234567', department: 'housekeeping' },\n      { id: 2, name: '×“× ×” - ×ª×—×–×•×§×”', phone: '+972509876543', department: 'maintenance' },\n      { id: 3, name: '××‘×™ - ×§×‘×œ×”', phone: '+972505555555', department: 'reception' },\n      { id: 4, name: '×ž×™×›×œ - ×©×™×¨×•×ª ×—×“×¨×™×', phone: '+972503333333', department: 'room_service' },\n    ];\n  }\n\n  getAuthHeaders() {\n    try {\n      const raw = localStorage.getItem('hotel-enterprise-storage');\n      if (!raw) return {};\n      const parsed = JSON.parse(raw);\n      const token = parsed?.state?.authToken;\n      const tenantId = parsed?.state?.activeTenantId;\n      const headers = {};\n      if (token) headers.Authorization = `Bearer ${token}`;\n      if (tenantId) headers['X-Tenant-Id'] = tenantId;\n      return headers;\n    } catch (error) {\n      return {};\n    }\n  }\n\n  /**\n   * Send WhatsApp message via Twilio\n   */\n  async sendViaTwilio(to, message) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/send`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n        body: JSON.stringify({\n          to,\n          message,\n          provider: 'twilio',\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send WhatsApp message');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Twilio send error:', error);\n      // Fallback to simulation for demo\n      return this.simulateSend(to, message);\n    }\n  }\n\n  /**\n   * Send WhatsApp message via Meta Cloud API\n   */\n  async sendViaMeta(to, message, templateName = null) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/send`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n        body: JSON.stringify({\n          to,\n          message,\n          templateName,\n          provider: 'meta',\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send WhatsApp message');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Meta send error:', error);\n      // Fallback to simulation for demo\n      return this.simulateSend(to, message);\n    }\n  }\n\n  /**\n   * Simulate message sending for demo purposes\n   */\n  simulateSend(to, message) {\n    console.log(`[WhatsApp Simulation] Sending to ${to}:`, message);\n    \n    return {\n      success: true,\n      messageId: `sim_${Date.now()}`,\n      to,\n      message,\n      timestamp: new Date().toISOString(),\n      status: 'delivered',\n    };\n  }\n\n  /**\n   * Send message to department\n   */\n  async sendToDepartment(department, message, lang = 'he') {\n    const staffMembers = this.staffContacts.filter((s) => s.department === department);\n    \n    if (staffMembers.length === 0) {\n      console.warn(`[WhatsApp] No staff found for department: ${department}`);\n      return [];\n    }\n\n    const results = await Promise.all(\n      staffMembers.map((staff) => this.sendViaTwilio(staff.phone, message))\n    );\n\n    return results;\n  }\n\n  /**\n   * Send towel request notification\n   */\n  async notifyTowelRequest(room, lang = 'he') {\n    const message = this.templates.towelRequest[lang](room);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send cleaning request notification\n   */\n  async notifyCleaningRequest(room, lang = 'he') {\n    const message = this.templates.cleaningRequest[lang](room);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send maintenance request notification\n   */\n  async notifyMaintenanceRequest(room, issue, lang = 'he') {\n    const message = this.templates.maintenanceRequest[lang](room, issue);\n    return this.sendToDepartment('maintenance', message, lang);\n  }\n\n  /**\n   * Send checkout notification\n   */\n  async notifyCheckout(room, guestName, lang = 'he') {\n    const message = this.templates.checkout[lang](room, guestName);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send task assignment\n   */\n  async assignTask(staffId, task, room, deadline, lang = 'he') {\n    const staff = this.staffContacts.find((s) => s.id === staffId);\n    if (!staff) {\n      throw new Error(`Staff member not found: ${staffId}`);\n    }\n\n    const message = this.templates.taskAssignment[lang](task, room, deadline);\n    return this.sendViaTwilio(staff.phone, message);\n  }\n\n  /**\n   * Send urgent alert to all staff\n   */\n  async sendUrgentAlert(alertMessage, lang = 'he') {\n    const message = this.templates.urgentAlert[lang](alertMessage);\n    \n    const results = await Promise.all(\n      this.staffContacts.map((staff) => this.sendViaTwilio(staff.phone, message))\n    );\n\n    return results;\n  }\n\n  /**\n   * Send personalized greeting to a lead\n   */\n  async sendLeadGreeting(lead, lang = 'he') {\n    if (!lead || !lead.phone) {\n      console.warn('[WhatsApp] Lead missing phone, skipping greeting');\n      return null;\n    }\n\n    const leadName = lead.contact || lead.name || '';\n    const propertyName = lead.property || lead.name || 'your property';\n    const template = this.templates.leadGreeting[lang] || this.templates.leadGreeting.en;\n    const message = template(leadName, propertyName);\n\n    return this.sendViaTwilio(lead.phone, message);\n  }\n\n  /**\n   * Get message delivery status\n   */\n  async getMessageStatus(messageId) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/status/${messageId}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to get message status');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Status check error:', error);\n      return { status: 'unknown', messageId };\n    }\n  }\n\n  /**\n   * Set up webhook for incoming messages\n   */\n  async setupWebhook(callbackUrl) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/webhook/setup`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n        body: JSON.stringify({ callbackUrl }),\n      });\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Webhook setup error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Process incoming webhook message\n   */\n  processIncomingMessage(webhookData) {\n    // Parse incoming WhatsApp message\n    const { from, body, timestamp, type } = webhookData;\n\n    return {\n      from,\n      message: body,\n      timestamp: new Date(timestamp).toISOString(),\n      type,\n      processed: true,\n    };\n  }\n}\n\n// Singleton instance\nexport const whatsappService = new WhatsAppService();\n\nexport default whatsappService;\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,SAASA,YAAY,QAAQ,oBAAoB;AAEjD,MAAMC,eAAe,CAAC;EACpBC,WAAWA,CAAA,EAAG;IACZ;IACA,IAAI,CAACC,gBAAgB,GAAGC,OAAO,CAACC,GAAG,CAACC,4BAA4B;IAChE,IAAI,CAACC,eAAe,GAAGH,OAAO,CAACC,GAAG,CAACG,2BAA2B;IAC9D,IAAI,CAACC,iBAAiB,GAAGL,OAAO,CAACC,GAAG,CAACK,6BAA6B;IAClE,IAAI,CAACC,eAAe,GAAGP,OAAO,CAACC,GAAG,CAACO,2BAA2B;IAC9D,IAAI,CAACC,iBAAiB,GAAGT,OAAO,CAACC,GAAG,CAACS,8BAA8B;;IAEnE;IACA,IAAI,CAACC,SAAS,GAAG;MACfC,YAAY,EAAE;QACZC,EAAE,EAAEA,CAACC,QAAQ,EAAEC,QAAQ,KACrB,QAAQD,QAAQ,IAAI,EAAE,gCAAgCC,QAAQ,6EAA6E;QAC7IC,EAAE,EAAEA,CAACF,QAAQ,EAAEC,QAAQ,KACrB,MAAMD,QAAQ,IAAI,EAAE,uCAAuCC,QAAQ,8FAA8F;QACnKE,EAAE,EAAEA,CAACH,QAAQ,EAAEC,QAAQ,KACrB,QAAQD,QAAQ,IAAI,EAAE,kDAAkDC,QAAQ;MACpF,CAAC;MACDG,YAAY,EAAE;QACZL,EAAE,EAAGM,IAAI,IAAK,wCAAwCA,IAAI,sBAAsB;QAChFH,EAAE,EAAGG,IAAI,IAAK,8CAA8CA,IAAI;MAClE,CAAC;MACDC,eAAe,EAAE;QACfP,EAAE,EAAGM,IAAI,IAAK,yCAAyCA,IAAI,yBAAyB;QACpFH,EAAE,EAAGG,IAAI,IAAK,qDAAqDA,IAAI;MACzE,CAAC;MACDE,kBAAkB,EAAE;QAClBR,EAAE,EAAEA,CAACM,IAAI,EAAEG,KAAK,KAAK,6BAA6BH,IAAI,OAAOG,KAAK,qBAAqB;QACvFN,EAAE,EAAEA,CAACG,IAAI,EAAEG,KAAK,KAAK,sCAAsCH,IAAI,OAAOG,KAAK;MAC7E,CAAC;MACDC,QAAQ,EAAE;QACRV,EAAE,EAAEA,CAACM,IAAI,EAAEK,KAAK,KAAK,wBAAwBL,IAAI,kBAAkBK,KAAK,0BAA0B;QAClGR,EAAE,EAAEA,CAACG,IAAI,EAAEK,KAAK,KAAK,yBAAyBL,IAAI,8BAA8BK,KAAK;MACvF,CAAC;MACDC,cAAc,EAAE;QACdZ,EAAE,EAAEA,CAACa,IAAI,EAAEP,IAAI,EAAEQ,QAAQ,KAAK,sBAAsBD,IAAI,WAAWP,IAAI,gBAAgBQ,QAAQ,EAAE;QACjGX,EAAE,EAAEA,CAACU,IAAI,EAAEP,IAAI,EAAEQ,QAAQ,KAAK,oBAAoBD,IAAI,YAAYP,IAAI,gBAAgBQ,QAAQ;MAChG,CAAC;MACDC,WAAW,EAAE;QACXf,EAAE,EAAGgB,OAAO,IAAK,uBAAuBA,OAAO,0BAA0B;QACzEb,EAAE,EAAGa,OAAO,IAAK,wBAAwBA,OAAO;MAClD;IACF,CAAC;;IAED;IACA,IAAI,CAACC,aAAa,GAAG,CACnB;MAAEC,EAAE,EAAE,CAAC;MAAEC,IAAI,EAAE,gBAAgB;MAAEC,KAAK,EAAE,eAAe;MAAEC,UAAU,EAAE;IAAe,CAAC,EACrF;MAAEH,EAAE,EAAE,CAAC;MAAEC,IAAI,EAAE,cAAc;MAAEC,KAAK,EAAE,eAAe;MAAEC,UAAU,EAAE;IAAc,CAAC,EAClF;MAAEH,EAAE,EAAE,CAAC;MAAEC,IAAI,EAAE,YAAY;MAAEC,KAAK,EAAE,eAAe;MAAEC,UAAU,EAAE;IAAY,CAAC,EAC9E;MAAEH,EAAE,EAAE,CAAC;MAAEC,IAAI,EAAE,oBAAoB;MAAEC,KAAK,EAAE,eAAe;MAAEC,UAAU,EAAE;IAAe,CAAC,CAC1F;EACH;EAEAC,cAAcA,CAAA,EAAG;IACf,IAAI;MAAA,IAAAC,aAAA,EAAAC,cAAA;MACF,MAAMC,GAAG,GAAGC,YAAY,CAACC,OAAO,CAAC,0BAA0B,CAAC;MAC5D,IAAI,CAACF,GAAG,EAAE,OAAO,CAAC,CAAC;MACnB,MAAMG,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACL,GAAG,CAAC;MAC9B,MAAMM,KAAK,GAAGH,MAAM,aAANA,MAAM,wBAAAL,aAAA,GAANK,MAAM,CAAEI,KAAK,cAAAT,aAAA,uBAAbA,aAAA,CAAeU,SAAS;MACtC,MAAMC,QAAQ,GAAGN,MAAM,aAANA,MAAM,wBAAAJ,cAAA,GAANI,MAAM,CAAEI,KAAK,cAAAR,cAAA,uBAAbA,cAAA,CAAeW,cAAc;MAC9C,MAAMC,OAAO,GAAG,CAAC,CAAC;MAClB,IAAIL,KAAK,EAAEK,OAAO,CAACC,aAAa,GAAG,UAAUN,KAAK,EAAE;MACpD,IAAIG,QAAQ,EAAEE,OAAO,CAAC,aAAa,CAAC,GAAGF,QAAQ;MAC/C,OAAOE,OAAO;IAChB,CAAC,CAAC,OAAOE,KAAK,EAAE;MACd,OAAO,CAAC,CAAC;IACX;EACF;;EAEA;AACF;AACA;EACE,MAAMC,aAAaA,CAACC,EAAE,EAAExB,OAAO,EAAE;IAC/B,IAAI;MACF,MAAMyB,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG3D,YAAY,oBAAoB,EAAE;QAChE4D,MAAM,EAAE,MAAM;QACdP,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClC,GAAG,IAAI,CAACd,cAAc,CAAC;QACzB,CAAC;QACDsB,IAAI,EAAEf,IAAI,CAACgB,SAAS,CAAC;UACnBL,EAAE;UACFxB,OAAO;UACP8B,QAAQ,EAAE;QACZ,CAAC;MACH,CAAC,CAAC;MAEF,IAAI,CAACL,QAAQ,CAACM,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,iCAAiC,CAAC;MACpD;MAEA,OAAO,MAAMP,QAAQ,CAACQ,IAAI,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOX,KAAK,EAAE;MACdY,OAAO,CAACZ,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;MACrD;MACA,OAAO,IAAI,CAACa,YAAY,CAACX,EAAE,EAAExB,OAAO,CAAC;IACvC;EACF;;EAEA;AACF;AACA;EACE,MAAMoC,WAAWA,CAACZ,EAAE,EAAExB,OAAO,EAAEqC,YAAY,GAAG,IAAI,EAAE;IAClD,IAAI;MACF,MAAMZ,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG3D,YAAY,oBAAoB,EAAE;QAChE4D,MAAM,EAAE,MAAM;QACdP,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClC,GAAG,IAAI,CAACd,cAAc,CAAC;QACzB,CAAC;QACDsB,IAAI,EAAEf,IAAI,CAACgB,SAAS,CAAC;UACnBL,EAAE;UACFxB,OAAO;UACPqC,YAAY;UACZP,QAAQ,EAAE;QACZ,CAAC;MACH,CAAC,CAAC;MAEF,IAAI,CAACL,QAAQ,CAACM,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,iCAAiC,CAAC;MACpD;MAEA,OAAO,MAAMP,QAAQ,CAACQ,IAAI,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOX,KAAK,EAAE;MACdY,OAAO,CAACZ,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnD;MACA,OAAO,IAAI,CAACa,YAAY,CAACX,EAAE,EAAExB,OAAO,CAAC;IACvC;EACF;;EAEA;AACF;AACA;EACEmC,YAAYA,CAACX,EAAE,EAAExB,OAAO,EAAE;IACxBkC,OAAO,CAACI,GAAG,CAAC,oCAAoCd,EAAE,GAAG,EAAExB,OAAO,CAAC;IAE/D,OAAO;MACLuC,OAAO,EAAE,IAAI;MACbC,SAAS,EAAE,OAAOC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;MAC9BlB,EAAE;MACFxB,OAAO;MACP2C,SAAS,EAAE,IAAIF,IAAI,CAAC,CAAC,CAACG,WAAW,CAAC,CAAC;MACnCC,MAAM,EAAE;IACV,CAAC;EACH;;EAEA;AACF;AACA;EACE,MAAMC,gBAAgBA,CAACzC,UAAU,EAAEL,OAAO,EAAE+C,IAAI,GAAG,IAAI,EAAE;IACvD,MAAMC,YAAY,GAAG,IAAI,CAAC/C,aAAa,CAACgD,MAAM,CAAEC,CAAC,IAAKA,CAAC,CAAC7C,UAAU,KAAKA,UAAU,CAAC;IAElF,IAAI2C,YAAY,CAACG,MAAM,KAAK,CAAC,EAAE;MAC7BjB,OAAO,CAACkB,IAAI,CAAC,6CAA6C/C,UAAU,EAAE,CAAC;MACvE,OAAO,EAAE;IACX;IAEA,MAAMgD,OAAO,GAAG,MAAMC,OAAO,CAACC,GAAG,CAC/BP,YAAY,CAACQ,GAAG,CAAEC,KAAK,IAAK,IAAI,CAAClC,aAAa,CAACkC,KAAK,CAACrD,KAAK,EAAEJ,OAAO,CAAC,CACtE,CAAC;IAED,OAAOqD,OAAO;EAChB;;EAEA;AACF;AACA;EACE,MAAMK,kBAAkBA,CAACpE,IAAI,EAAEyD,IAAI,GAAG,IAAI,EAAE;IAC1C,MAAM/C,OAAO,GAAG,IAAI,CAAClB,SAAS,CAACO,YAAY,CAAC0D,IAAI,CAAC,CAACzD,IAAI,CAAC;IACvD,OAAO,IAAI,CAACwD,gBAAgB,CAAC,cAAc,EAAE9C,OAAO,EAAE+C,IAAI,CAAC;EAC7D;;EAEA;AACF;AACA;EACE,MAAMY,qBAAqBA,CAACrE,IAAI,EAAEyD,IAAI,GAAG,IAAI,EAAE;IAC7C,MAAM/C,OAAO,GAAG,IAAI,CAAClB,SAAS,CAACS,eAAe,CAACwD,IAAI,CAAC,CAACzD,IAAI,CAAC;IAC1D,OAAO,IAAI,CAACwD,gBAAgB,CAAC,cAAc,EAAE9C,OAAO,EAAE+C,IAAI,CAAC;EAC7D;;EAEA;AACF;AACA;EACE,MAAMa,wBAAwBA,CAACtE,IAAI,EAAEG,KAAK,EAAEsD,IAAI,GAAG,IAAI,EAAE;IACvD,MAAM/C,OAAO,GAAG,IAAI,CAAClB,SAAS,CAACU,kBAAkB,CAACuD,IAAI,CAAC,CAACzD,IAAI,EAAEG,KAAK,CAAC;IACpE,OAAO,IAAI,CAACqD,gBAAgB,CAAC,aAAa,EAAE9C,OAAO,EAAE+C,IAAI,CAAC;EAC5D;;EAEA;AACF;AACA;EACE,MAAMc,cAAcA,CAACvE,IAAI,EAAEwE,SAAS,EAAEf,IAAI,GAAG,IAAI,EAAE;IACjD,MAAM/C,OAAO,GAAG,IAAI,CAAClB,SAAS,CAACY,QAAQ,CAACqD,IAAI,CAAC,CAACzD,IAAI,EAAEwE,SAAS,CAAC;IAC9D,OAAO,IAAI,CAAChB,gBAAgB,CAAC,cAAc,EAAE9C,OAAO,EAAE+C,IAAI,CAAC;EAC7D;;EAEA;AACF;AACA;EACE,MAAMgB,UAAUA,CAACC,OAAO,EAAEnE,IAAI,EAAEP,IAAI,EAAEQ,QAAQ,EAAEiD,IAAI,GAAG,IAAI,EAAE;IAC3D,MAAMU,KAAK,GAAG,IAAI,CAACxD,aAAa,CAACgE,IAAI,CAAEf,CAAC,IAAKA,CAAC,CAAChD,EAAE,KAAK8D,OAAO,CAAC;IAC9D,IAAI,CAACP,KAAK,EAAE;MACV,MAAM,IAAIzB,KAAK,CAAC,2BAA2BgC,OAAO,EAAE,CAAC;IACvD;IAEA,MAAMhE,OAAO,GAAG,IAAI,CAAClB,SAAS,CAACc,cAAc,CAACmD,IAAI,CAAC,CAAClD,IAAI,EAAEP,IAAI,EAAEQ,QAAQ,CAAC;IACzE,OAAO,IAAI,CAACyB,aAAa,CAACkC,KAAK,CAACrD,KAAK,EAAEJ,OAAO,CAAC;EACjD;;EAEA;AACF;AACA;EACE,MAAMkE,eAAeA,CAACC,YAAY,EAAEpB,IAAI,GAAG,IAAI,EAAE;IAC/C,MAAM/C,OAAO,GAAG,IAAI,CAAClB,SAAS,CAACiB,WAAW,CAACgD,IAAI,CAAC,CAACoB,YAAY,CAAC;IAE9D,MAAMd,OAAO,GAAG,MAAMC,OAAO,CAACC,GAAG,CAC/B,IAAI,CAACtD,aAAa,CAACuD,GAAG,CAAEC,KAAK,IAAK,IAAI,CAAClC,aAAa,CAACkC,KAAK,CAACrD,KAAK,EAAEJ,OAAO,CAAC,CAC5E,CAAC;IAED,OAAOqD,OAAO;EAChB;;EAEA;AACF;AACA;EACE,MAAMe,gBAAgBA,CAACC,IAAI,EAAEtB,IAAI,GAAG,IAAI,EAAE;IACxC,IAAI,CAACsB,IAAI,IAAI,CAACA,IAAI,CAACjE,KAAK,EAAE;MACxB8B,OAAO,CAACkB,IAAI,CAAC,kDAAkD,CAAC;MAChE,OAAO,IAAI;IACb;IAEA,MAAMnE,QAAQ,GAAGoF,IAAI,CAACC,OAAO,IAAID,IAAI,CAAClE,IAAI,IAAI,EAAE;IAChD,MAAMoE,YAAY,GAAGF,IAAI,CAACnF,QAAQ,IAAImF,IAAI,CAAClE,IAAI,IAAI,eAAe;IAClE,MAAMqE,QAAQ,GAAG,IAAI,CAAC1F,SAAS,CAACC,YAAY,CAACgE,IAAI,CAAC,IAAI,IAAI,CAACjE,SAAS,CAACC,YAAY,CAACI,EAAE;IACpF,MAAMa,OAAO,GAAGwE,QAAQ,CAACvF,QAAQ,EAAEsF,YAAY,CAAC;IAEhD,OAAO,IAAI,CAAChD,aAAa,CAAC8C,IAAI,CAACjE,KAAK,EAAEJ,OAAO,CAAC;EAChD;;EAEA;AACF;AACA;EACE,MAAMyE,gBAAgBA,CAACjC,SAAS,EAAE;IAChC,IAAI;MACF,MAAMf,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG3D,YAAY,wBAAwByE,SAAS,EAAE,EAAE;QAC/Eb,MAAM,EAAE,KAAK;QACbP,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClC,GAAG,IAAI,CAACd,cAAc,CAAC;QACzB;MACF,CAAC,CAAC;MAEF,IAAI,CAACmB,QAAQ,CAACM,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,8BAA8B,CAAC;MACjD;MAEA,OAAO,MAAMP,QAAQ,CAACQ,IAAI,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOX,KAAK,EAAE;MACdY,OAAO,CAACZ,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACtD,OAAO;QAAEuB,MAAM,EAAE,SAAS;QAAEL;MAAU,CAAC;IACzC;EACF;;EAEA;AACF;AACA;EACE,MAAMkC,YAAYA,CAACC,WAAW,EAAE;IAC9B,IAAI;MACF,MAAMlD,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG3D,YAAY,6BAA6B,EAAE;QACzE4D,MAAM,EAAE,MAAM;QACdP,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClC,GAAG,IAAI,CAACd,cAAc,CAAC;QACzB,CAAC;QACDsB,IAAI,EAAEf,IAAI,CAACgB,SAAS,CAAC;UAAE8C;QAAY,CAAC;MACtC,CAAC,CAAC;MAEF,OAAO,MAAMlD,QAAQ,CAACQ,IAAI,CAAC,CAAC;IAC9B,CAAC,CAAC,OAAOX,KAAK,EAAE;MACdY,OAAO,CAACZ,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACvD,MAAMA,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACEsD,sBAAsBA,CAACC,WAAW,EAAE;IAClC;IACA,MAAM;MAAEC,IAAI;MAAElD,IAAI;MAAEe,SAAS;MAAEoC;IAAK,CAAC,GAAGF,WAAW;IAEnD,OAAO;MACLC,IAAI;MACJ9E,OAAO,EAAE4B,IAAI;MACbe,SAAS,EAAE,IAAIF,IAAI,CAACE,SAAS,CAAC,CAACC,WAAW,CAAC,CAAC;MAC5CmC,IAAI;MACJC,SAAS,EAAE;IACb,CAAC;EACH;AACF;;AAEA;AACA,OAAO,MAAMC,eAAe,GAAG,IAAIjH,eAAe,CAAC,CAAC;AAEpD,eAAeiH,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}