{"ast":null,"code":"import React,{useEffect,useState}from'react';import useTranslations from'./hooks/useTranslations';import useStore from'./store/useStore';import{getDemoAuthToken}from'./services/api';import{wsService}from'./services/websocket';import'./styles/tailwind.css';import'./App.css';import Layout from'./components/layout/Layout';import EnterpriseDashboard from'./components/dashboard/EnterpriseDashboard';import PremiumDashboard from'./components/dashboard/PremiumDashboard';import PropertiesDashboard from'./components/dashboard/PropertiesDashboard';import LeadsCRM from'./components/crm/LeadsCRM';import FieldView from'./components/features/FieldView';import WhatsAppMonitor from'./components/operator/WhatsAppMonitor';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const parseJwtPayload=token=>{try{const payload=token.split('.')[1];const normalized=payload.replace(/-/g,'+').replace(/_/g,'/');const decoded=JSON.parse(atob(normalized));return decoded||{};}catch(error){return{};}};function App(){const{lang,activeTenantId,authToken,setAuthToken,setActiveTenantId,role,hasHydrated,setLang,market}=useStore();const{i18n}=useTranslations();const isRTL=lang==='he';const[activeView,setActiveView]=useState('dashboard');const isClockInRoute=typeof window!=='undefined'&&window.location.pathname==='/clock-in';useEffect(()=>{// Connect to WebSocket on mount\nwsService.connect();return()=>{wsService.disconnect();};},[]);useEffect(()=>{const ensureAuth=async()=>{if(authToken)return;const params=new URLSearchParams(window.location.search);const tokenParam=params.get('token');if(tokenParam){const payload=parseJwtPayload(tokenParam);if(payload!==null&&payload!==void 0&&payload.tenant_id){setActiveTenantId(payload.tenant_id);}setAuthToken(tokenParam);params.delete('token');const next=`${window.location.pathname}${params.toString()?`?${params}`:''}`;window.history.replaceState({},'',next);return;}try{const result=await getDemoAuthToken(activeTenantId);setAuthToken(result.token);}catch(error){console.error('Failed to obtain demo token:',error);}};ensureAuth();},[activeTenantId,authToken,setAuthToken,setActiveTenantId]);useEffect(()=>{i18n.changeLanguage(lang);if(typeof document!=='undefined'){document.documentElement.dir=isRTL?'rtl':'ltr';document.documentElement.lang=lang;}},[i18n,isRTL,lang]);useEffect(()=>{const marketKey=market==='IL'?'IL':'US';const allowed=marketKey==='IL'?['he','th','hi']:['en','es'];if(!allowed.includes(lang)){setLang(allowed[0]);}},[market,lang,setLang]);useEffect(()=>{const roleViews={host:['dashboard','premium','properties','crm'],operator:['operator'],field:['field']};const allowed=roleViews[role]||['dashboard'];if(!allowed.includes(activeView)){setActiveView(allowed[0]);}},[role,activeView]);const renderRoleView=()=>{switch(role){case'operator':return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(LeadsCRM,{}),/*#__PURE__*/_jsx(WhatsAppMonitor,{})]},\"operator-view\");case'field':return/*#__PURE__*/_jsx(FieldView,{},\"field-view\");case'host':default:if(activeView==='crm')return/*#__PURE__*/_jsx(LeadsCRM,{},\"host-crm\");if(activeView==='premium')return/*#__PURE__*/_jsx(PremiumDashboard,{},\"host-premium\");if(activeView==='properties')return/*#__PURE__*/_jsx(PropertiesDashboard,{},\"host-properties\");return/*#__PURE__*/_jsx(EnterpriseDashboard,{},\"host-dashboard\");}};return/*#__PURE__*/_jsx(\"div\",{dir:isRTL?'rtl':'ltr',children:hasHydrated?isClockInRoute?/*#__PURE__*/_jsx(\"div\",{className:\"clockin-shell\",children:/*#__PURE__*/_jsx(FieldView,{clockInOnly:true,autoClockInOnScan:true})}):/*#__PURE__*/_jsx(Layout,{activeView:activeView,setActiveView:setActiveView,children:renderRoleView()}):null});}export default App;","map":{"version":3,"names":["React","useEffect","useState","useTranslations","useStore","getDemoAuthToken","wsService","Layout","EnterpriseDashboard","PremiumDashboard","PropertiesDashboard","LeadsCRM","FieldView","WhatsAppMonitor","jsx","_jsx","jsxs","_jsxs","parseJwtPayload","token","payload","split","normalized","replace","decoded","JSON","parse","atob","error","App","lang","activeTenantId","authToken","setAuthToken","setActiveTenantId","role","hasHydrated","setLang","market","i18n","isRTL","activeView","setActiveView","isClockInRoute","window","location","pathname","connect","disconnect","ensureAuth","params","URLSearchParams","search","tokenParam","get","tenant_id","delete","next","toString","history","replaceState","result","console","changeLanguage","document","documentElement","dir","marketKey","allowed","includes","roleViews","host","operator","field","renderRoleView","children","className","clockInOnly","autoClockInOnScan"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport useTranslations from './hooks/useTranslations';\nimport useStore from './store/useStore';\nimport { getDemoAuthToken } from './services/api';\nimport { wsService } from './services/websocket';\nimport './styles/tailwind.css';\nimport './App.css';\nimport Layout from './components/layout/Layout';\nimport EnterpriseDashboard from './components/dashboard/EnterpriseDashboard';\nimport PremiumDashboard from './components/dashboard/PremiumDashboard';\nimport PropertiesDashboard from './components/dashboard/PropertiesDashboard';\nimport LeadsCRM from './components/crm/LeadsCRM';\nimport FieldView from './components/features/FieldView';\nimport WhatsAppMonitor from './components/operator/WhatsAppMonitor';\n\nconst parseJwtPayload = (token) => {\n  try {\n    const payload = token.split('.')[1];\n    const normalized = payload.replace(/-/g, '+').replace(/_/g, '/');\n    const decoded = JSON.parse(atob(normalized));\n    return decoded || {};\n  } catch (error) {\n    return {};\n  }\n};\n\nfunction App() {\n  const { lang, activeTenantId, authToken, setAuthToken, setActiveTenantId, role, hasHydrated, setLang, market } = useStore();\n  const { i18n } = useTranslations();\n  const isRTL = lang === 'he';\n  const [activeView, setActiveView] = useState('dashboard');\n  const isClockInRoute = typeof window !== 'undefined' && window.location.pathname === '/clock-in';\n\n  useEffect(() => {\n    // Connect to WebSocket on mount\n    wsService.connect();\n    \n    return () => {\n      wsService.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    const ensureAuth = async () => {\n      if (authToken) return;\n      const params = new URLSearchParams(window.location.search);\n      const tokenParam = params.get('token');\n      if (tokenParam) {\n        const payload = parseJwtPayload(tokenParam);\n        if (payload?.tenant_id) {\n          setActiveTenantId(payload.tenant_id);\n        }\n        setAuthToken(tokenParam);\n        params.delete('token');\n        const next = `${window.location.pathname}${params.toString() ? `?${params}` : ''}`;\n        window.history.replaceState({}, '', next);\n        return;\n      }\n      try {\n        const result = await getDemoAuthToken(activeTenantId);\n        setAuthToken(result.token);\n      } catch (error) {\n        console.error('Failed to obtain demo token:', error);\n      }\n    };\n    ensureAuth();\n  }, [activeTenantId, authToken, setAuthToken, setActiveTenantId]);\n\n  useEffect(() => {\n    i18n.changeLanguage(lang);\n    if (typeof document !== 'undefined') {\n      document.documentElement.dir = isRTL ? 'rtl' : 'ltr';\n      document.documentElement.lang = lang;\n    }\n  }, [i18n, isRTL, lang]);\n\n  useEffect(() => {\n    const marketKey = market === 'IL' ? 'IL' : 'US';\n    const allowed = marketKey === 'IL' ? ['he', 'th', 'hi'] : ['en', 'es'];\n    if (!allowed.includes(lang)) {\n      setLang(allowed[0]);\n    }\n  }, [market, lang, setLang]);\n\n  useEffect(() => {\n    const roleViews = {\n      host: ['dashboard', 'premium', 'properties', 'crm'],\n      operator: ['operator'],\n      field: ['field'],\n    };\n    const allowed = roleViews[role] || ['dashboard'];\n    if (!allowed.includes(activeView)) {\n      setActiveView(allowed[0]);\n    }\n  }, [role, activeView]);\n\n  const renderRoleView = () => {\n    switch (role) {\n      case 'operator':\n        return (\n          <div key=\"operator-view\">\n            <LeadsCRM />\n            <WhatsAppMonitor />\n          </div>\n        );\n      case 'field':\n        return <FieldView key=\"field-view\" />;\n      case 'host':\n      default:\n        if (activeView === 'crm') return <LeadsCRM key=\"host-crm\" />;\n        if (activeView === 'premium') return <PremiumDashboard key=\"host-premium\" />;\n        if (activeView === 'properties') return <PropertiesDashboard key=\"host-properties\" />;\n        return <EnterpriseDashboard key=\"host-dashboard\" />;\n    }\n  };\n\n  return (\n    <div dir={isRTL ? 'rtl' : 'ltr'}>\n      {hasHydrated ? (\n        isClockInRoute ? (\n          <div className=\"clockin-shell\">\n            <FieldView clockInOnly autoClockInOnScan />\n          </div>\n        ) : (\n          <Layout activeView={activeView} setActiveView={setActiveView}>\n            {renderRoleView()}\n          </Layout>\n        )\n      ) : null}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}