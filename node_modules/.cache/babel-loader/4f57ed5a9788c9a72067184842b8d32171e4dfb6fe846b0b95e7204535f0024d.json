{"ast":null,"code":"/**\n * WhatsApp Integration Service\n * Uses Twilio or Meta Cloud API for sending messages\n */import{API_BASE_URL}from'../utils/constants';class WhatsAppService{constructor(){// In production, these would be securely stored\nthis.twilioAccountSid=process.env.REACT_APP_TWILIO_ACCOUNT_SID;this.twilioAuthToken=process.env.REACT_APP_TWILIO_AUTH_TOKEN;this.twilioPhoneNumber=process.env.REACT_APP_TWILIO_PHONE_NUMBER;this.metaAccessToken=process.env.REACT_APP_META_ACCESS_TOKEN;this.metaPhoneNumberId=process.env.REACT_APP_META_PHONE_NUMBER_ID;// Message templates for common operations\nthis.templates={leadGreeting:{he:(leadName,property)=>`×©×œ×•× ${leadName||''} ðŸ‘‹\\n\\n×ª×•×“×” ×¢×œ ×”×”×ª×¢× ×™×™× ×•×ª ×‘-*${property}*.\\n×× ×™ ×›××Ÿ ×›×“×™ ×œ×¢×–×•×¨ ×¢× ×¤×¨×˜×™× ×•×–×ž×™× ×•×ª.\\n\\n×”×× ×ª×¨×¦×• ×©× ×‘×“×•×§ ×ª××¨×™×›×™× ×ž×•×¢×“×¤×™×?`,en:(leadName,property)=>`Hi ${leadName||''} ðŸ‘‹\\n\\nThanks for your interest in *${property}*.\\nI can help with details and availability.\\n\\nWould you like me to check preferred dates?`,el:(leadName,property)=>`Î“ÎµÎ¹Î± ${leadName||''} ðŸ‘‹\\n\\nÎ•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Î³Î¹Î± Ï„Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ ÏƒÎ±Ï‚ ÏƒÏ„Î¿ *${property}*.\\nÎœÏ€Î¿ÏÏŽ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÏ‰ Î¼Îµ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±.\\n\\nÎ˜Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎ»Î­Î³Î¾Ï‰ Ï€ÏÎ¿Ï„Î¹Î¼ÏŽÎ¼ÎµÎ½ÎµÏ‚ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚;`},towelRequest:{he:room=>`ðŸ¨ *×‘×§×©×” ×—×“×©×”*\\n\\n×ž×’×‘×•×ª × ×“×¨×©×•×ª ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“×`,en:room=>`ðŸ¨ *New Request*\\n\\nTowels needed in room *${room}*\\n\\nâ° Please handle ASAP`},cleaningRequest:{he:room=>`ðŸ§¹ *×‘×§×©×ª × ×™×§×™×•×Ÿ*\\n\\n× ×™×§×™×•×Ÿ × ×“×¨×© ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×ª×× ×¢× ×”×¦×•×•×ª`,en:room=>`ðŸ§¹ *Cleaning Request*\\n\\nCleaning needed in room *${room}*\\n\\nâ° Please coordinate with team`},maintenanceRequest:{he:(room,issue)=>`ðŸ”§ *×ª×—×–×•×§×”*\\n\\n×‘×¢×™×” ×‘×—×“×¨ *${room}*:\\n${issue}\\n\\nâš ï¸ ×“×—×™×¤×•×ª ×’×‘×•×”×”`,en:(room,issue)=>`ðŸ”§ *Maintenance*\\n\\nIssue in room *${room}*:\\n${issue}\\n\\nâš ï¸ High priority`},checkout:{he:(room,guest)=>`âœ… *×¦'×§-×××•×˜*\\n\\n×—×“×¨ *${room}* ×”×ª×¤× ×”\\n××•×¨×—: ${guest}\\n\\nðŸ§¹ × × ×œ×”×ª×—×™×œ ×‘× ×™×§×™×•×Ÿ`,en:(room,guest)=>`âœ… *Checkout*\\n\\nRoom *${room}* is now available\\nGuest: ${guest}\\n\\nðŸ§¹ Please begin cleaning`},taskAssignment:{he:(task,room,deadline)=>`ðŸ“‹ *×ž×©×™×ž×” ×—×“×©×”*\\n\\n${task}\\n×—×“×¨: *${room}*\\n×–×ž×Ÿ ×¡×™×•×: ${deadline}`,en:(task,room,deadline)=>`ðŸ“‹ *New Task*\\n\\n${task}\\nRoom: *${room}*\\nDeadline: ${deadline}`},urgentAlert:{he:message=>`ðŸš¨ *×”×ª×¨××” ×“×—×•×¤×”*\\n\\n${message}\\n\\nâš¡ × ×“×¨×©×ª ×¤×¢×•×œ×” ×ž×™×™×“×™×ª`,en:message=>`ðŸš¨ *Urgent Alert*\\n\\n${message}\\n\\nâš¡ Immediate action required`}};// Staff contact list (in production, fetch from database)\nthis.staffContacts=[{id:1,name:'×™×•×¡×™ - ×ž×©×§ ×‘×™×ª',phone:'+972501234567',department:'housekeeping'},{id:2,name:'×“× ×” - ×ª×—×–×•×§×”',phone:'+972509876543',department:'maintenance'},{id:3,name:'××‘×™ - ×§×‘×œ×”',phone:'+972505555555',department:'reception'},{id:4,name:'×ž×™×›×œ - ×©×™×¨×•×ª ×—×“×¨×™×',phone:'+972503333333',department:'room_service'}];}getAuthHeaders(){try{var _parsed$state,_parsed$state2;const raw=localStorage.getItem('hotel-enterprise-storage');if(!raw)return{};const parsed=JSON.parse(raw);const token=parsed===null||parsed===void 0?void 0:(_parsed$state=parsed.state)===null||_parsed$state===void 0?void 0:_parsed$state.authToken;const tenantId=parsed===null||parsed===void 0?void 0:(_parsed$state2=parsed.state)===null||_parsed$state2===void 0?void 0:_parsed$state2.activeTenantId;const headers={};if(token)headers.Authorization=`Bearer ${token}`;if(tenantId)headers['X-Tenant-Id']=tenantId;return headers;}catch(error){return{};}}/**\n   * Send WhatsApp message via Twilio\n   */async sendViaTwilio(to,message){try{const response=await fetch(`${API_BASE_URL}/api/whatsapp/send`,{method:'POST',headers:{'Content-Type':'application/json',...this.getAuthHeaders()},body:JSON.stringify({to,message,provider:'twilio'})});if(!response.ok){throw new Error('Failed to send WhatsApp message');}return await response.json();}catch(error){console.error('[WhatsApp] Twilio send error:',error);// Fallback to simulation for demo\nreturn this.simulateSend(to,message);}}/**\n   * Send WhatsApp message via Meta Cloud API\n   */async sendViaMeta(to,message){let templateName=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;try{const response=await fetch(`${API_BASE_URL}/api/whatsapp/send`,{method:'POST',headers:{'Content-Type':'application/json',...this.getAuthHeaders()},body:JSON.stringify({to,message,templateName,provider:'meta'})});if(!response.ok){throw new Error('Failed to send WhatsApp message');}return await response.json();}catch(error){console.error('[WhatsApp] Meta send error:',error);// Fallback to simulation for demo\nreturn this.simulateSend(to,message);}}/**\n   * Simulate message sending for demo purposes\n   */simulateSend(to,message){console.log(`[WhatsApp Simulation] Sending to ${to}:`,message);return{success:true,messageId:`sim_${Date.now()}`,to,message,timestamp:new Date().toISOString(),status:'delivered'};}/**\n   * Send message to department\n   */async sendToDepartment(department,message){let lang=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'he';const staffMembers=this.staffContacts.filter(s=>s.department===department);if(staffMembers.length===0){console.warn(`[WhatsApp] No staff found for department: ${department}`);return[];}const results=await Promise.all(staffMembers.map(staff=>this.sendViaTwilio(staff.phone,message)));return results;}/**\n   * Send towel request notification\n   */async notifyTowelRequest(room){let lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'he';const message=this.templates.towelRequest[lang](room);return this.sendToDepartment('housekeeping',message,lang);}/**\n   * Send cleaning request notification\n   */async notifyCleaningRequest(room){let lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'he';const message=this.templates.cleaningRequest[lang](room);return this.sendToDepartment('housekeeping',message,lang);}/**\n   * Send maintenance request notification\n   */async notifyMaintenanceRequest(room,issue){let lang=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'he';const message=this.templates.maintenanceRequest[lang](room,issue);return this.sendToDepartment('maintenance',message,lang);}/**\n   * Send checkout notification\n   */async notifyCheckout(room,guestName){let lang=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'he';const message=this.templates.checkout[lang](room,guestName);return this.sendToDepartment('housekeeping',message,lang);}/**\n   * Send task assignment\n   */async assignTask(staffId,task,room,deadline){let lang=arguments.length>4&&arguments[4]!==undefined?arguments[4]:'he';const staff=this.staffContacts.find(s=>s.id===staffId);if(!staff){throw new Error(`Staff member not found: ${staffId}`);}const message=this.templates.taskAssignment[lang](task,room,deadline);return this.sendViaTwilio(staff.phone,message);}/**\n   * Send urgent alert to all staff\n   */async sendUrgentAlert(alertMessage){let lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'he';const message=this.templates.urgentAlert[lang](alertMessage);const results=await Promise.all(this.staffContacts.map(staff=>this.sendViaTwilio(staff.phone,message)));return results;}/**\n   * Send personalized greeting to a lead\n   */async sendLeadGreeting(lead){let lang=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'he';if(!lead||!lead.phone){console.warn('[WhatsApp] Lead missing phone, skipping greeting');return null;}const leadName=lead.contact||lead.name||'';const propertyName=lead.property||lead.name||'your property';const template=this.templates.leadGreeting[lang]||this.templates.leadGreeting.en;const message=template(leadName,propertyName);return this.sendViaTwilio(lead.phone,message);}/**\n   * Get message delivery status\n   */async getMessageStatus(messageId){try{const response=await fetch(`${API_BASE_URL}/api/whatsapp/status/${messageId}`,{method:'GET',headers:{'Content-Type':'application/json',...this.getAuthHeaders()}});if(!response.ok){throw new Error('Failed to get message status');}return await response.json();}catch(error){console.error('[WhatsApp] Status check error:',error);return{status:'unknown',messageId};}}/**\n   * Set up webhook for incoming messages\n   */async setupWebhook(callbackUrl){try{const response=await fetch(`${API_BASE_URL}/api/whatsapp/webhook/setup`,{method:'POST',headers:{'Content-Type':'application/json',...this.getAuthHeaders()},body:JSON.stringify({callbackUrl})});return await response.json();}catch(error){console.error('[WhatsApp] Webhook setup error:',error);throw error;}}/**\n   * Process incoming webhook message\n   */processIncomingMessage(webhookData){// Parse incoming WhatsApp message\nconst{from,body,timestamp,type}=webhookData;return{from,message:body,timestamp:new Date(timestamp).toISOString(),type,processed:true};}}// Singleton instance\nexport const whatsappService=new WhatsAppService();export default whatsappService;","map":{"version":3,"names":["API_BASE_URL","WhatsAppService","constructor","twilioAccountSid","process","env","REACT_APP_TWILIO_ACCOUNT_SID","twilioAuthToken","REACT_APP_TWILIO_AUTH_TOKEN","twilioPhoneNumber","REACT_APP_TWILIO_PHONE_NUMBER","metaAccessToken","REACT_APP_META_ACCESS_TOKEN","metaPhoneNumberId","REACT_APP_META_PHONE_NUMBER_ID","templates","leadGreeting","he","leadName","property","en","el","towelRequest","room","cleaningRequest","maintenanceRequest","issue","checkout","guest","taskAssignment","task","deadline","urgentAlert","message","staffContacts","id","name","phone","department","getAuthHeaders","_parsed$state","_parsed$state2","raw","localStorage","getItem","parsed","JSON","parse","token","state","authToken","tenantId","activeTenantId","headers","Authorization","error","sendViaTwilio","to","response","fetch","method","body","stringify","provider","ok","Error","json","console","simulateSend","sendViaMeta","templateName","arguments","length","undefined","log","success","messageId","Date","now","timestamp","toISOString","status","sendToDepartment","lang","staffMembers","filter","s","warn","results","Promise","all","map","staff","notifyTowelRequest","notifyCleaningRequest","notifyMaintenanceRequest","notifyCheckout","guestName","assignTask","staffId","find","sendUrgentAlert","alertMessage","sendLeadGreeting","lead","contact","propertyName","template","getMessageStatus","setupWebhook","callbackUrl","processIncomingMessage","webhookData","from","type","processed","whatsappService"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/services/whatsapp.js"],"sourcesContent":["/**\n * WhatsApp Integration Service\n * Uses Twilio or Meta Cloud API for sending messages\n */\n\nimport { API_BASE_URL } from '../utils/constants';\n\nclass WhatsAppService {\n  constructor() {\n    // In production, these would be securely stored\n    this.twilioAccountSid = process.env.REACT_APP_TWILIO_ACCOUNT_SID;\n    this.twilioAuthToken = process.env.REACT_APP_TWILIO_AUTH_TOKEN;\n    this.twilioPhoneNumber = process.env.REACT_APP_TWILIO_PHONE_NUMBER;\n    this.metaAccessToken = process.env.REACT_APP_META_ACCESS_TOKEN;\n    this.metaPhoneNumberId = process.env.REACT_APP_META_PHONE_NUMBER_ID;\n    \n    // Message templates for common operations\n    this.templates = {\n      leadGreeting: {\n        he: (leadName, property) =>\n          `×©×œ×•× ${leadName || ''} ðŸ‘‹\\n\\n×ª×•×“×” ×¢×œ ×”×”×ª×¢× ×™×™× ×•×ª ×‘-*${property}*.\\n×× ×™ ×›××Ÿ ×›×“×™ ×œ×¢×–×•×¨ ×¢× ×¤×¨×˜×™× ×•×–×ž×™× ×•×ª.\\n\\n×”×× ×ª×¨×¦×• ×©× ×‘×“×•×§ ×ª××¨×™×›×™× ×ž×•×¢×“×¤×™×?`,\n        en: (leadName, property) =>\n          `Hi ${leadName || ''} ðŸ‘‹\\n\\nThanks for your interest in *${property}*.\\nI can help with details and availability.\\n\\nWould you like me to check preferred dates?`,\n        el: (leadName, property) =>\n          `Î“ÎµÎ¹Î± ${leadName || ''} ðŸ‘‹\\n\\nÎ•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Î³Î¹Î± Ï„Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ ÏƒÎ±Ï‚ ÏƒÏ„Î¿ *${property}*.\\nÎœÏ€Î¿ÏÏŽ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÏ‰ Î¼Îµ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±.\\n\\nÎ˜Î­Î»ÎµÏ„Îµ Î½Î± ÎµÎ»Î­Î³Î¾Ï‰ Ï€ÏÎ¿Ï„Î¹Î¼ÏŽÎ¼ÎµÎ½ÎµÏ‚ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯ÎµÏ‚;`,\n      },\n      towelRequest: {\n        he: (room) => `ðŸ¨ *×‘×§×©×” ×—×“×©×”*\\n\\n×ž×’×‘×•×ª × ×“×¨×©×•×ª ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“×`,\n        en: (room) => `ðŸ¨ *New Request*\\n\\nTowels needed in room *${room}*\\n\\nâ° Please handle ASAP`,\n      },\n      cleaningRequest: {\n        he: (room) => `ðŸ§¹ *×‘×§×©×ª × ×™×§×™×•×Ÿ*\\n\\n× ×™×§×™×•×Ÿ × ×“×¨×© ×‘×—×“×¨ *${room}*\\n\\nâ° ×× × ×ª×× ×¢× ×”×¦×•×•×ª`,\n        en: (room) => `ðŸ§¹ *Cleaning Request*\\n\\nCleaning needed in room *${room}*\\n\\nâ° Please coordinate with team`,\n      },\n      maintenanceRequest: {\n        he: (room, issue) => `ðŸ”§ *×ª×—×–×•×§×”*\\n\\n×‘×¢×™×” ×‘×—×“×¨ *${room}*:\\n${issue}\\n\\nâš ï¸ ×“×—×™×¤×•×ª ×’×‘×•×”×”`,\n        en: (room, issue) => `ðŸ”§ *Maintenance*\\n\\nIssue in room *${room}*:\\n${issue}\\n\\nâš ï¸ High priority`,\n      },\n      checkout: {\n        he: (room, guest) => `âœ… *×¦'×§-×××•×˜*\\n\\n×—×“×¨ *${room}* ×”×ª×¤× ×”\\n××•×¨×—: ${guest}\\n\\nðŸ§¹ × × ×œ×”×ª×—×™×œ ×‘× ×™×§×™×•×Ÿ`,\n        en: (room, guest) => `âœ… *Checkout*\\n\\nRoom *${room}* is now available\\nGuest: ${guest}\\n\\nðŸ§¹ Please begin cleaning`,\n      },\n      taskAssignment: {\n        he: (task, room, deadline) => `ðŸ“‹ *×ž×©×™×ž×” ×—×“×©×”*\\n\\n${task}\\n×—×“×¨: *${room}*\\n×–×ž×Ÿ ×¡×™×•×: ${deadline}`,\n        en: (task, room, deadline) => `ðŸ“‹ *New Task*\\n\\n${task}\\nRoom: *${room}*\\nDeadline: ${deadline}`,\n      },\n      urgentAlert: {\n        he: (message) => `ðŸš¨ *×”×ª×¨××” ×“×—×•×¤×”*\\n\\n${message}\\n\\nâš¡ × ×“×¨×©×ª ×¤×¢×•×œ×” ×ž×™×™×“×™×ª`,\n        en: (message) => `ðŸš¨ *Urgent Alert*\\n\\n${message}\\n\\nâš¡ Immediate action required`,\n      },\n    };\n\n    // Staff contact list (in production, fetch from database)\n    this.staffContacts = [\n      { id: 1, name: '×™×•×¡×™ - ×ž×©×§ ×‘×™×ª', phone: '+972501234567', department: 'housekeeping' },\n      { id: 2, name: '×“× ×” - ×ª×—×–×•×§×”', phone: '+972509876543', department: 'maintenance' },\n      { id: 3, name: '××‘×™ - ×§×‘×œ×”', phone: '+972505555555', department: 'reception' },\n      { id: 4, name: '×ž×™×›×œ - ×©×™×¨×•×ª ×—×“×¨×™×', phone: '+972503333333', department: 'room_service' },\n    ];\n  }\n\n  getAuthHeaders() {\n    try {\n      const raw = localStorage.getItem('hotel-enterprise-storage');\n      if (!raw) return {};\n      const parsed = JSON.parse(raw);\n      const token = parsed?.state?.authToken;\n      const tenantId = parsed?.state?.activeTenantId;\n      const headers = {};\n      if (token) headers.Authorization = `Bearer ${token}`;\n      if (tenantId) headers['X-Tenant-Id'] = tenantId;\n      return headers;\n    } catch (error) {\n      return {};\n    }\n  }\n\n  /**\n   * Send WhatsApp message via Twilio\n   */\n  async sendViaTwilio(to, message) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/send`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n        body: JSON.stringify({\n          to,\n          message,\n          provider: 'twilio',\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send WhatsApp message');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Twilio send error:', error);\n      // Fallback to simulation for demo\n      return this.simulateSend(to, message);\n    }\n  }\n\n  /**\n   * Send WhatsApp message via Meta Cloud API\n   */\n  async sendViaMeta(to, message, templateName = null) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/send`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n        body: JSON.stringify({\n          to,\n          message,\n          templateName,\n          provider: 'meta',\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to send WhatsApp message');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Meta send error:', error);\n      // Fallback to simulation for demo\n      return this.simulateSend(to, message);\n    }\n  }\n\n  /**\n   * Simulate message sending for demo purposes\n   */\n  simulateSend(to, message) {\n    console.log(`[WhatsApp Simulation] Sending to ${to}:`, message);\n    \n    return {\n      success: true,\n      messageId: `sim_${Date.now()}`,\n      to,\n      message,\n      timestamp: new Date().toISOString(),\n      status: 'delivered',\n    };\n  }\n\n  /**\n   * Send message to department\n   */\n  async sendToDepartment(department, message, lang = 'he') {\n    const staffMembers = this.staffContacts.filter((s) => s.department === department);\n    \n    if (staffMembers.length === 0) {\n      console.warn(`[WhatsApp] No staff found for department: ${department}`);\n      return [];\n    }\n\n    const results = await Promise.all(\n      staffMembers.map((staff) => this.sendViaTwilio(staff.phone, message))\n    );\n\n    return results;\n  }\n\n  /**\n   * Send towel request notification\n   */\n  async notifyTowelRequest(room, lang = 'he') {\n    const message = this.templates.towelRequest[lang](room);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send cleaning request notification\n   */\n  async notifyCleaningRequest(room, lang = 'he') {\n    const message = this.templates.cleaningRequest[lang](room);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send maintenance request notification\n   */\n  async notifyMaintenanceRequest(room, issue, lang = 'he') {\n    const message = this.templates.maintenanceRequest[lang](room, issue);\n    return this.sendToDepartment('maintenance', message, lang);\n  }\n\n  /**\n   * Send checkout notification\n   */\n  async notifyCheckout(room, guestName, lang = 'he') {\n    const message = this.templates.checkout[lang](room, guestName);\n    return this.sendToDepartment('housekeeping', message, lang);\n  }\n\n  /**\n   * Send task assignment\n   */\n  async assignTask(staffId, task, room, deadline, lang = 'he') {\n    const staff = this.staffContacts.find((s) => s.id === staffId);\n    if (!staff) {\n      throw new Error(`Staff member not found: ${staffId}`);\n    }\n\n    const message = this.templates.taskAssignment[lang](task, room, deadline);\n    return this.sendViaTwilio(staff.phone, message);\n  }\n\n  /**\n   * Send urgent alert to all staff\n   */\n  async sendUrgentAlert(alertMessage, lang = 'he') {\n    const message = this.templates.urgentAlert[lang](alertMessage);\n    \n    const results = await Promise.all(\n      this.staffContacts.map((staff) => this.sendViaTwilio(staff.phone, message))\n    );\n\n    return results;\n  }\n\n  /**\n   * Send personalized greeting to a lead\n   */\n  async sendLeadGreeting(lead, lang = 'he') {\n    if (!lead || !lead.phone) {\n      console.warn('[WhatsApp] Lead missing phone, skipping greeting');\n      return null;\n    }\n\n    const leadName = lead.contact || lead.name || '';\n    const propertyName = lead.property || lead.name || 'your property';\n    const template = this.templates.leadGreeting[lang] || this.templates.leadGreeting.en;\n    const message = template(leadName, propertyName);\n\n    return this.sendViaTwilio(lead.phone, message);\n  }\n\n  /**\n   * Get message delivery status\n   */\n  async getMessageStatus(messageId) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/status/${messageId}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to get message status');\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Status check error:', error);\n      return { status: 'unknown', messageId };\n    }\n  }\n\n  /**\n   * Set up webhook for incoming messages\n   */\n  async setupWebhook(callbackUrl) {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/whatsapp/webhook/setup`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...this.getAuthHeaders(),\n        },\n        body: JSON.stringify({ callbackUrl }),\n      });\n\n      return await response.json();\n    } catch (error) {\n      console.error('[WhatsApp] Webhook setup error:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Process incoming webhook message\n   */\n  processIncomingMessage(webhookData) {\n    // Parse incoming WhatsApp message\n    const { from, body, timestamp, type } = webhookData;\n\n    return {\n      from,\n      message: body,\n      timestamp: new Date(timestamp).toISOString(),\n      type,\n      processed: true,\n    };\n  }\n}\n\n// Singleton instance\nexport const whatsappService = new WhatsAppService();\n\nexport default whatsappService;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}