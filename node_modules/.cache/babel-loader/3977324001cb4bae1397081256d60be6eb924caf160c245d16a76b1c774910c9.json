{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Desktop\\\\hotel_ai_assistant\\\\hotel_dashboard\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport useTranslations from './hooks/useTranslations';\nimport useStore from './store/useStore';\nimport { getDemoAuthToken } from './services/api';\nimport { wsService } from './services/websocket';\nimport './styles/tailwind.css';\nimport './App.css';\nimport Layout from './components/layout/Layout';\nimport EnterpriseDashboard from './components/dashboard/EnterpriseDashboard';\nimport LeadsCRM from './components/crm/LeadsCRM';\nimport FieldView from './components/features/FieldView';\nimport WhatsAppMonitor from './components/operator/WhatsAppMonitor';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst parseJwtPayload = token => {\n  try {\n    const payload = token.split('.')[1];\n    const normalized = payload.replace(/-/g, '+').replace(/_/g, '/');\n    const decoded = JSON.parse(atob(normalized));\n    return decoded || {};\n  } catch (error) {\n    return {};\n  }\n};\nfunction App() {\n  _s();\n  const {\n    lang,\n    activeTenantId,\n    authToken,\n    setAuthToken,\n    setActiveTenantId,\n    role,\n    hasHydrated,\n    setLang,\n    market\n  } = useStore();\n  const {\n    i18n\n  } = useTranslations();\n  const isRTL = lang === 'he';\n  const [activeView, setActiveView] = useState('dashboard');\n  useEffect(() => {\n    // Connect to WebSocket on mount\n    wsService.connect();\n    return () => {\n      wsService.disconnect();\n    };\n  }, []);\n  useEffect(() => {\n    const ensureAuth = async () => {\n      if (authToken) return;\n      const params = new URLSearchParams(window.location.search);\n      const tokenParam = params.get('token');\n      if (tokenParam) {\n        const payload = parseJwtPayload(tokenParam);\n        if (payload !== null && payload !== void 0 && payload.tenant_id) {\n          setActiveTenantId(payload.tenant_id);\n        }\n        setAuthToken(tokenParam);\n        params.delete('token');\n        const next = `${window.location.pathname}${params.toString() ? `?${params}` : ''}`;\n        window.history.replaceState({}, '', next);\n        return;\n      }\n      try {\n        const result = await getDemoAuthToken(activeTenantId);\n        setAuthToken(result.token);\n      } catch (error) {\n        console.error('Failed to obtain demo token:', error);\n      }\n    };\n    ensureAuth();\n  }, [activeTenantId, authToken, setAuthToken, setActiveTenantId]);\n  useEffect(() => {\n    i18n.changeLanguage(lang);\n    if (typeof document !== 'undefined') {\n      document.documentElement.dir = isRTL ? 'rtl' : 'ltr';\n      document.documentElement.lang = lang;\n    }\n  }, [i18n, isRTL, lang]);\n  if (!hasHydrated) {\n    return null;\n  }\n  useEffect(() => {\n    const marketKey = market === 'IL' ? 'IL' : 'US';\n    const allowed = marketKey === 'IL' ? ['he', 'th', 'hi'] : ['en', 'es'];\n    if (!allowed.includes(lang)) {\n      setLang(allowed[0]);\n    }\n  }, [market, lang, setLang]);\n  useEffect(() => {\n    const roleViews = {\n      host: ['dashboard', 'crm', 'analytics'],\n      operator: ['operator'],\n      field: ['field']\n    };\n    const allowed = roleViews[role] || ['dashboard'];\n    if (!allowed.includes(activeView)) {\n      setActiveView(allowed[0]);\n    }\n  }, [role, activeView]);\n  const renderRoleView = () => {\n    switch (role) {\n      case 'operator':\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(LeadsCRM, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(WhatsAppMonitor, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 13\n          }, this)]\n        }, \"operator-view\", true, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this);\n      case 'field':\n        return /*#__PURE__*/_jsxDEV(FieldView, {}, \"field-view\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 16\n        }, this);\n      case 'host':\n      default:\n        if (activeView === 'crm') return /*#__PURE__*/_jsxDEV(LeadsCRM, {}, \"host-crm\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 42\n        }, this);\n        return /*#__PURE__*/_jsxDEV(EnterpriseDashboard, {}, \"host-dashboard\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 16\n        }, this);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    dir: isRTL ? 'rtl' : 'ltr',\n    children: /*#__PURE__*/_jsxDEV(Layout, {\n      activeView: activeView,\n      setActiveView: setActiveView,\n      children: renderRoleView()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"2FFjKlyN3GB0A7xmrC+TlWarxt0=\", false, function () {\n  return [useStore, useTranslations];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useState","useTranslations","useStore","getDemoAuthToken","wsService","Layout","EnterpriseDashboard","LeadsCRM","FieldView","WhatsAppMonitor","jsxDEV","_jsxDEV","parseJwtPayload","token","payload","split","normalized","replace","decoded","JSON","parse","atob","error","App","_s","lang","activeTenantId","authToken","setAuthToken","setActiveTenantId","role","hasHydrated","setLang","market","i18n","isRTL","activeView","setActiveView","connect","disconnect","ensureAuth","params","URLSearchParams","window","location","search","tokenParam","get","tenant_id","delete","next","pathname","toString","history","replaceState","result","console","changeLanguage","document","documentElement","dir","marketKey","allowed","includes","roleViews","host","operator","field","renderRoleView","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport useTranslations from './hooks/useTranslations';\nimport useStore from './store/useStore';\nimport { getDemoAuthToken } from './services/api';\nimport { wsService } from './services/websocket';\nimport './styles/tailwind.css';\nimport './App.css';\nimport Layout from './components/layout/Layout';\nimport EnterpriseDashboard from './components/dashboard/EnterpriseDashboard';\nimport LeadsCRM from './components/crm/LeadsCRM';\nimport FieldView from './components/features/FieldView';\nimport WhatsAppMonitor from './components/operator/WhatsAppMonitor';\n\nconst parseJwtPayload = (token) => {\n  try {\n    const payload = token.split('.')[1];\n    const normalized = payload.replace(/-/g, '+').replace(/_/g, '/');\n    const decoded = JSON.parse(atob(normalized));\n    return decoded || {};\n  } catch (error) {\n    return {};\n  }\n};\n\nfunction App() {\n  const { lang, activeTenantId, authToken, setAuthToken, setActiveTenantId, role, hasHydrated, setLang, market } = useStore();\n  const { i18n } = useTranslations();\n  const isRTL = lang === 'he';\n  const [activeView, setActiveView] = useState('dashboard');\n\n  useEffect(() => {\n    // Connect to WebSocket on mount\n    wsService.connect();\n    \n    return () => {\n      wsService.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    const ensureAuth = async () => {\n      if (authToken) return;\n      const params = new URLSearchParams(window.location.search);\n      const tokenParam = params.get('token');\n      if (tokenParam) {\n        const payload = parseJwtPayload(tokenParam);\n        if (payload?.tenant_id) {\n          setActiveTenantId(payload.tenant_id);\n        }\n        setAuthToken(tokenParam);\n        params.delete('token');\n        const next = `${window.location.pathname}${params.toString() ? `?${params}` : ''}`;\n        window.history.replaceState({}, '', next);\n        return;\n      }\n      try {\n        const result = await getDemoAuthToken(activeTenantId);\n        setAuthToken(result.token);\n      } catch (error) {\n        console.error('Failed to obtain demo token:', error);\n      }\n    };\n    ensureAuth();\n  }, [activeTenantId, authToken, setAuthToken, setActiveTenantId]);\n\n  useEffect(() => {\n    i18n.changeLanguage(lang);\n    if (typeof document !== 'undefined') {\n      document.documentElement.dir = isRTL ? 'rtl' : 'ltr';\n      document.documentElement.lang = lang;\n    }\n  }, [i18n, isRTL, lang]);\n\n  if (!hasHydrated) {\n    return null;\n  }\n\n  useEffect(() => {\n    const marketKey = market === 'IL' ? 'IL' : 'US';\n    const allowed = marketKey === 'IL' ? ['he', 'th', 'hi'] : ['en', 'es'];\n    if (!allowed.includes(lang)) {\n      setLang(allowed[0]);\n    }\n  }, [market, lang, setLang]);\n\n  useEffect(() => {\n    const roleViews = {\n      host: ['dashboard', 'crm', 'analytics'],\n      operator: ['operator'],\n      field: ['field'],\n    };\n    const allowed = roleViews[role] || ['dashboard'];\n    if (!allowed.includes(activeView)) {\n      setActiveView(allowed[0]);\n    }\n  }, [role, activeView]);\n\n  const renderRoleView = () => {\n    switch (role) {\n      case 'operator':\n        return (\n          <div key=\"operator-view\">\n            <LeadsCRM />\n            <WhatsAppMonitor />\n          </div>\n        );\n      case 'field':\n        return <FieldView key=\"field-view\" />;\n      case 'host':\n      default:\n        if (activeView === 'crm') return <LeadsCRM key=\"host-crm\" />;\n        return <EnterpriseDashboard key=\"host-dashboard\" />;\n    }\n  };\n\n  return (\n    <div dir={isRTL ? 'rtl' : 'ltr'}>\n      <Layout activeView={activeView} setActiveView={setActiveView}>\n        {renderRoleView()}\n      </Layout>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}