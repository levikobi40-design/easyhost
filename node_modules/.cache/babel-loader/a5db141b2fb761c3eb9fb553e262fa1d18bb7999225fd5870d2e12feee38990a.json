{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Desktop\\\\hotel_ai_assistant\\\\hotel_dashboard\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport useTranslations from './hooks/useTranslations';\nimport useStore from './store/useStore';\nimport { getDemoAuthToken } from './services/api';\nimport { wsService } from './services/websocket';\nimport './styles/tailwind.css';\nimport './App.css';\nimport Layout from './components/layout/Layout';\nimport EnterpriseDashboard from './components/dashboard/EnterpriseDashboard';\nimport LeadsCRM from './components/crm/LeadsCRM';\nimport FieldView from './components/features/FieldView';\nimport WhatsAppMonitor from './components/operator/WhatsAppMonitor';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst parseJwtPayload = token => {\n  try {\n    const payload = token.split('.')[1];\n    const normalized = payload.replace(/-/g, '+').replace(/_/g, '/');\n    const decoded = JSON.parse(atob(normalized));\n    return decoded || {};\n  } catch (error) {\n    return {};\n  }\n};\nfunction App() {\n  _s();\n  const {\n    lang,\n    activeTenantId,\n    authToken,\n    setAuthToken,\n    setActiveTenantId,\n    role,\n    hasHydrated,\n    setLang,\n    market\n  } = useStore();\n  const {\n    i18n\n  } = useTranslations();\n  const isRTL = lang === 'he';\n  const [activeView, setActiveView] = useState('dashboard');\n  const isClockInRoute = typeof window !== 'undefined' && window.location.pathname === '/clock-in';\n  useEffect(() => {\n    // Connect to WebSocket on mount\n    wsService.connect();\n    return () => {\n      wsService.disconnect();\n    };\n  }, []);\n  useEffect(() => {\n    const ensureAuth = async () => {\n      if (authToken) return;\n      const params = new URLSearchParams(window.location.search);\n      const tokenParam = params.get('token');\n      if (tokenParam) {\n        const payload = parseJwtPayload(tokenParam);\n        if (payload !== null && payload !== void 0 && payload.tenant_id) {\n          setActiveTenantId(payload.tenant_id);\n        }\n        setAuthToken(tokenParam);\n        params.delete('token');\n        const next = `${window.location.pathname}${params.toString() ? `?${params}` : ''}`;\n        window.history.replaceState({}, '', next);\n        return;\n      }\n      try {\n        const result = await getDemoAuthToken(activeTenantId);\n        setAuthToken(result.token);\n      } catch (error) {\n        console.error('Failed to obtain demo token:', error);\n      }\n    };\n    ensureAuth();\n  }, [activeTenantId, authToken, setAuthToken, setActiveTenantId]);\n  useEffect(() => {\n    i18n.changeLanguage(lang);\n    if (typeof document !== 'undefined') {\n      document.documentElement.dir = isRTL ? 'rtl' : 'ltr';\n      document.documentElement.lang = lang;\n    }\n  }, [i18n, isRTL, lang]);\n  useEffect(() => {\n    const marketKey = market === 'IL' ? 'IL' : 'US';\n    const allowed = marketKey === 'IL' ? ['he', 'th', 'hi'] : ['en', 'es'];\n    if (!allowed.includes(lang)) {\n      setLang(allowed[0]);\n    }\n  }, [market, lang, setLang]);\n  useEffect(() => {\n    const roleViews = {\n      host: ['dashboard', 'crm'],\n      operator: ['operator'],\n      field: ['field']\n    };\n    const allowed = roleViews[role] || ['dashboard'];\n    if (!allowed.includes(activeView)) {\n      setActiveView(allowed[0]);\n    }\n  }, [role, activeView]);\n  const renderRoleView = () => {\n    switch (role) {\n      case 'operator':\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(LeadsCRM, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(WhatsAppMonitor, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 13\n          }, this)]\n        }, \"operator-view\", true, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this);\n      case 'field':\n        return /*#__PURE__*/_jsxDEV(FieldView, {}, \"field-view\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 16\n        }, this);\n      case 'host':\n      default:\n        if (activeView === 'crm') return /*#__PURE__*/_jsxDEV(LeadsCRM, {}, \"host-crm\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 42\n        }, this);\n        return /*#__PURE__*/_jsxDEV(EnterpriseDashboard, {}, \"host-dashboard\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 16\n        }, this);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    dir: isRTL ? 'rtl' : 'ltr',\n    children: hasHydrated ? isClockInRoute ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"clockin-shell\",\n      children: /*#__PURE__*/_jsxDEV(FieldView, {\n        clockInOnly: true,\n        autoClockInOnScan: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }, this) : /*#__PURE__*/_jsxDEV(Layout, {\n      activeView: activeView,\n      setActiveView: setActiveView,\n      children: renderRoleView()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }, this) : null\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 114,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"2FFjKlyN3GB0A7xmrC+TlWarxt0=\", false, function () {\n  return [useStore, useTranslations];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useState","useTranslations","useStore","getDemoAuthToken","wsService","Layout","EnterpriseDashboard","LeadsCRM","FieldView","WhatsAppMonitor","jsxDEV","_jsxDEV","parseJwtPayload","token","payload","split","normalized","replace","decoded","JSON","parse","atob","error","App","_s","lang","activeTenantId","authToken","setAuthToken","setActiveTenantId","role","hasHydrated","setLang","market","i18n","isRTL","activeView","setActiveView","isClockInRoute","window","location","pathname","connect","disconnect","ensureAuth","params","URLSearchParams","search","tokenParam","get","tenant_id","delete","next","toString","history","replaceState","result","console","changeLanguage","document","documentElement","dir","marketKey","allowed","includes","roleViews","host","operator","field","renderRoleView","children","fileName","_jsxFileName","lineNumber","columnNumber","className","clockInOnly","autoClockInOnScan","_c","$RefreshReg$"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport useTranslations from './hooks/useTranslations';\nimport useStore from './store/useStore';\nimport { getDemoAuthToken } from './services/api';\nimport { wsService } from './services/websocket';\nimport './styles/tailwind.css';\nimport './App.css';\nimport Layout from './components/layout/Layout';\nimport EnterpriseDashboard from './components/dashboard/EnterpriseDashboard';\nimport LeadsCRM from './components/crm/LeadsCRM';\nimport FieldView from './components/features/FieldView';\nimport WhatsAppMonitor from './components/operator/WhatsAppMonitor';\n\nconst parseJwtPayload = (token) => {\n  try {\n    const payload = token.split('.')[1];\n    const normalized = payload.replace(/-/g, '+').replace(/_/g, '/');\n    const decoded = JSON.parse(atob(normalized));\n    return decoded || {};\n  } catch (error) {\n    return {};\n  }\n};\n\nfunction App() {\n  const { lang, activeTenantId, authToken, setAuthToken, setActiveTenantId, role, hasHydrated, setLang, market } = useStore();\n  const { i18n } = useTranslations();\n  const isRTL = lang === 'he';\n  const [activeView, setActiveView] = useState('dashboard');\n  const isClockInRoute = typeof window !== 'undefined' && window.location.pathname === '/clock-in';\n\n  useEffect(() => {\n    // Connect to WebSocket on mount\n    wsService.connect();\n    \n    return () => {\n      wsService.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    const ensureAuth = async () => {\n      if (authToken) return;\n      const params = new URLSearchParams(window.location.search);\n      const tokenParam = params.get('token');\n      if (tokenParam) {\n        const payload = parseJwtPayload(tokenParam);\n        if (payload?.tenant_id) {\n          setActiveTenantId(payload.tenant_id);\n        }\n        setAuthToken(tokenParam);\n        params.delete('token');\n        const next = `${window.location.pathname}${params.toString() ? `?${params}` : ''}`;\n        window.history.replaceState({}, '', next);\n        return;\n      }\n      try {\n        const result = await getDemoAuthToken(activeTenantId);\n        setAuthToken(result.token);\n      } catch (error) {\n        console.error('Failed to obtain demo token:', error);\n      }\n    };\n    ensureAuth();\n  }, [activeTenantId, authToken, setAuthToken, setActiveTenantId]);\n\n  useEffect(() => {\n    i18n.changeLanguage(lang);\n    if (typeof document !== 'undefined') {\n      document.documentElement.dir = isRTL ? 'rtl' : 'ltr';\n      document.documentElement.lang = lang;\n    }\n  }, [i18n, isRTL, lang]);\n\n  useEffect(() => {\n    const marketKey = market === 'IL' ? 'IL' : 'US';\n    const allowed = marketKey === 'IL' ? ['he', 'th', 'hi'] : ['en', 'es'];\n    if (!allowed.includes(lang)) {\n      setLang(allowed[0]);\n    }\n  }, [market, lang, setLang]);\n\n  useEffect(() => {\n    const roleViews = {\n      host: ['dashboard', 'crm'],\n      operator: ['operator'],\n      field: ['field'],\n    };\n    const allowed = roleViews[role] || ['dashboard'];\n    if (!allowed.includes(activeView)) {\n      setActiveView(allowed[0]);\n    }\n  }, [role, activeView]);\n\n  const renderRoleView = () => {\n    switch (role) {\n      case 'operator':\n        return (\n          <div key=\"operator-view\">\n            <LeadsCRM />\n            <WhatsAppMonitor />\n          </div>\n        );\n      case 'field':\n        return <FieldView key=\"field-view\" />;\n      case 'host':\n      default:\n        if (activeView === 'crm') return <LeadsCRM key=\"host-crm\" />;\n        return <EnterpriseDashboard key=\"host-dashboard\" />;\n    }\n  };\n\n  return (\n    <div dir={isRTL ? 'rtl' : 'ltr'}>\n      {hasHydrated ? (\n        isClockInRoute ? (\n          <div className=\"clockin-shell\">\n            <FieldView clockInOnly autoClockInOnScan />\n          </div>\n        ) : (\n          <Layout activeView={activeView} setActiveView={setActiveView}>\n            {renderRoleView()}\n          </Layout>\n        )\n      ) : null}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}