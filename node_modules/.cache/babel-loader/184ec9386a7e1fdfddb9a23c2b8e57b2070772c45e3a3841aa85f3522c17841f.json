{"ast":null,"code":"/**\n * Multi-Agent Orchestration System\n * Maya manages 5 specialized agents for hotel operations\n * Connected to properties DB and staff for guest queries and automation\n */\n\nimport { API_BASE_URL } from '../utils/constants';\nimport { getAIPropertyContext } from './api';\nimport i18n from '../i18n';\nconst getAuthHeaders = () => {\n  try {\n    var _parsed$state, _parsed$state2;\n    const raw = localStorage.getItem('hotel-enterprise-storage');\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    const token = parsed === null || parsed === void 0 ? void 0 : (_parsed$state = parsed.state) === null || _parsed$state === void 0 ? void 0 : _parsed$state.authToken;\n    const tenantId = parsed === null || parsed === void 0 ? void 0 : (_parsed$state2 = parsed.state) === null || _parsed$state2 === void 0 ? void 0 : _parsed$state2.activeTenantId;\n    const headers = {};\n    if (token) headers.Authorization = `Bearer ${token}`;\n    if (tenantId) headers['X-Tenant-Id'] = tenantId;\n    return headers;\n  } catch (error) {\n    return {};\n  }\n};\nconst MAYA_SYSTEM_PROMPT = `\nYou are Maya, the Senior Project Manager for Easy Host AI.\nBe proactive, decisive, and operations-focused. Monitor occupancy, leads,\nand operational status. Suggest actions before being asked and route work\nto the correct agent via function calls.\nYou have access to property details (guests, bedrooms, beds, bathrooms) and staff\nper property (e.g. cleaner Kobi, manager David) so you can answer guest queries\ncorrectly and know who to contact for automations.\n`.trim();\n\n// Agent Types\nexport const AGENT_TYPES = {\n  SCRAPER: 'scraper',\n  MARKETING: 'marketing',\n  CREATIVE: 'creative',\n  SALES: 'sales',\n  OPERATIONS: 'operations'\n};\n\n// Agent Status\nexport const AGENT_STATUS = {\n  ONLINE: 'online',\n  BUSY: 'busy',\n  OFFLINE: 'offline',\n  ERROR: 'error'\n};\n\n/**\n * Base Agent class\n */\nclass BaseAgent {\n  constructor(id, name, description) {\n    this.id = id;\n    this.name = name;\n    this.description = description;\n    this.status = AGENT_STATUS.ONLINE;\n    this.taskQueue = [];\n    this.completedTasks = [];\n  }\n  async execute(task) {\n    throw new Error('Execute method must be implemented');\n  }\n  getStatus() {\n    return this.status;\n  }\n  setStatus(status) {\n    this.status = status;\n  }\n}\n\n/**\n * Scraper Agent - Scans Airbnb/Booking for hot leads\n */\nexport class ScraperAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.SCRAPER, 'Scraper Agent', 'Scans Airbnb and Booking to discover high-intent leads');\n    this.leadsFound = 0;\n    this.lastScan = null;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      const leads = await this.scanPlatforms(task.platforms || ['airbnb', 'booking'], task.location);\n      this.leadsFound += leads.length;\n      this.lastScan = new Date().toISOString();\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return {\n        success: true,\n        leads,\n        timestamp: this.lastScan,\n        message: i18n.t('orchestrator.messages.leadsFound', {\n          count: leads.length\n        })\n      };\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async scanPlatforms(platforms, location = 'Greece') {\n    const response = await fetch(`${API_BASE_URL}/api/agents/scout/scan`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeaders()\n      },\n      body: JSON.stringify({\n        platforms,\n        location\n      })\n    });\n    if (!response.ok) {\n      throw new Error('Failed to scan platforms');\n    }\n    const data = await response.json();\n    return data.leads || [];\n  }\n}\n\n/**\n * Marketing Agent - Creates social media posts and email campaigns\n */\nexport class MarketingAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.MARKETING, 'Marketing Agent', 'Creates social posts and email campaigns');\n    this.postsCreated = 0;\n    this.campaignsSent = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'social_post':\n          result = await this.createSocialPost(task.content);\n          this.postsCreated++;\n          break;\n        case 'email_campaign':\n          result = await this.createEmailCampaign(task.campaign);\n          this.campaignsSent++;\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async createSocialPost(content) {\n    await new Promise(r => setTimeout(r, 1000));\n    return {\n      success: true,\n      post: {\n        id: Date.now(),\n        content: content.text,\n        platforms: content.platforms || ['instagram', 'facebook'],\n        scheduledFor: content.scheduledFor || new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.postCreated')\n    };\n  }\n  async createEmailCampaign(campaign) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      campaign: {\n        id: Date.now(),\n        subject: campaign.subject,\n        recipients: campaign.recipients || 500,\n        sentAt: new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.campaignSent', {\n        count: campaign.recipients || 500\n      })\n    };\n  }\n}\n\n/**\n * Creative Agent - Auto-edits videos/images for property presentation\n */\nexport class CreativeAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.CREATIVE, 'Creative Agent', 'Edits videos and images for property presentation');\n    this.assetsCreated = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'edit_video':\n          result = await this.editVideo(task.video);\n          break;\n        case 'enhance_images':\n          result = await this.enhanceImages(task.images);\n          break;\n        case 'create_virtual_tour':\n          result = await this.createVirtualTour(task.property);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.assetsCreated++;\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async editVideo(video) {\n    await new Promise(r => setTimeout(r, 3000));\n    return {\n      success: true,\n      video: {\n        id: Date.now(),\n        originalUrl: video.url,\n        editedUrl: video.url + '?edited=true',\n        duration: '2:30'\n      },\n      message: i18n.t('orchestrator.messages.videoEdited')\n    };\n  }\n  async enhanceImages(images) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      images: images.map((img, i) => ({\n        id: Date.now() + i,\n        originalUrl: img,\n        enhancedUrl: img + '?enhanced=true'\n      })),\n      message: i18n.t('orchestrator.messages.imagesEnhanced', {\n        count: images.length\n      })\n    };\n  }\n  async createVirtualTour(property) {\n    await new Promise(r => setTimeout(r, 5000));\n    return {\n      success: true,\n      tour: {\n        id: Date.now(),\n        propertyId: property.id,\n        tourUrl: `https://tours.hotel.ai/${property.id}`\n      },\n      message: i18n.t('orchestrator.messages.tourCreated')\n    };\n  }\n}\n\n/**\n * Sales Manager Agent - Manages initial negotiations and sends demos\n */\nexport class SalesAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.SALES, 'Sales Manager Agent', 'Handles early negotiations and sends demos');\n    this.dealsInProgress = 0;\n    this.dealsClosedToday = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'send_demo':\n          result = await this.sendDemo(task.lead);\n          break;\n        case 'negotiate':\n          result = await this.handleNegotiation(task.deal);\n          break;\n        case 'follow_up':\n          result = await this.followUp(task.leadId);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async sendDemo(lead) {\n    await new Promise(r => setTimeout(r, 1500));\n    this.dealsInProgress++;\n    return {\n      success: true,\n      demo: {\n        id: Date.now(),\n        leadId: lead.id,\n        demoUrl: `https://demo.hotel.ai/${lead.id}`,\n        sentAt: new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.demoSent', {\n        name: lead.name || 'Lead'\n      })\n    };\n  }\n  async handleNegotiation(deal) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      negotiation: {\n        id: Date.now(),\n        dealId: deal.id,\n        stage: 'proposal_sent',\n        nextAction: 'await_response'\n      },\n      message: i18n.t('orchestrator.messages.negotiationStarted')\n    };\n  }\n  async followUp(leadId) {\n    await new Promise(r => setTimeout(r, 1000));\n    return {\n      success: true,\n      followUp: {\n        leadId,\n        sentAt: new Date().toISOString(),\n        type: 'email'\n      },\n      message: i18n.t('orchestrator.messages.followUpSent')\n    };\n  }\n}\n\n/**\n * Operations Agent - Sends WhatsApp messages to staff for cleaning, maintenance, etc.\n */\nexport class OperationsAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.OPERATIONS, 'Operations Agent', 'Sends WhatsApp messages to staff for operational requests');\n    this.messagesSent = 0;\n    this.tasksAssigned = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'request_towels':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'request_cleaning':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'maintenance_request':\n          result = await this.sendStaffMessage('maintenance', task);\n          break;\n        case 'room_service':\n          result = await this.sendStaffMessage('room_service', task);\n          break;\n        case 'guest_checkout':\n          result = await this.handleCheckout(task);\n          break;\n        default:\n          result = await this.sendStaffMessage('general', task);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async sendStaffMessage(department, task) {\n    await new Promise(r => setTimeout(r, 800));\n    this.messagesSent++;\n    this.tasksAssigned++;\n\n    // In production, this would call Twilio/Meta WhatsApp API\n    const message = this.generateMessage(department, task);\n    return {\n      success: true,\n      message: {\n        id: Date.now(),\n        department,\n        room: task.room,\n        content: message,\n        sentAt: new Date().toISOString(),\n        status: 'delivered'\n      },\n      displayMessage: i18n.t('orchestrator.messages.whatsappSent', {\n        department\n      })\n    };\n  }\n  generateMessage(department, task) {\n    const messages = {\n      housekeeping: `üè® ◊ë◊ß◊©◊î ◊ó◊ì◊©◊î ◊û◊ó◊ì◊® ${task.room}\\n\\n${task.description || '◊û◊í◊ë◊ï◊™ ◊†◊ì◊®◊©◊ï◊™'}\\n\\n‚è∞ ◊ê◊†◊ê ◊ò◊§◊ú ◊ë◊î◊ß◊ì◊ù ◊î◊ê◊§◊©◊®◊ô`,\n      maintenance: `üîß ◊™◊ó◊ñ◊ï◊ß◊î ◊†◊ì◊®◊©◊™ ◊ë◊ó◊ì◊® ${task.room}\\n\\n${task.description || '◊ë◊¢◊ô◊î ◊ò◊õ◊†◊ô◊™'}\\n\\n‚ö†Ô∏è ◊ì◊ó◊ô◊§◊ï◊™: ${task.priority || '◊®◊í◊ô◊ú◊î'}`,\n      room_service: `üçΩÔ∏è ◊î◊ñ◊û◊†◊™ ◊©◊ô◊®◊ï◊™ ◊ó◊ì◊®◊ô◊ù\\n\\n◊ó◊ì◊®: ${task.room}\\n${task.order || ''}\\n\\n‚è∞ ◊ñ◊û◊ü ◊û◊©◊ú◊ï◊ó ◊û◊ë◊ï◊ß◊©: ${task.deliveryTime || '◊ë◊î◊ß◊ì◊ù'}`,\n      general: `üìã ◊ë◊ß◊©◊î ◊ó◊ì◊©◊î ◊û◊ó◊ì◊® ${task.room}\\n\\n${task.description || '◊ë◊ß◊©◊™ ◊ê◊ï◊®◊ó'}`\n    };\n    return messages[department] || messages.general;\n  }\n  async handleCheckout(task) {\n    await new Promise(r => setTimeout(r, 1000));\n\n    // Send multiple messages for checkout process\n    await this.sendStaffMessage('housekeeping', {\n      room: task.room,\n      description: '◊†◊ô◊ß◊ô◊ï◊ü ◊ú◊ê◊ó◊® ◊¶\\'◊ß-◊ê◊ê◊ï◊ò',\n      priority: '◊í◊ë◊ï◊î◊î'\n    });\n    return {\n      success: true,\n      checkout: {\n        room: task.room,\n        guestName: task.guestName,\n        processedAt: new Date().toISOString()\n      },\n      displayMessage: i18n.t('orchestrator.messages.checkoutDone', {\n        room: task.room\n      })\n    };\n  }\n}\n\n/**\n * Maya - The Master Orchestrator\n * Manages all agents and handles high-level decisions\n */\nclass MayaOrchestrator {\n  constructor() {\n    this.agents = {\n      [AGENT_TYPES.SCRAPER]: new ScraperAgent(),\n      [AGENT_TYPES.MARKETING]: new MarketingAgent(),\n      [AGENT_TYPES.CREATIVE]: new CreativeAgent(),\n      [AGENT_TYPES.SALES]: new SalesAgent(),\n      [AGENT_TYPES.OPERATIONS]: new OperationsAgent()\n    };\n    this.taskHistory = [];\n    this.isProcessing = false;\n    this.systemPrompt = MAYA_SYSTEM_PROMPT;\n  }\n\n  /**\n   * Execute a task using the appropriate agent\n   */\n  async executeTask(agentType, task) {\n    const agent = this.agents[agentType];\n    if (!agent) {\n      throw new Error(`Agent ${agentType} not found`);\n    }\n    const taskRecord = {\n      id: Date.now(),\n      agentType,\n      task,\n      startedAt: new Date().toISOString(),\n      status: 'running'\n    };\n    this.taskHistory.push(taskRecord);\n    try {\n      const result = await agent.execute(task);\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'completed';\n      taskRecord.result = result;\n      return result;\n    } catch (error) {\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'failed';\n      taskRecord.error = error.message;\n      throw error;\n    }\n  }\n\n  /**\n   * Get all agent statuses\n   */\n  getAgentStatuses() {\n    return Object.entries(this.agents).reduce((acc, [type, agent]) => {\n      acc[type] = {\n        status: agent.status,\n        name: agent.name,\n        description: agent.description\n      };\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Fetch property context (details + staff) for AI to answer guest queries\n   */\n  async getPropertyContext() {\n    try {\n      var _ctx$properties;\n      const ctx = await getAIPropertyContext();\n      return ctx.summary_for_ai || (_ctx$properties = ctx.properties) !== null && _ctx$properties !== void 0 && _ctx$properties.length ? `Property context: ${ctx.summary_for_ai || 'No details.'}` : '';\n    } catch (e) {\n      return '';\n    }\n  }\n\n  /**\n   * Process natural language command from Maya chat\n   */\n  async processCommand(command) {\n    const lowerCommand = command.toLowerCase();\n    const propertyContext = await this.getPropertyContext();\n\n    // Detect intent and route to appropriate agent\n    if (lowerCommand.includes('lead') || lowerCommand.includes('scan') || lowerCommand.includes('airbnb') || lowerCommand.includes('◊ú◊ô◊ì') || lowerCommand.includes('◊°◊®◊ô◊ß◊î')) {\n      return await this.executeTask(AGENT_TYPES.SCRAPER, {\n        platforms: ['airbnb', 'booking']\n      });\n    }\n    if (lowerCommand.includes('post') || lowerCommand.includes('marketing') || lowerCommand.includes('campaign') || lowerCommand.includes('◊§◊ï◊°◊ò') || lowerCommand.includes('◊©◊ô◊ï◊ï◊ß') || lowerCommand.includes('◊ß◊û◊§◊ô◊ô◊ü')) {\n      return await this.executeTask(AGENT_TYPES.MARKETING, {\n        type: 'social_post',\n        content: {\n          text: 'New hotel post',\n          platforms: ['instagram', 'facebook']\n        }\n      });\n    }\n    if (lowerCommand.includes('video') || lowerCommand.includes('image') || lowerCommand.includes('edit') || lowerCommand.includes('◊ï◊ô◊ì◊ê◊ï') || lowerCommand.includes('◊™◊û◊ï◊†') || lowerCommand.includes('◊¢◊®◊ô◊õ◊î')) {\n      return await this.executeTask(AGENT_TYPES.CREATIVE, {\n        type: 'enhance_images',\n        images: ['https://example.com/room1.jpg']\n      });\n    }\n    if (lowerCommand.includes('demo') || lowerCommand.includes('deal') || lowerCommand.includes('sales') || lowerCommand.includes('◊ì◊û◊ï') || lowerCommand.includes('◊û◊õ◊ô◊®') || lowerCommand.includes('◊¢◊°◊ß◊î')) {\n      return await this.executeTask(AGENT_TYPES.SALES, {\n        type: 'send_demo',\n        lead: {\n          id: Date.now(),\n          name: 'New lead'\n        }\n      });\n    }\n    if (lowerCommand.includes('towel') || lowerCommand.includes('clean') || lowerCommand.includes('maintenance') || lowerCommand.includes('room') || lowerCommand.includes('◊û◊í◊ë◊™') || lowerCommand.includes('◊†◊ô◊ß◊ô◊ï◊ü') || lowerCommand.includes('◊™◊ó◊ñ◊ï◊ß◊î') || lowerCommand.includes('◊ó◊ì◊®')) {\n      const roomMatch = command.match(/\\d+/);\n      const room = roomMatch ? roomMatch[0] : '101';\n      const ctx = await getAIPropertyContext();\n      const staffList = ctx.staff_by_property ? Object.values(ctx.staff_by_property).flat() : [];\n      return await this.executeTask(AGENT_TYPES.OPERATIONS, {\n        type: 'request_towels',\n        room,\n        description: command,\n        propertyContext,\n        staff: staffList\n      });\n    }\n    if (lowerCommand.includes('property') || lowerCommand.includes('villa') || lowerCommand.includes('◊†◊õ◊°') || lowerCommand.includes('◊ï◊ï◊ô◊ú◊î') || lowerCommand.includes('guests') || lowerCommand.includes('◊ê◊ï◊®◊ó◊ô◊ù') || lowerCommand.includes('bedroom') || lowerCommand.includes('◊ó◊ì◊®')) {\n      const ctx = await getAIPropertyContext();\n      const summary = ctx.summary_for_ai || 'No properties in database.';\n      return {\n        success: true,\n        message: summary,\n        displayMessage: i18n.t('orchestrator.messages.unknown')\n      };\n    }\n\n    // Default response\n    return {\n      success: true,\n      message: i18n.t('orchestrator.messages.unknown')\n    };\n  }\n\n  /**\n   * Get task history\n   */\n  getTaskHistory(limit = 50) {\n    return this.taskHistory.slice(-limit).reverse();\n  }\n\n  /**\n   * Generate daily report\n   */\n  async generateDailyReport() {\n    const response = await fetch(`${API_BASE_URL}/api/reports/daily`, {\n      headers: {\n        ...getAuthHeaders()\n      }\n    });\n    if (!response.ok) {\n      throw new Error('Failed to generate report');\n    }\n    const data = await response.json();\n    return data.report || data;\n  }\n}\n\n// Singleton instance\nexport const maya = new MayaOrchestrator();\nexport default maya;","map":{"version":3,"names":["API_BASE_URL","getAIPropertyContext","i18n","getAuthHeaders","_parsed$state","_parsed$state2","raw","localStorage","getItem","parsed","JSON","parse","token","state","authToken","tenantId","activeTenantId","headers","Authorization","error","MAYA_SYSTEM_PROMPT","trim","AGENT_TYPES","SCRAPER","MARKETING","CREATIVE","SALES","OPERATIONS","AGENT_STATUS","ONLINE","BUSY","OFFLINE","ERROR","BaseAgent","constructor","id","name","description","status","taskQueue","completedTasks","execute","task","Error","getStatus","setStatus","ScraperAgent","leadsFound","lastScan","leads","scanPlatforms","platforms","location","length","Date","toISOString","success","timestamp","message","t","count","response","fetch","method","body","stringify","ok","data","json","MarketingAgent","postsCreated","campaignsSent","result","type","createSocialPost","content","createEmailCampaign","campaign","Promise","r","setTimeout","post","now","text","scheduledFor","subject","recipients","sentAt","CreativeAgent","assetsCreated","editVideo","video","enhanceImages","images","createVirtualTour","property","originalUrl","url","editedUrl","duration","map","img","i","enhancedUrl","tour","propertyId","tourUrl","SalesAgent","dealsInProgress","dealsClosedToday","sendDemo","lead","handleNegotiation","deal","followUp","leadId","demo","demoUrl","negotiation","dealId","stage","nextAction","OperationsAgent","messagesSent","tasksAssigned","sendStaffMessage","handleCheckout","department","generateMessage","room","displayMessage","messages","housekeeping","maintenance","priority","room_service","order","deliveryTime","general","checkout","guestName","processedAt","MayaOrchestrator","agents","taskHistory","isProcessing","systemPrompt","executeTask","agentType","agent","taskRecord","startedAt","push","completedAt","getAgentStatuses","Object","entries","reduce","acc","getPropertyContext","_ctx$properties","ctx","summary_for_ai","properties","e","processCommand","command","lowerCommand","toLowerCase","propertyContext","includes","roomMatch","match","staffList","staff_by_property","values","flat","staff","summary","getTaskHistory","limit","slice","reverse","generateDailyReport","report","maya"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/services/agentOrchestrator.js"],"sourcesContent":["/**\n * Multi-Agent Orchestration System\n * Maya manages 5 specialized agents for hotel operations\n * Connected to properties DB and staff for guest queries and automation\n */\n\nimport { API_BASE_URL } from '../utils/constants';\nimport { getAIPropertyContext } from './api';\nimport i18n from '../i18n';\n\nconst getAuthHeaders = () => {\n  try {\n    const raw = localStorage.getItem('hotel-enterprise-storage');\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    const token = parsed?.state?.authToken;\n    const tenantId = parsed?.state?.activeTenantId;\n    const headers = {};\n    if (token) headers.Authorization = `Bearer ${token}`;\n    if (tenantId) headers['X-Tenant-Id'] = tenantId;\n    return headers;\n  } catch (error) {\n    return {};\n  }\n};\n\nconst MAYA_SYSTEM_PROMPT = `\nYou are Maya, the Senior Project Manager for Easy Host AI.\nBe proactive, decisive, and operations-focused. Monitor occupancy, leads,\nand operational status. Suggest actions before being asked and route work\nto the correct agent via function calls.\nYou have access to property details (guests, bedrooms, beds, bathrooms) and staff\nper property (e.g. cleaner Kobi, manager David) so you can answer guest queries\ncorrectly and know who to contact for automations.\n`.trim();\n\n// Agent Types\nexport const AGENT_TYPES = {\n  SCRAPER: 'scraper',\n  MARKETING: 'marketing',\n  CREATIVE: 'creative',\n  SALES: 'sales',\n  OPERATIONS: 'operations',\n};\n\n// Agent Status\nexport const AGENT_STATUS = {\n  ONLINE: 'online',\n  BUSY: 'busy',\n  OFFLINE: 'offline',\n  ERROR: 'error',\n};\n\n/**\n * Base Agent class\n */\nclass BaseAgent {\n  constructor(id, name, description) {\n    this.id = id;\n    this.name = name;\n    this.description = description;\n    this.status = AGENT_STATUS.ONLINE;\n    this.taskQueue = [];\n    this.completedTasks = [];\n  }\n\n  async execute(task) {\n    throw new Error('Execute method must be implemented');\n  }\n\n  getStatus() {\n    return this.status;\n  }\n\n  setStatus(status) {\n    this.status = status;\n  }\n}\n\n/**\n * Scraper Agent - Scans Airbnb/Booking for hot leads\n */\nexport class ScraperAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.SCRAPER,\n      'Scraper Agent',\n      'Scans Airbnb and Booking to discover high-intent leads'\n    );\n    this.leadsFound = 0;\n    this.lastScan = null;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      const leads = await this.scanPlatforms(task.platforms || ['airbnb', 'booking'], task.location);\n      \n      this.leadsFound += leads.length;\n      this.lastScan = new Date().toISOString();\n      this.setStatus(AGENT_STATUS.ONLINE);\n      \n      return {\n        success: true,\n        leads,\n        timestamp: this.lastScan,\n        message: i18n.t('orchestrator.messages.leadsFound', { count: leads.length }),\n      };\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async scanPlatforms(platforms, location = 'Greece') {\n    const response = await fetch(`${API_BASE_URL}/api/agents/scout/scan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', ...getAuthHeaders() },\n      body: JSON.stringify({ platforms, location }),\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to scan platforms');\n    }\n\n    const data = await response.json();\n    return data.leads || [];\n  }\n}\n\n/**\n * Marketing Agent - Creates social media posts and email campaigns\n */\nexport class MarketingAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.MARKETING,\n      'Marketing Agent',\n      'Creates social posts and email campaigns'\n    );\n    this.postsCreated = 0;\n    this.campaignsSent = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'social_post':\n          result = await this.createSocialPost(task.content);\n          this.postsCreated++;\n          break;\n        case 'email_campaign':\n          result = await this.createEmailCampaign(task.campaign);\n          this.campaignsSent++;\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async createSocialPost(content) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    return {\n      success: true,\n      post: {\n        id: Date.now(),\n        content: content.text,\n        platforms: content.platforms || ['instagram', 'facebook'],\n        scheduledFor: content.scheduledFor || new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.postCreated'),\n    };\n  }\n\n  async createEmailCampaign(campaign) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      campaign: {\n        id: Date.now(),\n        subject: campaign.subject,\n        recipients: campaign.recipients || 500,\n        sentAt: new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.campaignSent', { count: campaign.recipients || 500 }),\n    };\n  }\n}\n\n/**\n * Creative Agent - Auto-edits videos/images for property presentation\n */\nexport class CreativeAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.CREATIVE,\n      'Creative Agent',\n      'Edits videos and images for property presentation'\n    );\n    this.assetsCreated = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'edit_video':\n          result = await this.editVideo(task.video);\n          break;\n        case 'enhance_images':\n          result = await this.enhanceImages(task.images);\n          break;\n        case 'create_virtual_tour':\n          result = await this.createVirtualTour(task.property);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.assetsCreated++;\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async editVideo(video) {\n    await new Promise((r) => setTimeout(r, 3000));\n    \n    return {\n      success: true,\n      video: {\n        id: Date.now(),\n        originalUrl: video.url,\n        editedUrl: video.url + '?edited=true',\n        duration: '2:30',\n      },\n      message: i18n.t('orchestrator.messages.videoEdited'),\n    };\n  }\n\n  async enhanceImages(images) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      images: images.map((img, i) => ({\n        id: Date.now() + i,\n        originalUrl: img,\n        enhancedUrl: img + '?enhanced=true',\n      })),\n      message: i18n.t('orchestrator.messages.imagesEnhanced', { count: images.length }),\n    };\n  }\n\n  async createVirtualTour(property) {\n    await new Promise((r) => setTimeout(r, 5000));\n    \n    return {\n      success: true,\n      tour: {\n        id: Date.now(),\n        propertyId: property.id,\n        tourUrl: `https://tours.hotel.ai/${property.id}`,\n      },\n      message: i18n.t('orchestrator.messages.tourCreated'),\n    };\n  }\n}\n\n/**\n * Sales Manager Agent - Manages initial negotiations and sends demos\n */\nexport class SalesAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.SALES,\n      'Sales Manager Agent',\n      'Handles early negotiations and sends demos'\n    );\n    this.dealsInProgress = 0;\n    this.dealsClosedToday = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'send_demo':\n          result = await this.sendDemo(task.lead);\n          break;\n        case 'negotiate':\n          result = await this.handleNegotiation(task.deal);\n          break;\n        case 'follow_up':\n          result = await this.followUp(task.leadId);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async sendDemo(lead) {\n    await new Promise((r) => setTimeout(r, 1500));\n    \n    this.dealsInProgress++;\n    \n    return {\n      success: true,\n      demo: {\n        id: Date.now(),\n        leadId: lead.id,\n        demoUrl: `https://demo.hotel.ai/${lead.id}`,\n        sentAt: new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.demoSent', { name: lead.name || 'Lead' }),\n    };\n  }\n\n  async handleNegotiation(deal) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      negotiation: {\n        id: Date.now(),\n        dealId: deal.id,\n        stage: 'proposal_sent',\n        nextAction: 'await_response',\n      },\n      message: i18n.t('orchestrator.messages.negotiationStarted'),\n    };\n  }\n\n  async followUp(leadId) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    return {\n      success: true,\n      followUp: {\n        leadId,\n        sentAt: new Date().toISOString(),\n        type: 'email',\n      },\n      message: i18n.t('orchestrator.messages.followUpSent'),\n    };\n  }\n}\n\n/**\n * Operations Agent - Sends WhatsApp messages to staff for cleaning, maintenance, etc.\n */\nexport class OperationsAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.OPERATIONS,\n      'Operations Agent',\n      'Sends WhatsApp messages to staff for operational requests'\n    );\n    this.messagesSent = 0;\n    this.tasksAssigned = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'request_towels':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'request_cleaning':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'maintenance_request':\n          result = await this.sendStaffMessage('maintenance', task);\n          break;\n        case 'room_service':\n          result = await this.sendStaffMessage('room_service', task);\n          break;\n        case 'guest_checkout':\n          result = await this.handleCheckout(task);\n          break;\n        default:\n          result = await this.sendStaffMessage('general', task);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async sendStaffMessage(department, task) {\n    await new Promise((r) => setTimeout(r, 800));\n    \n    this.messagesSent++;\n    this.tasksAssigned++;\n    \n    // In production, this would call Twilio/Meta WhatsApp API\n    const message = this.generateMessage(department, task);\n    \n    return {\n      success: true,\n      message: {\n        id: Date.now(),\n        department,\n        room: task.room,\n        content: message,\n        sentAt: new Date().toISOString(),\n        status: 'delivered',\n      },\n      displayMessage: i18n.t('orchestrator.messages.whatsappSent', { department }),\n    };\n  }\n\n  generateMessage(department, task) {\n    const messages = {\n      housekeeping: `üè® ◊ë◊ß◊©◊î ◊ó◊ì◊©◊î ◊û◊ó◊ì◊® ${task.room}\\n\\n${task.description || '◊û◊í◊ë◊ï◊™ ◊†◊ì◊®◊©◊ï◊™'}\\n\\n‚è∞ ◊ê◊†◊ê ◊ò◊§◊ú ◊ë◊î◊ß◊ì◊ù ◊î◊ê◊§◊©◊®◊ô`,\n      maintenance: `üîß ◊™◊ó◊ñ◊ï◊ß◊î ◊†◊ì◊®◊©◊™ ◊ë◊ó◊ì◊® ${task.room}\\n\\n${task.description || '◊ë◊¢◊ô◊î ◊ò◊õ◊†◊ô◊™'}\\n\\n‚ö†Ô∏è ◊ì◊ó◊ô◊§◊ï◊™: ${task.priority || '◊®◊í◊ô◊ú◊î'}`,\n      room_service: `üçΩÔ∏è ◊î◊ñ◊û◊†◊™ ◊©◊ô◊®◊ï◊™ ◊ó◊ì◊®◊ô◊ù\\n\\n◊ó◊ì◊®: ${task.room}\\n${task.order || ''}\\n\\n‚è∞ ◊ñ◊û◊ü ◊û◊©◊ú◊ï◊ó ◊û◊ë◊ï◊ß◊©: ${task.deliveryTime || '◊ë◊î◊ß◊ì◊ù'}`,\n      general: `üìã ◊ë◊ß◊©◊î ◊ó◊ì◊©◊î ◊û◊ó◊ì◊® ${task.room}\\n\\n${task.description || '◊ë◊ß◊©◊™ ◊ê◊ï◊®◊ó'}`,\n    };\n    \n    return messages[department] || messages.general;\n  }\n\n  async handleCheckout(task) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    // Send multiple messages for checkout process\n    await this.sendStaffMessage('housekeeping', {\n      room: task.room,\n      description: '◊†◊ô◊ß◊ô◊ï◊ü ◊ú◊ê◊ó◊® ◊¶\\'◊ß-◊ê◊ê◊ï◊ò',\n      priority: '◊í◊ë◊ï◊î◊î',\n    });\n    \n    return {\n      success: true,\n      checkout: {\n        room: task.room,\n        guestName: task.guestName,\n        processedAt: new Date().toISOString(),\n      },\n      displayMessage: i18n.t('orchestrator.messages.checkoutDone', { room: task.room }),\n    };\n  }\n}\n\n/**\n * Maya - The Master Orchestrator\n * Manages all agents and handles high-level decisions\n */\nclass MayaOrchestrator {\n  constructor() {\n    this.agents = {\n      [AGENT_TYPES.SCRAPER]: new ScraperAgent(),\n      [AGENT_TYPES.MARKETING]: new MarketingAgent(),\n      [AGENT_TYPES.CREATIVE]: new CreativeAgent(),\n      [AGENT_TYPES.SALES]: new SalesAgent(),\n      [AGENT_TYPES.OPERATIONS]: new OperationsAgent(),\n    };\n    \n    this.taskHistory = [];\n    this.isProcessing = false;\n    this.systemPrompt = MAYA_SYSTEM_PROMPT;\n  }\n\n  /**\n   * Execute a task using the appropriate agent\n   */\n  async executeTask(agentType, task) {\n    const agent = this.agents[agentType];\n    \n    if (!agent) {\n      throw new Error(`Agent ${agentType} not found`);\n    }\n    \n    const taskRecord = {\n      id: Date.now(),\n      agentType,\n      task,\n      startedAt: new Date().toISOString(),\n      status: 'running',\n    };\n    \n    this.taskHistory.push(taskRecord);\n    \n    try {\n      const result = await agent.execute(task);\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'completed';\n      taskRecord.result = result;\n      return result;\n    } catch (error) {\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'failed';\n      taskRecord.error = error.message;\n      throw error;\n    }\n  }\n\n  /**\n   * Get all agent statuses\n   */\n  getAgentStatuses() {\n    return Object.entries(this.agents).reduce((acc, [type, agent]) => {\n      acc[type] = {\n        status: agent.status,\n        name: agent.name,\n        description: agent.description,\n      };\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Fetch property context (details + staff) for AI to answer guest queries\n   */\n  async getPropertyContext() {\n    try {\n      const ctx = await getAIPropertyContext();\n      return ctx.summary_for_ai || ctx.properties?.length\n        ? `Property context: ${ctx.summary_for_ai || 'No details.'}`\n        : '';\n    } catch (e) {\n      return '';\n    }\n  }\n\n  /**\n   * Process natural language command from Maya chat\n   */\n  async processCommand(command) {\n    const lowerCommand = command.toLowerCase();\n    const propertyContext = await this.getPropertyContext();\n    \n    // Detect intent and route to appropriate agent\n    if (lowerCommand.includes('lead') || lowerCommand.includes('scan') || lowerCommand.includes('airbnb') || lowerCommand.includes('◊ú◊ô◊ì') || lowerCommand.includes('◊°◊®◊ô◊ß◊î')) {\n      return await this.executeTask(AGENT_TYPES.SCRAPER, { platforms: ['airbnb', 'booking'] });\n    }\n    \n    if (lowerCommand.includes('post') || lowerCommand.includes('marketing') || lowerCommand.includes('campaign') || lowerCommand.includes('◊§◊ï◊°◊ò') || lowerCommand.includes('◊©◊ô◊ï◊ï◊ß') || lowerCommand.includes('◊ß◊û◊§◊ô◊ô◊ü')) {\n      return await this.executeTask(AGENT_TYPES.MARKETING, {\n        type: 'social_post',\n        content: { text: 'New hotel post', platforms: ['instagram', 'facebook'] },\n      });\n    }\n    \n    if (lowerCommand.includes('video') || lowerCommand.includes('image') || lowerCommand.includes('edit') || lowerCommand.includes('◊ï◊ô◊ì◊ê◊ï') || lowerCommand.includes('◊™◊û◊ï◊†') || lowerCommand.includes('◊¢◊®◊ô◊õ◊î')) {\n      return await this.executeTask(AGENT_TYPES.CREATIVE, {\n        type: 'enhance_images',\n        images: ['https://example.com/room1.jpg'],\n      });\n    }\n    \n    if (lowerCommand.includes('demo') || lowerCommand.includes('deal') || lowerCommand.includes('sales') || lowerCommand.includes('◊ì◊û◊ï') || lowerCommand.includes('◊û◊õ◊ô◊®') || lowerCommand.includes('◊¢◊°◊ß◊î')) {\n      return await this.executeTask(AGENT_TYPES.SALES, {\n        type: 'send_demo',\n        lead: { id: Date.now(), name: 'New lead' },\n      });\n    }\n    \n    if (lowerCommand.includes('towel') || lowerCommand.includes('clean') || lowerCommand.includes('maintenance') || lowerCommand.includes('room') || lowerCommand.includes('◊û◊í◊ë◊™') || lowerCommand.includes('◊†◊ô◊ß◊ô◊ï◊ü') || lowerCommand.includes('◊™◊ó◊ñ◊ï◊ß◊î') || lowerCommand.includes('◊ó◊ì◊®')) {\n      const roomMatch = command.match(/\\d+/);\n      const room = roomMatch ? roomMatch[0] : '101';\n      const ctx = await getAIPropertyContext();\n      const staffList = ctx.staff_by_property\n        ? Object.values(ctx.staff_by_property).flat()\n        : [];\n      \n      return await this.executeTask(AGENT_TYPES.OPERATIONS, {\n        type: 'request_towels',\n        room,\n        description: command,\n        propertyContext,\n        staff: staffList,\n      });\n    }\n    \n    if (lowerCommand.includes('property') || lowerCommand.includes('villa') || lowerCommand.includes('◊†◊õ◊°') || lowerCommand.includes('◊ï◊ï◊ô◊ú◊î') || lowerCommand.includes('guests') || lowerCommand.includes('◊ê◊ï◊®◊ó◊ô◊ù') || lowerCommand.includes('bedroom') || lowerCommand.includes('◊ó◊ì◊®')) {\n      const ctx = await getAIPropertyContext();\n      const summary = ctx.summary_for_ai || 'No properties in database.';\n      return {\n        success: true,\n        message: summary,\n        displayMessage: i18n.t('orchestrator.messages.unknown'),\n      };\n    }\n    \n    // Default response\n    return {\n      success: true,\n      message: i18n.t('orchestrator.messages.unknown'),\n    };\n  }\n\n  /**\n   * Get task history\n   */\n  getTaskHistory(limit = 50) {\n    return this.taskHistory.slice(-limit).reverse();\n  }\n\n  /**\n   * Generate daily report\n   */\n  async generateDailyReport() {\n    const response = await fetch(`${API_BASE_URL}/api/reports/daily`, {\n      headers: { ...getAuthHeaders() },\n    });\n    if (!response.ok) {\n      throw new Error('Failed to generate report');\n    }\n    const data = await response.json();\n    return data.report || data;\n  }\n}\n\n// Singleton instance\nexport const maya = new MayaOrchestrator();\n\nexport default maya;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}