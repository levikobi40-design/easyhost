{"ast":null,"code":"var _MAYA_AI_RULES$STAFF_;\n/**\n * Multi-Agent Orchestration System\n * Maya manages 5 specialized agents for hotel operations\n * Connected to properties DB and staff for guest queries and automation\n */\n\nimport { API_BASE_URL } from '../utils/constants';\nimport { getAIPropertyContext, createPropertyTask, sendMayaCommand, getPropertyTasks } from './api';\nimport useStore from '../store/useStore';\nimport { MAYA_AI_RULES } from '../config/mayaRules';\nimport i18n from '../i18n';\nconst getAuthHeaders = () => {\n  try {\n    var _parsed$state, _parsed$state2;\n    const raw = localStorage.getItem('hotel-enterprise-storage');\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    const token = parsed === null || parsed === void 0 ? void 0 : (_parsed$state = parsed.state) === null || _parsed$state === void 0 ? void 0 : _parsed$state.authToken;\n    const tenantId = parsed === null || parsed === void 0 ? void 0 : (_parsed$state2 = parsed.state) === null || _parsed$state2 === void 0 ? void 0 : _parsed$state2.activeTenantId;\n    const headers = {};\n    if (token) headers.Authorization = `Bearer ${token}`;\n    if (tenantId) headers['X-Tenant-Id'] = tenantId;\n    return headers;\n  } catch (error) {\n    return {};\n  }\n};\nconst MAYA_SYSTEM_PROMPT = `\nYou are Maya, the Senior Project Manager for Easy Host AI.\nBe proactive, decisive, and operations-focused. Monitor occupancy, leads,\nand operational status. Suggest actions before being asked and route work\nto the correct agent via function calls.\n\n${MAYA_AI_RULES.IDENTIFICATION.rule}\n${MAYA_AI_RULES.STAFF_ACCESS.rule}\n${((_MAYA_AI_RULES$STAFF_ = MAYA_AI_RULES.STAFF_MEMORY) === null || _MAYA_AI_RULES$STAFF_ === void 0 ? void 0 : _MAYA_AI_RULES$STAFF_.rule) || ''}\n${MAYA_AI_RULES.ACTION_RULE.rule}\n${MAYA_AI_RULES.DYNAMIC_DETAILS.rule}\n`.trim();\n\n// Agent Types\nexport const AGENT_TYPES = {\n  SCRAPER: 'scraper',\n  MARKETING: 'marketing',\n  CREATIVE: 'creative',\n  SALES: 'sales',\n  OPERATIONS: 'operations'\n};\n\n// Agent Status\nexport const AGENT_STATUS = {\n  ONLINE: 'online',\n  BUSY: 'busy',\n  OFFLINE: 'offline',\n  ERROR: 'error'\n};\n\n/**\n * Base Agent class\n */\nclass BaseAgent {\n  constructor(id, name, description) {\n    this.id = id;\n    this.name = name;\n    this.description = description;\n    this.status = AGENT_STATUS.ONLINE;\n    this.taskQueue = [];\n    this.completedTasks = [];\n  }\n  async execute(task) {\n    throw new Error('Execute method must be implemented');\n  }\n  getStatus() {\n    return this.status;\n  }\n  setStatus(status) {\n    this.status = status;\n  }\n}\n\n/**\n * Scraper Agent - Scans Airbnb/Booking for hot leads\n */\nexport class ScraperAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.SCRAPER, 'Scraper Agent', 'Scans Airbnb and Booking to discover high-intent leads');\n    this.leadsFound = 0;\n    this.lastScan = null;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      const leads = await this.scanPlatforms(task.platforms || ['airbnb', 'booking'], task.location);\n      this.leadsFound += leads.length;\n      this.lastScan = new Date().toISOString();\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return {\n        success: true,\n        leads,\n        timestamp: this.lastScan,\n        message: i18n.t('orchestrator.messages.leadsFound', {\n          count: leads.length\n        })\n      };\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async scanPlatforms(platforms, location = 'Greece') {\n    const response = await fetch(`${API_BASE_URL}/api/agents/scout/scan`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeaders()\n      },\n      body: JSON.stringify({\n        platforms,\n        location\n      })\n    });\n    if (!response.ok) {\n      throw new Error('Failed to scan platforms');\n    }\n    const data = await response.json();\n    return data.leads || [];\n  }\n}\n\n/**\n * Marketing Agent - Creates social media posts and email campaigns\n */\nexport class MarketingAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.MARKETING, 'Marketing Agent', 'Creates social posts and email campaigns');\n    this.postsCreated = 0;\n    this.campaignsSent = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'social_post':\n          result = await this.createSocialPost(task.content);\n          this.postsCreated++;\n          break;\n        case 'email_campaign':\n          result = await this.createEmailCampaign(task.campaign);\n          this.campaignsSent++;\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async createSocialPost(content) {\n    await new Promise(r => setTimeout(r, 1000));\n    return {\n      success: true,\n      post: {\n        id: Date.now(),\n        content: content.text,\n        platforms: content.platforms || ['instagram', 'facebook'],\n        scheduledFor: content.scheduledFor || new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.postCreated')\n    };\n  }\n  async createEmailCampaign(campaign) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      campaign: {\n        id: Date.now(),\n        subject: campaign.subject,\n        recipients: campaign.recipients || 500,\n        sentAt: new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.campaignSent', {\n        count: campaign.recipients || 500\n      })\n    };\n  }\n}\n\n/**\n * Creative Agent - Auto-edits videos/images for property presentation\n */\nexport class CreativeAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.CREATIVE, 'Creative Agent', 'Edits videos and images for property presentation');\n    this.assetsCreated = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'edit_video':\n          result = await this.editVideo(task.video);\n          break;\n        case 'enhance_images':\n          result = await this.enhanceImages(task.images);\n          break;\n        case 'create_virtual_tour':\n          result = await this.createVirtualTour(task.property);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.assetsCreated++;\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async editVideo(video) {\n    await new Promise(r => setTimeout(r, 3000));\n    return {\n      success: true,\n      video: {\n        id: Date.now(),\n        originalUrl: video.url,\n        editedUrl: video.url + '?edited=true',\n        duration: '2:30'\n      },\n      message: i18n.t('orchestrator.messages.videoEdited')\n    };\n  }\n  async enhanceImages(images) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      images: images.map((img, i) => ({\n        id: Date.now() + i,\n        originalUrl: img,\n        enhancedUrl: img + '?enhanced=true'\n      })),\n      message: i18n.t('orchestrator.messages.imagesEnhanced', {\n        count: images.length\n      })\n    };\n  }\n  async createVirtualTour(property) {\n    await new Promise(r => setTimeout(r, 5000));\n    return {\n      success: true,\n      tour: {\n        id: Date.now(),\n        propertyId: property.id,\n        tourUrl: `https://tours.hotel.ai/${property.id}`\n      },\n      message: i18n.t('orchestrator.messages.tourCreated')\n    };\n  }\n}\n\n/**\n * Sales Manager Agent - Manages initial negotiations and sends demos\n */\nexport class SalesAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.SALES, 'Sales Manager Agent', 'Handles early negotiations and sends demos');\n    this.dealsInProgress = 0;\n    this.dealsClosedToday = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'send_demo':\n          result = await this.sendDemo(task.lead);\n          break;\n        case 'negotiate':\n          result = await this.handleNegotiation(task.deal);\n          break;\n        case 'follow_up':\n          result = await this.followUp(task.leadId);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async sendDemo(lead) {\n    await new Promise(r => setTimeout(r, 1500));\n    this.dealsInProgress++;\n    return {\n      success: true,\n      demo: {\n        id: Date.now(),\n        leadId: lead.id,\n        demoUrl: `https://demo.hotel.ai/${lead.id}`,\n        sentAt: new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.demoSent', {\n        name: lead.name || 'Lead'\n      })\n    };\n  }\n  async handleNegotiation(deal) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      negotiation: {\n        id: Date.now(),\n        dealId: deal.id,\n        stage: 'proposal_sent',\n        nextAction: 'await_response'\n      },\n      message: i18n.t('orchestrator.messages.negotiationStarted')\n    };\n  }\n  async followUp(leadId) {\n    await new Promise(r => setTimeout(r, 1000));\n    return {\n      success: true,\n      followUp: {\n        leadId,\n        sentAt: new Date().toISOString(),\n        type: 'email'\n      },\n      message: i18n.t('orchestrator.messages.followUpSent')\n    };\n  }\n}\n\n/**\n * Operations Agent - Sends WhatsApp messages to staff for cleaning, maintenance, etc.\n */\nexport class OperationsAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.OPERATIONS, 'Operations Agent', 'Sends WhatsApp messages to staff for operational requests');\n    this.messagesSent = 0;\n    this.tasksAssigned = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'request_towels':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'request_cleaning':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'maintenance_request':\n          result = await this.sendStaffMessage('maintenance', task);\n          break;\n        case 'room_service':\n          result = await this.sendStaffMessage('room_service', task);\n          break;\n        case 'guest_checkout':\n          result = await this.handleCheckout(task);\n          break;\n        default:\n          result = await this.sendStaffMessage('general', task);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async sendStaffMessage(department, task) {\n    var _relevantStaff, _relevantStaff2, _relevantStaff3, _relevantStaff4;\n    await new Promise(r => setTimeout(r, 800));\n    this.messagesSent++;\n    this.tasksAssigned++;\n    const staffByProperty = task.staffByProperty || {};\n    const properties = task.properties || [];\n    let relevantStaff = null;\n    let propertyName = '';\n    let propertyId = '';\n    let propertyContext = '';\n    const isMaintenance = department === 'maintenance';\n    const preferName = isMaintenance ? 'kobi' : 'alma';\n    const rolePattern = isMaintenance ? /×ž×ª×—×–×§|maintenance/i : /×ž× ×§×”|cleaner|cleaning|housekeeping|staff/i;\n    for (const [pid, staffList] of Object.entries(staffByProperty)) {\n      let s = staffList.find(x => (x.name || '').toLowerCase() === preferName);\n      if (!s) s = staffList.find(x => rolePattern.test(x.role || ''));\n      if (s) {\n        var _prop$max_guests, _prop$bedrooms, _prop$beds;\n        relevantStaff = s;\n        propertyId = pid;\n        const prop = properties.find(p => p.id === pid);\n        propertyName = (prop === null || prop === void 0 ? void 0 : prop.name) || '×”× ×›×¡';\n        const g = (_prop$max_guests = prop === null || prop === void 0 ? void 0 : prop.max_guests) !== null && _prop$max_guests !== void 0 ? _prop$max_guests : 2;\n        const br = (_prop$bedrooms = prop === null || prop === void 0 ? void 0 : prop.bedrooms) !== null && _prop$bedrooms !== void 0 ? _prop$bedrooms : 1;\n        const b = (_prop$beds = prop === null || prop === void 0 ? void 0 : prop.beds) !== null && _prop$beds !== void 0 ? _prop$beds : 1;\n        propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed`;\n        break;\n      }\n    }\n    if (!relevantStaff && Object.values(staffByProperty).flat().length > 0) {\n      var _prop$max_guests2, _prop$bedrooms2, _prop$beds2;\n      const first = Object.entries(staffByProperty)[0];\n      relevantStaff = first[1][0];\n      propertyId = first[0];\n      const prop = properties.find(p => p.id === first[0]);\n      propertyName = (prop === null || prop === void 0 ? void 0 : prop.name) || '×”× ×›×¡';\n      const g = (_prop$max_guests2 = prop === null || prop === void 0 ? void 0 : prop.max_guests) !== null && _prop$max_guests2 !== void 0 ? _prop$max_guests2 : 2;\n      const br = (_prop$bedrooms2 = prop === null || prop === void 0 ? void 0 : prop.bedrooms) !== null && _prop$bedrooms2 !== void 0 ? _prop$bedrooms2 : 1;\n      const b = (_prop$beds2 = prop === null || prop === void 0 ? void 0 : prop.beds) !== null && _prop$beds2 !== void 0 ? _prop$beds2 : 1;\n      propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed`;\n    }\n    if (!propertyId && properties.length > 0) {\n      var _prop$max_guests3, _prop$bedrooms3, _prop$beds3;\n      const prop = properties[0];\n      propertyId = prop.id;\n      propertyName = (prop === null || prop === void 0 ? void 0 : prop.name) || '×”× ×›×¡';\n      const g = (_prop$max_guests3 = prop === null || prop === void 0 ? void 0 : prop.max_guests) !== null && _prop$max_guests3 !== void 0 ? _prop$max_guests3 : 2;\n      const br = (_prop$bedrooms3 = prop === null || prop === void 0 ? void 0 : prop.bedrooms) !== null && _prop$bedrooms3 !== void 0 ? _prop$bedrooms3 : 1;\n      const b = (_prop$beds3 = prop === null || prop === void 0 ? void 0 : prop.beds) !== null && _prop$beds3 !== void 0 ? _prop$beds3 : 1;\n      propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed`;\n      const staffForProp = staffByProperty[prop.id];\n      if ((staffForProp === null || staffForProp === void 0 ? void 0 : staffForProp.length) > 0 && !relevantStaff) {\n        relevantStaff = staffForProp[0];\n      }\n    }\n    const staffName = ((_relevantStaff = relevantStaff) === null || _relevantStaff === void 0 ? void 0 : _relevantStaff.name) || 'Staff';\n    const phone = ((_relevantStaff2 = relevantStaff) === null || _relevantStaff2 === void 0 ? void 0 : _relevantStaff2.phone_number) || ((_relevantStaff3 = relevantStaff) === null || _relevantStaff3 === void 0 ? void 0 : _relevantStaff3.phone);\n    const staffId = ((_relevantStaff4 = relevantStaff) === null || _relevantStaff4 === void 0 ? void 0 : _relevantStaff4.id) || '';\n    const displayMessage = phone ? `I am notifying ${staffName} at ${phone}` : `I am notifying ${staffName}. (Add their phone number in Staff settings for direct contact.)`;\n    const message = this.generateMessage(department, task, {\n      staffName,\n      propertyName\n    });\n    const readyToSendHe = phone && propertyName ? `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}. ${task.description || '×‘×§×©×” ×œ× ×™×§×™×•×Ÿ/×©×™×¨×•×ª'}. ×× × ×˜×¤×œ ×‘×”×§×“×.` : null;\n    let taskCreated = false;\n    try {\n      await createPropertyTask({\n        property_id: propertyId,\n        assigned_to: staffId,\n        description: task.description || (department === 'housekeeping' ? '× ×™×§×™×•×Ÿ' : '×©×™×¨×•×ª'),\n        status: 'Pending',\n        property_name: propertyName,\n        staff_name: staffName,\n        staff_phone: phone || '',\n        property_context: propertyContext\n      });\n      taskCreated = true;\n    } catch (e) {\n      console.warn('[Maya] Could not persist task:', e);\n    }\n    return {\n      success: true,\n      taskCreated,\n      message: {\n        id: Date.now(),\n        department,\n        room: task.room,\n        content: message,\n        readyToSendHe,\n        staffName,\n        phone,\n        propertyName,\n        sentAt: new Date().toISOString(),\n        status: 'delivered'\n      },\n      displayMessage\n    };\n  }\n  generateMessage(department, task, extra = {}) {\n    const {\n      staffName,\n      propertyName\n    } = extra;\n    const base = {\n      housekeeping: `ðŸ¨ ×‘×§×©×” ×—×“×©×” ×ž×—×“×¨ ${task.room}\\n\\n${task.description || '×ž×’×‘×•×ª × ×“×¨×©×•×ª'}\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“× ×”××¤×©×¨×™`,\n      maintenance: `ðŸ”§ ×ª×—×–×•×§×” × ×“×¨×©×ª ×‘×—×“×¨ ${task.room}\\n\\n${task.description || '×‘×¢×™×” ×˜×›× ×™×ª'}\\n\\nâš ï¸ ×“×—×™×¤×•×ª: ${task.priority || '×¨×’×™×œ×”'}`,\n      room_service: `ðŸ½ï¸ ×”×–×ž× ×ª ×©×™×¨×•×ª ×—×“×¨×™×\\n\\n×—×“×¨: ${task.room}\\n${task.order || ''}\\n\\nâ° ×–×ž×Ÿ ×ž×©×œ×•×— ×ž×‘×•×§×©: ${task.deliveryTime || '×‘×”×§×“×'}`,\n      general: `ðŸ“‹ ×‘×§×©×” ×—×“×©×” ×ž×—×“×¨ ${task.room}\\n\\n${task.description || '×‘×§×©×ª ××•×¨×—'}`\n    };\n    let msg = base[department] || base.general;\n    if (staffName && propertyName) {\n      msg = `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}.\\n\\n${msg}`;\n    }\n    return task.staffContext ? msg + task.staffContext : msg;\n  }\n  async handleCheckout(task) {\n    await new Promise(r => setTimeout(r, 1000));\n\n    // Send multiple messages for checkout process\n    await this.sendStaffMessage('housekeeping', {\n      room: task.room,\n      description: '× ×™×§×™×•×Ÿ ×œ××—×¨ ×¦\\'×§-×××•×˜',\n      priority: '×’×‘×•×”×”'\n    });\n    return {\n      success: true,\n      checkout: {\n        room: task.room,\n        guestName: task.guestName,\n        processedAt: new Date().toISOString()\n      },\n      displayMessage: i18n.t('orchestrator.messages.checkoutDone', {\n        room: task.room\n      })\n    };\n  }\n}\n\n/**\n * Maya - The Master Orchestrator\n * Manages all agents and handles high-level decisions\n */\nclass MayaOrchestrator {\n  constructor() {\n    this.agents = {\n      [AGENT_TYPES.SCRAPER]: new ScraperAgent(),\n      [AGENT_TYPES.MARKETING]: new MarketingAgent(),\n      [AGENT_TYPES.CREATIVE]: new CreativeAgent(),\n      [AGENT_TYPES.SALES]: new SalesAgent(),\n      [AGENT_TYPES.OPERATIONS]: new OperationsAgent()\n    };\n    this.taskHistory = [];\n    this.isProcessing = false;\n    this.systemPrompt = MAYA_SYSTEM_PROMPT;\n  }\n\n  /**\n   * Execute a task using the appropriate agent\n   */\n  async executeTask(agentType, task) {\n    const agent = this.agents[agentType];\n    if (!agent) {\n      throw new Error(`Agent ${agentType} not found`);\n    }\n    const taskRecord = {\n      id: Date.now(),\n      agentType,\n      task,\n      startedAt: new Date().toISOString(),\n      status: 'running'\n    };\n    this.taskHistory.push(taskRecord);\n    try {\n      const result = await agent.execute(task);\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'completed';\n      taskRecord.result = result;\n      return result;\n    } catch (error) {\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'failed';\n      taskRecord.error = error.message;\n      throw error;\n    }\n  }\n\n  /**\n   * Get all agent statuses\n   */\n  getAgentStatuses() {\n    return Object.entries(this.agents).reduce((acc, [type, agent]) => {\n      acc[type] = {\n        status: agent.status,\n        name: agent.name,\n        description: agent.description\n      };\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Fetch property context (details + staff) for AI to answer guest queries\n   */\n  async getPropertyContext() {\n    try {\n      var _ctx$properties;\n      const ctx = await getAIPropertyContext();\n      return ctx.summary_for_ai || (_ctx$properties = ctx.properties) !== null && _ctx$properties !== void 0 && _ctx$properties.length ? `Property context: ${ctx.summary_for_ai || 'No details.'}` : '';\n    } catch (e) {\n      return '';\n    }\n  }\n\n  /**\n   * Process natural language command from Maya chat\n   */\n  async processCommand(command) {\n    const lowerCommand = command.toLowerCase();\n\n    // \"Send this to Kobi\" / \"Send to Alma\" - open WhatsApp for selected task\n    const sendToRegex = /(?:send|×©×œ×—).*(kobi|alma|avi|×§×•×‘×™|×¢×œ×ž×”|××‘×™)|(kobi|alma|avi|×§×•×‘×™|×¢×œ×ž×”|××‘×™).*(?:send|×©×œ×—)/i;\n    const sendToMatch = command.match(sendToRegex);\n    if (sendToMatch) {\n      var _useStore$getState, _useStore$getState$ca;\n      const namePart = (sendToMatch[1] || sendToMatch[2] || '').toLowerCase();\n      const nameMap = {\n        ×§×•×‘×™: 'kobi',\n        ×¢×œ×ž×”: 'alma',\n        ××‘×™: 'avi'\n      };\n      const staffKey = nameMap[namePart] || namePart;\n      const lastTask = (_useStore$getState = useStore.getState) === null || _useStore$getState === void 0 ? void 0 : (_useStore$getState$ca = _useStore$getState.call(useStore)) === null || _useStore$getState$ca === void 0 ? void 0 : _useStore$getState$ca.lastSelectedTask;\n      if (lastTask) {\n        var _Object$entries$find;\n        const ctx = await getAIPropertyContext();\n        const staffMap = {};\n        if (ctx.staff_by_property) {\n          for (const list of Object.values(ctx.staff_by_property)) {\n            for (const s of list) {\n              const n = (s.name || '').toLowerCase();\n              if (n && !staffMap[n]) staffMap[n] = s.phone_number || s.phone || '';\n            }\n          }\n        }\n        const targetPhone = staffMap[staffKey] || ((_Object$entries$find = Object.entries(staffMap).find(([k]) => k.includes(staffKey) || staffKey.includes(k))) === null || _Object$entries$find === void 0 ? void 0 : _Object$entries$find[1]);\n        if (targetPhone) {\n          const {\n            toWhatsAppPhone\n          } = await import('../utils/phone');\n          const content = String(lastTask.description || lastTask.title || lastTask.content || '').slice(0, 120);\n          const msg = `×”×™×™, ×™×© ×œ×š ×ž×©×™×ž×”: ${content}`;\n          const url = `https://wa.me/${toWhatsAppPhone(targetPhone)}?text=${encodeURIComponent(msg)}`;\n          if (typeof window !== 'undefined') window.open(url, '_blank');\n          return {\n            success: true,\n            message: `Opened WhatsApp for ${staffKey}`,\n            displayMessage: `× ×¤×ª×— ×•×•××˜×¡××¤ ×¢×‘×•×¨ ${staffKey}`\n          };\n        }\n      } else {\n        return {\n          success: true,\n          message: 'Click a task card first, then say \"Send to Kobi\"',\n          displayMessage: '×œ×—×¥ ×¢×œ ×›×¨×˜×™×¡ ×ž×©×™×ž×” ×•××– ××ž×•×¨ \"×©×œ×— ×œ×§×•×‘×™\"'\n        };\n      }\n    }\n    if (lowerCommand.includes('× ×¨××” ××•×ª×” ×ž× ×”×œ×ª') || lowerCommand.includes('×‘×•× × ×¨××” ××•×ª×” ×ž× ×”×œ×ª') || lowerCommand.includes('maya manage')) {\n      try {\n        const tasks = await getPropertyTasks();\n        const tasksForAnalysis = (tasks || []).map(t => ({\n          desc: (t.description || t.title || t.content || '').slice(0, 100),\n          staff: t.staff_name || t.staffName || '',\n          property: t.property_name || t.propertyName || '',\n          status: t.status || 'Pending'\n        }));\n        const result = await sendMayaCommand('×‘×•× × ×¨××” ××•×ª×” ×ž× ×”×œ×ª', tasksForAnalysis);\n        if (result.success) {\n          return {\n            success: true,\n            message: result.message,\n            displayMessage: result.displayMessage || result.message\n          };\n        }\n      } catch (e) {\n        return {\n          success: true,\n          message: `×™×© ×œ× ×• ${(await getPropertyTasks()).filter(t => (t.status || '').toLowerCase() !== 'done').length} ×ž×©×™×ž×•×ª ×¤×ª×•×—×•×ª. ×”×× ×œ×”×•×¦×™× ×ª×–×›×•×¨×ª?`,\n          displayMessage: `×™×© ×œ× ×• ×ž×©×™×ž×•×ª ×¤×ª×•×—×•×ª. ×”×× ×œ×”×•×¦×™× ×ª×–×›×•×¨×ª?`\n        };\n      }\n    }\n    if (lowerCommand.includes('daily report') || lowerCommand.includes('×“×•×— ×™×•×ž×™') || lowerCommand.includes('generate daily report')) {\n      try {\n        const result = await sendMayaCommand(command);\n        if (result.success && result.message) {\n          return {\n            success: true,\n            message: result.message,\n            displayMessage: result.displayMessage || result.message\n          };\n        }\n      } catch (e) {\n        const tasks = await getPropertyTasks();\n        const today = new Date().toISOString().slice(0, 10);\n        const doneToday = tasks.filter(t => {\n          const s = (t.status || '').toLowerCase();\n          const isDone = s === 'done' || s === 'completed';\n          const d = (t.created_at || t.updated_at || '').slice(0, 10);\n          return isDone && d === today;\n        });\n        const pending = tasks.filter(t => (t.status || '').toLowerCase() !== 'done' && (t.status || '').toLowerCase() !== 'completed');\n        const summary = `×“×•×— ×™×•×ž×™: ${doneToday.length} ×ž×©×™×ž×•×ª ×”×•×©×œ×ž×• ×”×™×•×. ${pending.length} ×ž×ž×ª×™× ×•×ª.`;\n        return {\n          success: true,\n          message: summary,\n          displayMessage: summary\n        };\n      }\n    }\n    if (lowerCommand.includes('property') || lowerCommand.includes('villa') || lowerCommand.includes('× ×›×¡') || lowerCommand.includes('×•×•×™×œ×”') || lowerCommand.includes('guests') || lowerCommand.includes('××•×¨×—×™×') || lowerCommand.includes('bedroom') || lowerCommand.includes('×›×ž×” ×—×“×¨×™×') || lowerCommand.includes('how many')) {\n      const ctx = await getAIPropertyContext();\n      const summary = ctx.summary_for_ai || 'No properties in database.';\n      return {\n        success: true,\n        message: summary,\n        displayMessage: summary,\n        properties: ctx.properties\n      };\n    }\n    if (lowerCommand.includes('staff') || lowerCommand.includes('×¢×•×‘×“') || lowerCommand.includes('×ž× ×§×”') || lowerCommand.includes('who to contact')) {\n      const ctx = await getAIPropertyContext();\n      const lines = [];\n      if (ctx.staff_by_property) {\n        for (const [pid, staff] of Object.entries(ctx.staff_by_property)) {\n          const prop = (ctx.properties || []).find(p => p.id === pid);\n          const pName = (prop === null || prop === void 0 ? void 0 : prop.name) || pid;\n          const sStr = staff.map(s => `${s.name} (${s.role})`).join(', ') || 'None';\n          lines.push(`${pName}: ${sStr}`);\n        }\n      }\n      const msg = lines.length ? lines.join('\\n') : 'No staff assigned.';\n      return {\n        success: true,\n        message: msg,\n        displayMessage: msg\n      };\n    }\n    if (lowerCommand.includes('lead') || lowerCommand.includes('scan') || lowerCommand.includes('airbnb') || lowerCommand.includes('×œ×™×“') || lowerCommand.includes('×¡×¨×™×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SCRAPER, {\n        platforms: ['airbnb', 'booking']\n      });\n    }\n    if (lowerCommand.includes('post') || lowerCommand.includes('marketing') || lowerCommand.includes('campaign') || lowerCommand.includes('×¤×•×¡×˜') || lowerCommand.includes('×©×™×•×•×§') || lowerCommand.includes('×§×ž×¤×™×™×Ÿ')) {\n      return await this.executeTask(AGENT_TYPES.MARKETING, {\n        type: 'social_post',\n        content: {\n          text: 'New hotel post',\n          platforms: ['instagram', 'facebook']\n        }\n      });\n    }\n    if (lowerCommand.includes('video') || lowerCommand.includes('image') || lowerCommand.includes('edit') || lowerCommand.includes('×•×™×“××•') || lowerCommand.includes('×ª×ž×•× ') || lowerCommand.includes('×¢×¨×™×›×”')) {\n      return await this.executeTask(AGENT_TYPES.CREATIVE, {\n        type: 'enhance_images',\n        images: ['https://example.com/room1.jpg']\n      });\n    }\n    if (lowerCommand.includes('demo') || lowerCommand.includes('deal') || lowerCommand.includes('sales') || lowerCommand.includes('×“×ž×•') || lowerCommand.includes('×ž×›×™×¨') || lowerCommand.includes('×¢×¡×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SALES, {\n        type: 'send_demo',\n        lead: {\n          id: Date.now(),\n          name: 'New lead'\n        }\n      });\n    }\n    const taskTriggers = /towel|clean|maintenance|room|fix|repair|broken|service|needs cleaning|prepare|guests|×ž×’×‘×ª|× ×™×§×™×•×Ÿ|×ª×—×–×•×§×”|×—×“×¨|dirty|×ž×œ×•×›×œ×š|×ª×§×Ÿ|×”×›×•×‘×¡|×ž× ×§×”|×©×™×¨×•×ª|×ª×™×§×•×Ÿ|cleaner|tell the cleaner|tell\\s+\\w+\\s+to|add\\s+task|create\\s+task|×¢×œ×ž×”|×§×•×‘×™|××‘×™|tell\\s+alma|tell\\s+kobi|×§×¦×¨|×—×©×ž×œ|electrical|short circuit/i;\n    if (taskTriggers.test(command)) {\n      try {\n        const geminiResult = await sendMayaCommand(command);\n        if (geminiResult.success) {\n          const taskCreated = geminiResult.taskCreated || geminiResult.action === 'add_task' || !!geminiResult.task;\n          if (taskCreated) {\n            window.dispatchEvent(new CustomEvent('maya-task-created', {\n              detail: {\n                task: geminiResult.task\n              }\n            }));\n          }\n          return {\n            success: true,\n            message: geminiResult.message || geminiResult.displayMessage,\n            displayMessage: geminiResult.displayMessage || geminiResult.message,\n            taskCreated\n          };\n        }\n      } catch (e) {\n        if ((e === null || e === void 0 ? void 0 : e.status) === 503 || ((e === null || e === void 0 ? void 0 : e.message) || '').includes('×ž×ª×—×‘×¨') || ((e === null || e === void 0 ? void 0 : e.message) || '').toLowerCase().includes('failed')) {\n          throw e;\n        }\n        console.warn('[Maya] Gemini fallback:', e === null || e === void 0 ? void 0 : e.message);\n      }\n      const roomMatch = command.match(/\\d+/);\n      const room = roomMatch ? roomMatch[0] : '101';\n      const ctx = await getAIPropertyContext();\n      const propertyContext = ctx.summary_for_ai || '';\n      const staffList = ctx.staff_by_property ? Object.values(ctx.staff_by_property).flat() : [];\n      const staffByProperty = ctx.staff_by_property || {};\n      const properties = ctx.properties || [];\n      const isMaintenance = /maintenance|fix|×ª×—×–×•×§×”|×ª×§×Ÿ/i.test(command);\n      const isCleaning = /clean|towel|dirty|×ž×’×‘×ª|× ×™×§×™×•×Ÿ|×ž×œ×•×›×œ×š|×ž× ×§×”|×”×›×•×‘×¡/i.test(command);\n      const taskType = isMaintenance ? 'maintenance_request' : isCleaning ? 'request_cleaning' : 'request_towels';\n      return await this.executeTask(AGENT_TYPES.OPERATIONS, {\n        type: taskType,\n        room,\n        description: command,\n        propertyContext,\n        staff: staffList,\n        staffByProperty,\n        properties\n      });\n    }\n\n    // Default response\n    return {\n      success: true,\n      message: i18n.t('orchestrator.messages.unknown')\n    };\n  }\n\n  /**\n   * Get task history\n   */\n  getTaskHistory(limit = 50) {\n    return this.taskHistory.slice(-limit).reverse();\n  }\n\n  /**\n   * Generate daily report\n   */\n  async generateDailyReport() {\n    const response = await fetch(`${API_BASE_URL}/api/reports/daily`, {\n      headers: {\n        ...getAuthHeaders()\n      }\n    });\n    if (!response.ok) {\n      throw new Error('Failed to generate report');\n    }\n    const data = await response.json();\n    return data.report || data;\n  }\n}\n\n// Singleton instance\nexport const maya = new MayaOrchestrator();\nexport default maya;","map":{"version":3,"names":["API_BASE_URL","getAIPropertyContext","createPropertyTask","sendMayaCommand","getPropertyTasks","useStore","MAYA_AI_RULES","i18n","getAuthHeaders","_parsed$state","_parsed$state2","raw","localStorage","getItem","parsed","JSON","parse","token","state","authToken","tenantId","activeTenantId","headers","Authorization","error","MAYA_SYSTEM_PROMPT","IDENTIFICATION","rule","STAFF_ACCESS","_MAYA_AI_RULES$STAFF_","STAFF_MEMORY","ACTION_RULE","DYNAMIC_DETAILS","trim","AGENT_TYPES","SCRAPER","MARKETING","CREATIVE","SALES","OPERATIONS","AGENT_STATUS","ONLINE","BUSY","OFFLINE","ERROR","BaseAgent","constructor","id","name","description","status","taskQueue","completedTasks","execute","task","Error","getStatus","setStatus","ScraperAgent","leadsFound","lastScan","leads","scanPlatforms","platforms","location","length","Date","toISOString","success","timestamp","message","t","count","response","fetch","method","body","stringify","ok","data","json","MarketingAgent","postsCreated","campaignsSent","result","type","createSocialPost","content","createEmailCampaign","campaign","Promise","r","setTimeout","post","now","text","scheduledFor","subject","recipients","sentAt","CreativeAgent","assetsCreated","editVideo","video","enhanceImages","images","createVirtualTour","property","originalUrl","url","editedUrl","duration","map","img","i","enhancedUrl","tour","propertyId","tourUrl","SalesAgent","dealsInProgress","dealsClosedToday","sendDemo","lead","handleNegotiation","deal","followUp","leadId","demo","demoUrl","negotiation","dealId","stage","nextAction","OperationsAgent","messagesSent","tasksAssigned","sendStaffMessage","handleCheckout","department","_relevantStaff","_relevantStaff2","_relevantStaff3","_relevantStaff4","staffByProperty","properties","relevantStaff","propertyName","propertyContext","isMaintenance","preferName","rolePattern","pid","staffList","Object","entries","s","find","x","toLowerCase","test","role","_prop$max_guests","_prop$bedrooms","_prop$beds","prop","p","g","max_guests","br","bedrooms","b","beds","values","flat","_prop$max_guests2","_prop$bedrooms2","_prop$beds2","first","_prop$max_guests3","_prop$bedrooms3","_prop$beds3","staffForProp","staffName","phone","phone_number","staffId","displayMessage","generateMessage","readyToSendHe","taskCreated","property_id","assigned_to","property_name","staff_name","staff_phone","property_context","e","console","warn","room","extra","base","housekeeping","maintenance","priority","room_service","order","deliveryTime","general","msg","staffContext","checkout","guestName","processedAt","MayaOrchestrator","agents","taskHistory","isProcessing","systemPrompt","executeTask","agentType","agent","taskRecord","startedAt","push","completedAt","getAgentStatuses","reduce","acc","getPropertyContext","_ctx$properties","ctx","summary_for_ai","processCommand","command","lowerCommand","sendToRegex","sendToMatch","match","_useStore$getState","_useStore$getState$ca","namePart","nameMap","×§×•×‘×™","×¢×œ×ž×”","××‘×™","staffKey","lastTask","getState","call","lastSelectedTask","_Object$entries$find","staffMap","staff_by_property","list","n","targetPhone","k","includes","toWhatsAppPhone","String","title","slice","encodeURIComponent","window","open","tasks","tasksForAnalysis","desc","staff","filter","today","doneToday","isDone","d","created_at","updated_at","pending","summary","lines","pName","sStr","join","taskTriggers","geminiResult","action","dispatchEvent","CustomEvent","detail","roomMatch","isCleaning","taskType","getTaskHistory","limit","reverse","generateDailyReport","report","maya"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/services/agentOrchestrator.js"],"sourcesContent":["/**\n * Multi-Agent Orchestration System\n * Maya manages 5 specialized agents for hotel operations\n * Connected to properties DB and staff for guest queries and automation\n */\n\nimport { API_BASE_URL } from '../utils/constants';\nimport { getAIPropertyContext, createPropertyTask, sendMayaCommand, getPropertyTasks } from './api';\nimport useStore from '../store/useStore';\nimport { MAYA_AI_RULES } from '../config/mayaRules';\nimport i18n from '../i18n';\n\nconst getAuthHeaders = () => {\n  try {\n    const raw = localStorage.getItem('hotel-enterprise-storage');\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    const token = parsed?.state?.authToken;\n    const tenantId = parsed?.state?.activeTenantId;\n    const headers = {};\n    if (token) headers.Authorization = `Bearer ${token}`;\n    if (tenantId) headers['X-Tenant-Id'] = tenantId;\n    return headers;\n  } catch (error) {\n    return {};\n  }\n};\n\nconst MAYA_SYSTEM_PROMPT = `\nYou are Maya, the Senior Project Manager for Easy Host AI.\nBe proactive, decisive, and operations-focused. Monitor occupancy, leads,\nand operational status. Suggest actions before being asked and route work\nto the correct agent via function calls.\n\n${MAYA_AI_RULES.IDENTIFICATION.rule}\n${MAYA_AI_RULES.STAFF_ACCESS.rule}\n${MAYA_AI_RULES.STAFF_MEMORY?.rule || ''}\n${MAYA_AI_RULES.ACTION_RULE.rule}\n${MAYA_AI_RULES.DYNAMIC_DETAILS.rule}\n`.trim();\n\n// Agent Types\nexport const AGENT_TYPES = {\n  SCRAPER: 'scraper',\n  MARKETING: 'marketing',\n  CREATIVE: 'creative',\n  SALES: 'sales',\n  OPERATIONS: 'operations',\n};\n\n// Agent Status\nexport const AGENT_STATUS = {\n  ONLINE: 'online',\n  BUSY: 'busy',\n  OFFLINE: 'offline',\n  ERROR: 'error',\n};\n\n/**\n * Base Agent class\n */\nclass BaseAgent {\n  constructor(id, name, description) {\n    this.id = id;\n    this.name = name;\n    this.description = description;\n    this.status = AGENT_STATUS.ONLINE;\n    this.taskQueue = [];\n    this.completedTasks = [];\n  }\n\n  async execute(task) {\n    throw new Error('Execute method must be implemented');\n  }\n\n  getStatus() {\n    return this.status;\n  }\n\n  setStatus(status) {\n    this.status = status;\n  }\n}\n\n/**\n * Scraper Agent - Scans Airbnb/Booking for hot leads\n */\nexport class ScraperAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.SCRAPER,\n      'Scraper Agent',\n      'Scans Airbnb and Booking to discover high-intent leads'\n    );\n    this.leadsFound = 0;\n    this.lastScan = null;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      const leads = await this.scanPlatforms(task.platforms || ['airbnb', 'booking'], task.location);\n      \n      this.leadsFound += leads.length;\n      this.lastScan = new Date().toISOString();\n      this.setStatus(AGENT_STATUS.ONLINE);\n      \n      return {\n        success: true,\n        leads,\n        timestamp: this.lastScan,\n        message: i18n.t('orchestrator.messages.leadsFound', { count: leads.length }),\n      };\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async scanPlatforms(platforms, location = 'Greece') {\n    const response = await fetch(`${API_BASE_URL}/api/agents/scout/scan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', ...getAuthHeaders() },\n      body: JSON.stringify({ platforms, location }),\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to scan platforms');\n    }\n\n    const data = await response.json();\n    return data.leads || [];\n  }\n}\n\n/**\n * Marketing Agent - Creates social media posts and email campaigns\n */\nexport class MarketingAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.MARKETING,\n      'Marketing Agent',\n      'Creates social posts and email campaigns'\n    );\n    this.postsCreated = 0;\n    this.campaignsSent = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'social_post':\n          result = await this.createSocialPost(task.content);\n          this.postsCreated++;\n          break;\n        case 'email_campaign':\n          result = await this.createEmailCampaign(task.campaign);\n          this.campaignsSent++;\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async createSocialPost(content) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    return {\n      success: true,\n      post: {\n        id: Date.now(),\n        content: content.text,\n        platforms: content.platforms || ['instagram', 'facebook'],\n        scheduledFor: content.scheduledFor || new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.postCreated'),\n    };\n  }\n\n  async createEmailCampaign(campaign) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      campaign: {\n        id: Date.now(),\n        subject: campaign.subject,\n        recipients: campaign.recipients || 500,\n        sentAt: new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.campaignSent', { count: campaign.recipients || 500 }),\n    };\n  }\n}\n\n/**\n * Creative Agent - Auto-edits videos/images for property presentation\n */\nexport class CreativeAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.CREATIVE,\n      'Creative Agent',\n      'Edits videos and images for property presentation'\n    );\n    this.assetsCreated = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'edit_video':\n          result = await this.editVideo(task.video);\n          break;\n        case 'enhance_images':\n          result = await this.enhanceImages(task.images);\n          break;\n        case 'create_virtual_tour':\n          result = await this.createVirtualTour(task.property);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.assetsCreated++;\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async editVideo(video) {\n    await new Promise((r) => setTimeout(r, 3000));\n    \n    return {\n      success: true,\n      video: {\n        id: Date.now(),\n        originalUrl: video.url,\n        editedUrl: video.url + '?edited=true',\n        duration: '2:30',\n      },\n      message: i18n.t('orchestrator.messages.videoEdited'),\n    };\n  }\n\n  async enhanceImages(images) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      images: images.map((img, i) => ({\n        id: Date.now() + i,\n        originalUrl: img,\n        enhancedUrl: img + '?enhanced=true',\n      })),\n      message: i18n.t('orchestrator.messages.imagesEnhanced', { count: images.length }),\n    };\n  }\n\n  async createVirtualTour(property) {\n    await new Promise((r) => setTimeout(r, 5000));\n    \n    return {\n      success: true,\n      tour: {\n        id: Date.now(),\n        propertyId: property.id,\n        tourUrl: `https://tours.hotel.ai/${property.id}`,\n      },\n      message: i18n.t('orchestrator.messages.tourCreated'),\n    };\n  }\n}\n\n/**\n * Sales Manager Agent - Manages initial negotiations and sends demos\n */\nexport class SalesAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.SALES,\n      'Sales Manager Agent',\n      'Handles early negotiations and sends demos'\n    );\n    this.dealsInProgress = 0;\n    this.dealsClosedToday = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'send_demo':\n          result = await this.sendDemo(task.lead);\n          break;\n        case 'negotiate':\n          result = await this.handleNegotiation(task.deal);\n          break;\n        case 'follow_up':\n          result = await this.followUp(task.leadId);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async sendDemo(lead) {\n    await new Promise((r) => setTimeout(r, 1500));\n    \n    this.dealsInProgress++;\n    \n    return {\n      success: true,\n      demo: {\n        id: Date.now(),\n        leadId: lead.id,\n        demoUrl: `https://demo.hotel.ai/${lead.id}`,\n        sentAt: new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.demoSent', { name: lead.name || 'Lead' }),\n    };\n  }\n\n  async handleNegotiation(deal) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      negotiation: {\n        id: Date.now(),\n        dealId: deal.id,\n        stage: 'proposal_sent',\n        nextAction: 'await_response',\n      },\n      message: i18n.t('orchestrator.messages.negotiationStarted'),\n    };\n  }\n\n  async followUp(leadId) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    return {\n      success: true,\n      followUp: {\n        leadId,\n        sentAt: new Date().toISOString(),\n        type: 'email',\n      },\n      message: i18n.t('orchestrator.messages.followUpSent'),\n    };\n  }\n}\n\n/**\n * Operations Agent - Sends WhatsApp messages to staff for cleaning, maintenance, etc.\n */\nexport class OperationsAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.OPERATIONS,\n      'Operations Agent',\n      'Sends WhatsApp messages to staff for operational requests'\n    );\n    this.messagesSent = 0;\n    this.tasksAssigned = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'request_towels':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'request_cleaning':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'maintenance_request':\n          result = await this.sendStaffMessage('maintenance', task);\n          break;\n        case 'room_service':\n          result = await this.sendStaffMessage('room_service', task);\n          break;\n        case 'guest_checkout':\n          result = await this.handleCheckout(task);\n          break;\n        default:\n          result = await this.sendStaffMessage('general', task);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async sendStaffMessage(department, task) {\n    await new Promise((r) => setTimeout(r, 800));\n    \n    this.messagesSent++;\n    this.tasksAssigned++;\n    \n    const staffByProperty = task.staffByProperty || {};\n    const properties = task.properties || [];\n    let relevantStaff = null;\n    let propertyName = '';\n    let propertyId = '';\n    let propertyContext = '';\n    const isMaintenance = department === 'maintenance';\n    const preferName = isMaintenance ? 'kobi' : 'alma';\n    const rolePattern = isMaintenance\n      ? /×ž×ª×—×–×§|maintenance/i\n      : /×ž× ×§×”|cleaner|cleaning|housekeeping|staff/i;\n\n    for (const [pid, staffList] of Object.entries(staffByProperty)) {\n      let s = staffList.find((x) => (x.name || '').toLowerCase() === preferName);\n      if (!s) s = staffList.find((x) => rolePattern.test(x.role || ''));\n      if (s) {\n        relevantStaff = s;\n        propertyId = pid;\n        const prop = properties.find((p) => p.id === pid);\n        propertyName = prop?.name || '×”× ×›×¡';\n        const g = prop?.max_guests ?? 2;\n        const br = prop?.bedrooms ?? 1;\n        const b = prop?.beds ?? 1;\n        propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed`;\n        break;\n      }\n    }\n    if (!relevantStaff && Object.values(staffByProperty).flat().length > 0) {\n      const first = Object.entries(staffByProperty)[0];\n      relevantStaff = first[1][0];\n      propertyId = first[0];\n      const prop = properties.find((p) => p.id === first[0]);\n      propertyName = prop?.name || '×”× ×›×¡';\n      const g = prop?.max_guests ?? 2;\n      const br = prop?.bedrooms ?? 1;\n      const b = prop?.beds ?? 1;\n      propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed`;\n    }\n    if (!propertyId && properties.length > 0) {\n      const prop = properties[0];\n      propertyId = prop.id;\n      propertyName = prop?.name || '×”× ×›×¡';\n      const g = prop?.max_guests ?? 2;\n      const br = prop?.bedrooms ?? 1;\n      const b = prop?.beds ?? 1;\n      propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed`;\n      const staffForProp = staffByProperty[prop.id];\n      if (staffForProp?.length > 0 && !relevantStaff) {\n        relevantStaff = staffForProp[0];\n      }\n    }\n\n    const staffName = relevantStaff?.name || 'Staff';\n    const phone = relevantStaff?.phone_number || relevantStaff?.phone;\n    const staffId = relevantStaff?.id || '';\n    const displayMessage = phone\n      ? `I am notifying ${staffName} at ${phone}`\n      : `I am notifying ${staffName}. (Add their phone number in Staff settings for direct contact.)`;\n    \n    const message = this.generateMessage(department, task, { staffName, propertyName });\n    const readyToSendHe = phone && propertyName\n      ? `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}. ${task.description || '×‘×§×©×” ×œ× ×™×§×™×•×Ÿ/×©×™×¨×•×ª'}. ×× × ×˜×¤×œ ×‘×”×§×“×.`\n      : null;\n    \n    let taskCreated = false;\n    try {\n      await createPropertyTask({\n        property_id: propertyId,\n        assigned_to: staffId,\n        description: task.description || (department === 'housekeeping' ? '× ×™×§×™×•×Ÿ' : '×©×™×¨×•×ª'),\n        status: 'Pending',\n        property_name: propertyName,\n        staff_name: staffName,\n        staff_phone: phone || '',\n        property_context: propertyContext,\n      });\n      taskCreated = true;\n    } catch (e) {\n      console.warn('[Maya] Could not persist task:', e);\n    }\n    \n    return {\n      success: true,\n      taskCreated,\n      message: {\n        id: Date.now(),\n        department,\n        room: task.room,\n        content: message,\n        readyToSendHe,\n        staffName,\n        phone,\n        propertyName,\n        sentAt: new Date().toISOString(),\n        status: 'delivered',\n      },\n      displayMessage,\n    };\n  }\n\n  generateMessage(department, task, extra = {}) {\n    const { staffName, propertyName } = extra;\n    const base = {\n      housekeeping: `ðŸ¨ ×‘×§×©×” ×—×“×©×” ×ž×—×“×¨ ${task.room}\\n\\n${task.description || '×ž×’×‘×•×ª × ×“×¨×©×•×ª'}\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“× ×”××¤×©×¨×™`,\n      maintenance: `ðŸ”§ ×ª×—×–×•×§×” × ×“×¨×©×ª ×‘×—×“×¨ ${task.room}\\n\\n${task.description || '×‘×¢×™×” ×˜×›× ×™×ª'}\\n\\nâš ï¸ ×“×—×™×¤×•×ª: ${task.priority || '×¨×’×™×œ×”'}`,\n      room_service: `ðŸ½ï¸ ×”×–×ž× ×ª ×©×™×¨×•×ª ×—×“×¨×™×\\n\\n×—×“×¨: ${task.room}\\n${task.order || ''}\\n\\nâ° ×–×ž×Ÿ ×ž×©×œ×•×— ×ž×‘×•×§×©: ${task.deliveryTime || '×‘×”×§×“×'}`,\n      general: `ðŸ“‹ ×‘×§×©×” ×—×“×©×” ×ž×—×“×¨ ${task.room}\\n\\n${task.description || '×‘×§×©×ª ××•×¨×—'}`,\n    };\n    let msg = base[department] || base.general;\n    if (staffName && propertyName) {\n      msg = `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}.\\n\\n${msg}`;\n    }\n    return (task.staffContext ? msg + task.staffContext : msg);\n  }\n\n  async handleCheckout(task) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    // Send multiple messages for checkout process\n    await this.sendStaffMessage('housekeeping', {\n      room: task.room,\n      description: '× ×™×§×™×•×Ÿ ×œ××—×¨ ×¦\\'×§-×××•×˜',\n      priority: '×’×‘×•×”×”',\n    });\n    \n    return {\n      success: true,\n      checkout: {\n        room: task.room,\n        guestName: task.guestName,\n        processedAt: new Date().toISOString(),\n      },\n      displayMessage: i18n.t('orchestrator.messages.checkoutDone', { room: task.room }),\n    };\n  }\n}\n\n/**\n * Maya - The Master Orchestrator\n * Manages all agents and handles high-level decisions\n */\nclass MayaOrchestrator {\n  constructor() {\n    this.agents = {\n      [AGENT_TYPES.SCRAPER]: new ScraperAgent(),\n      [AGENT_TYPES.MARKETING]: new MarketingAgent(),\n      [AGENT_TYPES.CREATIVE]: new CreativeAgent(),\n      [AGENT_TYPES.SALES]: new SalesAgent(),\n      [AGENT_TYPES.OPERATIONS]: new OperationsAgent(),\n    };\n    \n    this.taskHistory = [];\n    this.isProcessing = false;\n    this.systemPrompt = MAYA_SYSTEM_PROMPT;\n  }\n\n  /**\n   * Execute a task using the appropriate agent\n   */\n  async executeTask(agentType, task) {\n    const agent = this.agents[agentType];\n    \n    if (!agent) {\n      throw new Error(`Agent ${agentType} not found`);\n    }\n    \n    const taskRecord = {\n      id: Date.now(),\n      agentType,\n      task,\n      startedAt: new Date().toISOString(),\n      status: 'running',\n    };\n    \n    this.taskHistory.push(taskRecord);\n    \n    try {\n      const result = await agent.execute(task);\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'completed';\n      taskRecord.result = result;\n      return result;\n    } catch (error) {\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'failed';\n      taskRecord.error = error.message;\n      throw error;\n    }\n  }\n\n  /**\n   * Get all agent statuses\n   */\n  getAgentStatuses() {\n    return Object.entries(this.agents).reduce((acc, [type, agent]) => {\n      acc[type] = {\n        status: agent.status,\n        name: agent.name,\n        description: agent.description,\n      };\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Fetch property context (details + staff) for AI to answer guest queries\n   */\n  async getPropertyContext() {\n    try {\n      const ctx = await getAIPropertyContext();\n      return ctx.summary_for_ai || ctx.properties?.length\n        ? `Property context: ${ctx.summary_for_ai || 'No details.'}`\n        : '';\n    } catch (e) {\n      return '';\n    }\n  }\n\n  /**\n   * Process natural language command from Maya chat\n   */\n  async processCommand(command) {\n    const lowerCommand = command.toLowerCase();\n\n    // \"Send this to Kobi\" / \"Send to Alma\" - open WhatsApp for selected task\n    const sendToRegex = /(?:send|×©×œ×—).*(kobi|alma|avi|×§×•×‘×™|×¢×œ×ž×”|××‘×™)|(kobi|alma|avi|×§×•×‘×™|×¢×œ×ž×”|××‘×™).*(?:send|×©×œ×—)/i;\n    const sendToMatch = command.match(sendToRegex);\n    if (sendToMatch) {\n      const namePart = (sendToMatch[1] || sendToMatch[2] || '').toLowerCase();\n      const nameMap = { ×§×•×‘×™: 'kobi', ×¢×œ×ž×”: 'alma', ××‘×™: 'avi' };\n      const staffKey = nameMap[namePart] || namePart;\n      const lastTask = useStore.getState?.()?.lastSelectedTask;\n      if (lastTask) {\n        const ctx = await getAIPropertyContext();\n        const staffMap = {};\n        if (ctx.staff_by_property) {\n          for (const list of Object.values(ctx.staff_by_property)) {\n            for (const s of list) {\n              const n = (s.name || '').toLowerCase();\n              if (n && !staffMap[n]) staffMap[n] = s.phone_number || s.phone || '';\n            }\n          }\n        }\n        const targetPhone = staffMap[staffKey] || Object.entries(staffMap).find(([k]) => k.includes(staffKey) || staffKey.includes(k))?.[1];\n        if (targetPhone) {\n          const { toWhatsAppPhone } = await import('../utils/phone');\n          const content = String(lastTask.description || lastTask.title || lastTask.content || '').slice(0, 120);\n          const msg = `×”×™×™, ×™×© ×œ×š ×ž×©×™×ž×”: ${content}`;\n          const url = `https://wa.me/${toWhatsAppPhone(targetPhone)}?text=${encodeURIComponent(msg)}`;\n          if (typeof window !== 'undefined') window.open(url, '_blank');\n          return {\n            success: true,\n            message: `Opened WhatsApp for ${staffKey}`,\n            displayMessage: `× ×¤×ª×— ×•×•××˜×¡××¤ ×¢×‘×•×¨ ${staffKey}`,\n          };\n        }\n      } else {\n        return {\n          success: true,\n          message: 'Click a task card first, then say \"Send to Kobi\"',\n          displayMessage: '×œ×—×¥ ×¢×œ ×›×¨×˜×™×¡ ×ž×©×™×ž×” ×•××– ××ž×•×¨ \"×©×œ×— ×œ×§×•×‘×™\"',\n        };\n      }\n    }\n\n    if (lowerCommand.includes('× ×¨××” ××•×ª×” ×ž× ×”×œ×ª') || lowerCommand.includes('×‘×•× × ×¨××” ××•×ª×” ×ž× ×”×œ×ª') || lowerCommand.includes('maya manage')) {\n      try {\n        const tasks = await getPropertyTasks();\n        const tasksForAnalysis = (tasks || []).map((t) => ({\n          desc: (t.description || t.title || t.content || '').slice(0, 100),\n          staff: t.staff_name || t.staffName || '',\n          property: t.property_name || t.propertyName || '',\n          status: t.status || 'Pending',\n        }));\n        const result = await sendMayaCommand('×‘×•× × ×¨××” ××•×ª×” ×ž× ×”×œ×ª', tasksForAnalysis);\n        if (result.success) {\n          return {\n            success: true,\n            message: result.message,\n            displayMessage: result.displayMessage || result.message,\n          };\n        }\n      } catch (e) {\n        return {\n          success: true,\n          message: `×™×© ×œ× ×• ${(await getPropertyTasks()).filter((t) => (t.status || '').toLowerCase() !== 'done').length} ×ž×©×™×ž×•×ª ×¤×ª×•×—×•×ª. ×”×× ×œ×”×•×¦×™× ×ª×–×›×•×¨×ª?`,\n          displayMessage: `×™×© ×œ× ×• ×ž×©×™×ž×•×ª ×¤×ª×•×—×•×ª. ×”×× ×œ×”×•×¦×™× ×ª×–×›×•×¨×ª?`,\n        };\n      }\n    }\n\n    if (lowerCommand.includes('daily report') || lowerCommand.includes('×“×•×— ×™×•×ž×™') || lowerCommand.includes('generate daily report')) {\n      try {\n        const result = await sendMayaCommand(command);\n        if (result.success && result.message) {\n          return {\n            success: true,\n            message: result.message,\n            displayMessage: result.displayMessage || result.message,\n          };\n        }\n      } catch (e) {\n        const tasks = await getPropertyTasks();\n        const today = new Date().toISOString().slice(0, 10);\n        const doneToday = tasks.filter((t) => {\n          const s = (t.status || '').toLowerCase();\n          const isDone = s === 'done' || s === 'completed';\n          const d = (t.created_at || t.updated_at || '').slice(0, 10);\n          return isDone && d === today;\n        });\n        const pending = tasks.filter((t) => (t.status || '').toLowerCase() !== 'done' && (t.status || '').toLowerCase() !== 'completed');\n        const summary = `×“×•×— ×™×•×ž×™: ${doneToday.length} ×ž×©×™×ž×•×ª ×”×•×©×œ×ž×• ×”×™×•×. ${pending.length} ×ž×ž×ª×™× ×•×ª.`;\n        return { success: true, message: summary, displayMessage: summary };\n      }\n    }\n    \n    if (lowerCommand.includes('property') || lowerCommand.includes('villa') || lowerCommand.includes('× ×›×¡') || lowerCommand.includes('×•×•×™×œ×”') || lowerCommand.includes('guests') || lowerCommand.includes('××•×¨×—×™×') || lowerCommand.includes('bedroom') || lowerCommand.includes('×›×ž×” ×—×“×¨×™×') || lowerCommand.includes('how many')) {\n      const ctx = await getAIPropertyContext();\n      const summary = ctx.summary_for_ai || 'No properties in database.';\n      return {\n        success: true,\n        message: summary,\n        displayMessage: summary,\n        properties: ctx.properties,\n      };\n    }\n    \n    if (lowerCommand.includes('staff') || lowerCommand.includes('×¢×•×‘×“') || lowerCommand.includes('×ž× ×§×”') || lowerCommand.includes('who to contact')) {\n      const ctx = await getAIPropertyContext();\n      const lines = [];\n      if (ctx.staff_by_property) {\n        for (const [pid, staff] of Object.entries(ctx.staff_by_property)) {\n          const prop = (ctx.properties || []).find((p) => p.id === pid);\n          const pName = prop?.name || pid;\n          const sStr = staff.map((s) => `${s.name} (${s.role})`).join(', ') || 'None';\n          lines.push(`${pName}: ${sStr}`);\n        }\n      }\n      const msg = lines.length ? lines.join('\\n') : 'No staff assigned.';\n      return { success: true, message: msg, displayMessage: msg };\n    }\n    \n    if (lowerCommand.includes('lead') || lowerCommand.includes('scan') || lowerCommand.includes('airbnb') || lowerCommand.includes('×œ×™×“') || lowerCommand.includes('×¡×¨×™×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SCRAPER, { platforms: ['airbnb', 'booking'] });\n    }\n    \n    if (lowerCommand.includes('post') || lowerCommand.includes('marketing') || lowerCommand.includes('campaign') || lowerCommand.includes('×¤×•×¡×˜') || lowerCommand.includes('×©×™×•×•×§') || lowerCommand.includes('×§×ž×¤×™×™×Ÿ')) {\n      return await this.executeTask(AGENT_TYPES.MARKETING, {\n        type: 'social_post',\n        content: { text: 'New hotel post', platforms: ['instagram', 'facebook'] },\n      });\n    }\n    \n    if (lowerCommand.includes('video') || lowerCommand.includes('image') || lowerCommand.includes('edit') || lowerCommand.includes('×•×™×“××•') || lowerCommand.includes('×ª×ž×•× ') || lowerCommand.includes('×¢×¨×™×›×”')) {\n      return await this.executeTask(AGENT_TYPES.CREATIVE, {\n        type: 'enhance_images',\n        images: ['https://example.com/room1.jpg'],\n      });\n    }\n    \n    if (lowerCommand.includes('demo') || lowerCommand.includes('deal') || lowerCommand.includes('sales') || lowerCommand.includes('×“×ž×•') || lowerCommand.includes('×ž×›×™×¨') || lowerCommand.includes('×¢×¡×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SALES, {\n        type: 'send_demo',\n        lead: { id: Date.now(), name: 'New lead' },\n      });\n    }\n    \n    const taskTriggers = /towel|clean|maintenance|room|fix|repair|broken|service|needs cleaning|prepare|guests|×ž×’×‘×ª|× ×™×§×™×•×Ÿ|×ª×—×–×•×§×”|×—×“×¨|dirty|×ž×œ×•×›×œ×š|×ª×§×Ÿ|×”×›×•×‘×¡|×ž× ×§×”|×©×™×¨×•×ª|×ª×™×§×•×Ÿ|cleaner|tell the cleaner|tell\\s+\\w+\\s+to|add\\s+task|create\\s+task|×¢×œ×ž×”|×§×•×‘×™|××‘×™|tell\\s+alma|tell\\s+kobi|×§×¦×¨|×—×©×ž×œ|electrical|short circuit/i;\n    if (taskTriggers.test(command)) {\n      try {\n        const geminiResult = await sendMayaCommand(command);\n        if (geminiResult.success) {\n          const taskCreated = geminiResult.taskCreated || geminiResult.action === 'add_task' || !!geminiResult.task;\n          if (taskCreated) {\n            window.dispatchEvent(new CustomEvent('maya-task-created', { detail: { task: geminiResult.task } }));\n          }\n          return {\n            success: true,\n            message: geminiResult.message || geminiResult.displayMessage,\n            displayMessage: geminiResult.displayMessage || geminiResult.message,\n            taskCreated,\n          };\n        }\n      } catch (e) {\n        if (e?.status === 503 || (e?.message || '').includes('×ž×ª×—×‘×¨') || (e?.message || '').toLowerCase().includes('failed')) {\n          throw e;\n        }\n        console.warn('[Maya] Gemini fallback:', e?.message);\n      }\n      const roomMatch = command.match(/\\d+/);\n      const room = roomMatch ? roomMatch[0] : '101';\n      const ctx = await getAIPropertyContext();\n      const propertyContext = ctx.summary_for_ai || '';\n      const staffList = ctx.staff_by_property\n        ? Object.values(ctx.staff_by_property).flat()\n        : [];\n      const staffByProperty = ctx.staff_by_property || {};\n      const properties = ctx.properties || [];\n      const isMaintenance = /maintenance|fix|×ª×—×–×•×§×”|×ª×§×Ÿ/i.test(command);\n      const isCleaning = /clean|towel|dirty|×ž×’×‘×ª|× ×™×§×™×•×Ÿ|×ž×œ×•×›×œ×š|×ž× ×§×”|×”×›×•×‘×¡/i.test(command);\n      const taskType = isMaintenance ? 'maintenance_request' : isCleaning ? 'request_cleaning' : 'request_towels';\n      return await this.executeTask(AGENT_TYPES.OPERATIONS, {\n        type: taskType,\n        room,\n        description: command,\n        propertyContext,\n        staff: staffList,\n        staffByProperty,\n        properties,\n      });\n    }\n    \n    // Default response\n    return {\n      success: true,\n      message: i18n.t('orchestrator.messages.unknown'),\n    };\n  }\n\n  /**\n   * Get task history\n   */\n  getTaskHistory(limit = 50) {\n    return this.taskHistory.slice(-limit).reverse();\n  }\n\n  /**\n   * Generate daily report\n   */\n  async generateDailyReport() {\n    const response = await fetch(`${API_BASE_URL}/api/reports/daily`, {\n      headers: { ...getAuthHeaders() },\n    });\n    if (!response.ok) {\n      throw new Error('Failed to generate report');\n    }\n    const data = await response.json();\n    return data.report || data;\n  }\n}\n\n// Singleton instance\nexport const maya = new MayaOrchestrator();\n\nexport default maya;\n"],"mappings":";AAAA;AACA;AACA;AACA;AACA;;AAEA,SAASA,YAAY,QAAQ,oBAAoB;AACjD,SAASC,oBAAoB,EAAEC,kBAAkB,EAAEC,eAAe,EAAEC,gBAAgB,QAAQ,OAAO;AACnG,OAAOC,QAAQ,MAAM,mBAAmB;AACxC,SAASC,aAAa,QAAQ,qBAAqB;AACnD,OAAOC,IAAI,MAAM,SAAS;AAE1B,MAAMC,cAAc,GAAGA,CAAA,KAAM;EAC3B,IAAI;IAAA,IAAAC,aAAA,EAAAC,cAAA;IACF,MAAMC,GAAG,GAAGC,YAAY,CAACC,OAAO,CAAC,0BAA0B,CAAC;IAC5D,IAAI,CAACF,GAAG,EAAE,OAAO,CAAC,CAAC;IACnB,MAAMG,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACL,GAAG,CAAC;IAC9B,MAAMM,KAAK,GAAGH,MAAM,aAANA,MAAM,wBAAAL,aAAA,GAANK,MAAM,CAAEI,KAAK,cAAAT,aAAA,uBAAbA,aAAA,CAAeU,SAAS;IACtC,MAAMC,QAAQ,GAAGN,MAAM,aAANA,MAAM,wBAAAJ,cAAA,GAANI,MAAM,CAAEI,KAAK,cAAAR,cAAA,uBAAbA,cAAA,CAAeW,cAAc;IAC9C,MAAMC,OAAO,GAAG,CAAC,CAAC;IAClB,IAAIL,KAAK,EAAEK,OAAO,CAACC,aAAa,GAAG,UAAUN,KAAK,EAAE;IACpD,IAAIG,QAAQ,EAAEE,OAAO,CAAC,aAAa,CAAC,GAAGF,QAAQ;IAC/C,OAAOE,OAAO;EAChB,CAAC,CAAC,OAAOE,KAAK,EAAE;IACd,OAAO,CAAC,CAAC;EACX;AACF,CAAC;AAED,MAAMC,kBAAkB,GAAG;AAC3B;AACA;AACA;AACA;AACA;AACA,EAAEnB,aAAa,CAACoB,cAAc,CAACC,IAAI;AACnC,EAAErB,aAAa,CAACsB,YAAY,CAACD,IAAI;AACjC,EAAE,EAAAE,qBAAA,GAAAvB,aAAa,CAACwB,YAAY,cAAAD,qBAAA,uBAA1BA,qBAAA,CAA4BF,IAAI,KAAI,EAAE;AACxC,EAAErB,aAAa,CAACyB,WAAW,CAACJ,IAAI;AAChC,EAAErB,aAAa,CAAC0B,eAAe,CAACL,IAAI;AACpC,CAAC,CAACM,IAAI,CAAC,CAAC;;AAER;AACA,OAAO,MAAMC,WAAW,GAAG;EACzBC,OAAO,EAAE,SAAS;EAClBC,SAAS,EAAE,WAAW;EACtBC,QAAQ,EAAE,UAAU;EACpBC,KAAK,EAAE,OAAO;EACdC,UAAU,EAAE;AACd,CAAC;;AAED;AACA,OAAO,MAAMC,YAAY,GAAG;EAC1BC,MAAM,EAAE,QAAQ;EAChBC,IAAI,EAAE,MAAM;EACZC,OAAO,EAAE,SAAS;EAClBC,KAAK,EAAE;AACT,CAAC;;AAED;AACA;AACA;AACA,MAAMC,SAAS,CAAC;EACdC,WAAWA,CAACC,EAAE,EAAEC,IAAI,EAAEC,WAAW,EAAE;IACjC,IAAI,CAACF,EAAE,GAAGA,EAAE;IACZ,IAAI,CAACC,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACC,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,MAAM,GAAGV,YAAY,CAACC,MAAM;IACjC,IAAI,CAACU,SAAS,GAAG,EAAE;IACnB,IAAI,CAACC,cAAc,GAAG,EAAE;EAC1B;EAEA,MAAMC,OAAOA,CAACC,IAAI,EAAE;IAClB,MAAM,IAAIC,KAAK,CAAC,oCAAoC,CAAC;EACvD;EAEAC,SAASA,CAAA,EAAG;IACV,OAAO,IAAI,CAACN,MAAM;EACpB;EAEAO,SAASA,CAACP,MAAM,EAAE;IAChB,IAAI,CAACA,MAAM,GAAGA,MAAM;EACtB;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAMQ,YAAY,SAASb,SAAS,CAAC;EAC1CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACC,OAAO,EACnB,eAAe,EACf,wDACF,CAAC;IACD,IAAI,CAACwB,UAAU,GAAG,CAAC;IACnB,IAAI,CAACC,QAAQ,GAAG,IAAI;EACtB;EAEA,MAAMP,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,MAAMmB,KAAK,GAAG,MAAM,IAAI,CAACC,aAAa,CAACR,IAAI,CAACS,SAAS,IAAI,CAAC,QAAQ,EAAE,SAAS,CAAC,EAAET,IAAI,CAACU,QAAQ,CAAC;MAE9F,IAAI,CAACL,UAAU,IAAIE,KAAK,CAACI,MAAM;MAC/B,IAAI,CAACL,QAAQ,GAAG,IAAIM,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACxC,IAAI,CAACV,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MAEnC,OAAO;QACL2B,OAAO,EAAE,IAAI;QACbP,KAAK;QACLQ,SAAS,EAAE,IAAI,CAACT,QAAQ;QACxBU,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,kCAAkC,EAAE;UAAEC,KAAK,EAAEX,KAAK,CAACI;QAAO,CAAC;MAC7E,CAAC;IACH,CAAC,CAAC,OAAOzC,KAAK,EAAE;MACd,IAAI,CAACiC,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMpB,KAAK;IACb;EACF;EAEA,MAAMsC,aAAaA,CAACC,SAAS,EAAEC,QAAQ,GAAG,QAAQ,EAAE;IAClD,MAAMS,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG1E,YAAY,wBAAwB,EAAE;MACpE2E,MAAM,EAAE,MAAM;MACdrD,OAAO,EAAE;QAAE,cAAc,EAAE,kBAAkB;QAAE,GAAGd,cAAc,CAAC;MAAE,CAAC;MACpEoE,IAAI,EAAE7D,IAAI,CAAC8D,SAAS,CAAC;QAAEd,SAAS;QAAEC;MAAS,CAAC;IAC9C,CAAC,CAAC;IAEF,IAAI,CAACS,QAAQ,CAACK,EAAE,EAAE;MAChB,MAAM,IAAIvB,KAAK,CAAC,0BAA0B,CAAC;IAC7C;IAEA,MAAMwB,IAAI,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;IAClC,OAAOD,IAAI,CAAClB,KAAK,IAAI,EAAE;EACzB;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAMoB,cAAc,SAASpC,SAAS,CAAC;EAC5CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACE,SAAS,EACrB,iBAAiB,EACjB,0CACF,CAAC;IACD,IAAI,CAAC8C,YAAY,GAAG,CAAC;IACrB,IAAI,CAACC,aAAa,GAAG,CAAC;EACxB;EAEA,MAAM9B,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,aAAa;UAChBD,MAAM,GAAG,MAAM,IAAI,CAACE,gBAAgB,CAAChC,IAAI,CAACiC,OAAO,CAAC;UAClD,IAAI,CAACL,YAAY,EAAE;UACnB;QACF,KAAK,gBAAgB;UACnBE,MAAM,GAAG,MAAM,IAAI,CAACI,mBAAmB,CAAClC,IAAI,CAACmC,QAAQ,CAAC;UACtD,IAAI,CAACN,aAAa,EAAE;UACpB;QACF;UACE,MAAM,IAAI5B,KAAK,CAAC,sBAAsBD,IAAI,CAAC+B,IAAI,EAAE,CAAC;MACtD;MAEA,IAAI,CAAC5B,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO5D,KAAK,EAAE;MACd,IAAI,CAACiC,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMpB,KAAK;IACb;EACF;EAEA,MAAM8D,gBAAgBA,CAACC,OAAO,EAAE;IAC9B,MAAM,IAAIG,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbyB,IAAI,EAAE;QACJ9C,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdP,OAAO,EAAEA,OAAO,CAACQ,IAAI;QACrBhC,SAAS,EAAEwB,OAAO,CAACxB,SAAS,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC;QACzDiC,YAAY,EAAET,OAAO,CAACS,YAAY,IAAI,IAAI9B,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MAC/D,CAAC;MACDG,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,mCAAmC;IACrD,CAAC;EACH;EAEA,MAAMiB,mBAAmBA,CAACC,QAAQ,EAAE;IAClC,MAAM,IAAIC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbqB,QAAQ,EAAE;QACR1C,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdG,OAAO,EAAER,QAAQ,CAACQ,OAAO;QACzBC,UAAU,EAAET,QAAQ,CAACS,UAAU,IAAI,GAAG;QACtCC,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MACjC,CAAC;MACDG,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,oCAAoC,EAAE;QAAEC,KAAK,EAAEiB,QAAQ,CAACS,UAAU,IAAI;MAAI,CAAC;IAC7F,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAME,aAAa,SAASvD,SAAS,CAAC;EAC3CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACG,QAAQ,EACpB,gBAAgB,EAChB,mDACF,CAAC;IACD,IAAI,CAACgE,aAAa,GAAG,CAAC;EACxB;EAEA,MAAMhD,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,YAAY;UACfD,MAAM,GAAG,MAAM,IAAI,CAACkB,SAAS,CAAChD,IAAI,CAACiD,KAAK,CAAC;UACzC;QACF,KAAK,gBAAgB;UACnBnB,MAAM,GAAG,MAAM,IAAI,CAACoB,aAAa,CAAClD,IAAI,CAACmD,MAAM,CAAC;UAC9C;QACF,KAAK,qBAAqB;UACxBrB,MAAM,GAAG,MAAM,IAAI,CAACsB,iBAAiB,CAACpD,IAAI,CAACqD,QAAQ,CAAC;UACpD;QACF;UACE,MAAM,IAAIpD,KAAK,CAAC,sBAAsBD,IAAI,CAAC+B,IAAI,EAAE,CAAC;MACtD;MAEA,IAAI,CAACgB,aAAa,EAAE;MACpB,IAAI,CAAC5C,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO5D,KAAK,EAAE;MACd,IAAI,CAACiC,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMpB,KAAK;IACb;EACF;EAEA,MAAM8E,SAASA,CAACC,KAAK,EAAE;IACrB,MAAM,IAAIb,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbmC,KAAK,EAAE;QACLxD,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdc,WAAW,EAAEL,KAAK,CAACM,GAAG;QACtBC,SAAS,EAAEP,KAAK,CAACM,GAAG,GAAG,cAAc;QACrCE,QAAQ,EAAE;MACZ,CAAC;MACDzC,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,mCAAmC;IACrD,CAAC;EACH;EAEA,MAAMiC,aAAaA,CAACC,MAAM,EAAE;IAC1B,MAAM,IAAIf,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbqC,MAAM,EAAEA,MAAM,CAACO,GAAG,CAAC,CAACC,GAAG,EAAEC,CAAC,MAAM;QAC9BnE,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC,GAAGoB,CAAC;QAClBN,WAAW,EAAEK,GAAG;QAChBE,WAAW,EAAEF,GAAG,GAAG;MACrB,CAAC,CAAC,CAAC;MACH3C,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,sCAAsC,EAAE;QAAEC,KAAK,EAAEiC,MAAM,CAACxC;MAAO,CAAC;IAClF,CAAC;EACH;EAEA,MAAMyC,iBAAiBA,CAACC,QAAQ,EAAE;IAChC,MAAM,IAAIjB,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbgD,IAAI,EAAE;QACJrE,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACduB,UAAU,EAAEV,QAAQ,CAAC5D,EAAE;QACvBuE,OAAO,EAAE,0BAA0BX,QAAQ,CAAC5D,EAAE;MAChD,CAAC;MACDuB,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,mCAAmC;IACrD,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAMgD,UAAU,SAAS1E,SAAS,CAAC;EACxCC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACI,KAAK,EACjB,qBAAqB,EACrB,4CACF,CAAC;IACD,IAAI,CAACkF,eAAe,GAAG,CAAC;IACxB,IAAI,CAACC,gBAAgB,GAAG,CAAC;EAC3B;EAEA,MAAMpE,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,WAAW;UACdD,MAAM,GAAG,MAAM,IAAI,CAACsC,QAAQ,CAACpE,IAAI,CAACqE,IAAI,CAAC;UACvC;QACF,KAAK,WAAW;UACdvC,MAAM,GAAG,MAAM,IAAI,CAACwC,iBAAiB,CAACtE,IAAI,CAACuE,IAAI,CAAC;UAChD;QACF,KAAK,WAAW;UACdzC,MAAM,GAAG,MAAM,IAAI,CAAC0C,QAAQ,CAACxE,IAAI,CAACyE,MAAM,CAAC;UACzC;QACF;UACE,MAAM,IAAIxE,KAAK,CAAC,sBAAsBD,IAAI,CAAC+B,IAAI,EAAE,CAAC;MACtD;MAEA,IAAI,CAAC5B,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO5D,KAAK,EAAE;MACd,IAAI,CAACiC,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMpB,KAAK;IACb;EACF;EAEA,MAAMkG,QAAQA,CAACC,IAAI,EAAE;IACnB,MAAM,IAAIjC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,IAAI,CAAC6B,eAAe,EAAE;IAEtB,OAAO;MACLpD,OAAO,EAAE,IAAI;MACb4D,IAAI,EAAE;QACJjF,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdiC,MAAM,EAAEJ,IAAI,CAAC5E,EAAE;QACfkF,OAAO,EAAE,yBAAyBN,IAAI,CAAC5E,EAAE,EAAE;QAC3CoD,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MACjC,CAAC;MACDG,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,gCAAgC,EAAE;QAAEvB,IAAI,EAAE2E,IAAI,CAAC3E,IAAI,IAAI;MAAO,CAAC;IACjF,CAAC;EACH;EAEA,MAAM4E,iBAAiBA,CAACC,IAAI,EAAE;IAC5B,MAAM,IAAInC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACb8D,WAAW,EAAE;QACXnF,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdqC,MAAM,EAAEN,IAAI,CAAC9E,EAAE;QACfqF,KAAK,EAAE,eAAe;QACtBC,UAAU,EAAE;MACd,CAAC;MACD/D,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,0CAA0C;IAC5D,CAAC;EACH;EAEA,MAAMuD,QAAQA,CAACC,MAAM,EAAE;IACrB,MAAM,IAAIrC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACb0D,QAAQ,EAAE;QACRC,MAAM;QACN5B,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;QAChCkB,IAAI,EAAE;MACR,CAAC;MACDf,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,oCAAoC;IACtD,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAM+D,eAAe,SAASzF,SAAS,CAAC;EAC7CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACK,UAAU,EACtB,kBAAkB,EAClB,2DACF,CAAC;IACD,IAAI,CAACgG,YAAY,GAAG,CAAC;IACrB,IAAI,CAACC,aAAa,GAAG,CAAC;EACxB;EAEA,MAAMnF,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,gBAAgB;UACnBD,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,cAAc,EAAEnF,IAAI,CAAC;UAC1D;QACF,KAAK,kBAAkB;UACrB8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,cAAc,EAAEnF,IAAI,CAAC;UAC1D;QACF,KAAK,qBAAqB;UACxB8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,aAAa,EAAEnF,IAAI,CAAC;UACzD;QACF,KAAK,cAAc;UACjB8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,cAAc,EAAEnF,IAAI,CAAC;UAC1D;QACF,KAAK,gBAAgB;UACnB8B,MAAM,GAAG,MAAM,IAAI,CAACsD,cAAc,CAACpF,IAAI,CAAC;UACxC;QACF;UACE8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,SAAS,EAAEnF,IAAI,CAAC;MACzD;MAEA,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO5D,KAAK,EAAE;MACd,IAAI,CAACiC,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMpB,KAAK;IACb;EACF;EAEA,MAAMiH,gBAAgBA,CAACE,UAAU,EAAErF,IAAI,EAAE;IAAA,IAAAsF,cAAA,EAAAC,eAAA,EAAAC,eAAA,EAAAC,eAAA;IACvC,MAAM,IAAIrD,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,GAAG,CAAC,CAAC;IAE5C,IAAI,CAAC4C,YAAY,EAAE;IACnB,IAAI,CAACC,aAAa,EAAE;IAEpB,MAAMQ,eAAe,GAAG1F,IAAI,CAAC0F,eAAe,IAAI,CAAC,CAAC;IAClD,MAAMC,UAAU,GAAG3F,IAAI,CAAC2F,UAAU,IAAI,EAAE;IACxC,IAAIC,aAAa,GAAG,IAAI;IACxB,IAAIC,YAAY,GAAG,EAAE;IACrB,IAAI9B,UAAU,GAAG,EAAE;IACnB,IAAI+B,eAAe,GAAG,EAAE;IACxB,MAAMC,aAAa,GAAGV,UAAU,KAAK,aAAa;IAClD,MAAMW,UAAU,GAAGD,aAAa,GAAG,MAAM,GAAG,MAAM;IAClD,MAAME,WAAW,GAAGF,aAAa,GAC7B,oBAAoB,GACpB,2CAA2C;IAE/C,KAAK,MAAM,CAACG,GAAG,EAAEC,SAAS,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACX,eAAe,CAAC,EAAE;MAC9D,IAAIY,CAAC,GAAGH,SAAS,CAACI,IAAI,CAAEC,CAAC,IAAK,CAACA,CAAC,CAAC9G,IAAI,IAAI,EAAE,EAAE+G,WAAW,CAAC,CAAC,KAAKT,UAAU,CAAC;MAC1E,IAAI,CAACM,CAAC,EAAEA,CAAC,GAAGH,SAAS,CAACI,IAAI,CAAEC,CAAC,IAAKP,WAAW,CAACS,IAAI,CAACF,CAAC,CAACG,IAAI,IAAI,EAAE,CAAC,CAAC;MACjE,IAAIL,CAAC,EAAE;QAAA,IAAAM,gBAAA,EAAAC,cAAA,EAAAC,UAAA;QACLlB,aAAa,GAAGU,CAAC;QACjBvC,UAAU,GAAGmC,GAAG;QAChB,MAAMa,IAAI,GAAGpB,UAAU,CAACY,IAAI,CAAES,CAAC,IAAKA,CAAC,CAACvH,EAAE,KAAKyG,GAAG,CAAC;QACjDL,YAAY,GAAG,CAAAkB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAErH,IAAI,KAAI,MAAM;QACnC,MAAMuH,CAAC,IAAAL,gBAAA,GAAGG,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,UAAU,cAAAN,gBAAA,cAAAA,gBAAA,GAAI,CAAC;QAC/B,MAAMO,EAAE,IAAAN,cAAA,GAAGE,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,QAAQ,cAAAP,cAAA,cAAAA,cAAA,GAAI,CAAC;QAC9B,MAAMQ,CAAC,IAAAP,UAAA,GAAGC,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEO,IAAI,cAAAR,UAAA,cAAAA,UAAA,GAAI,CAAC;QACzBhB,eAAe,GAAG,GAAGmB,CAAC,YAAYE,EAAE,aAAaE,CAAC,MAAM;QACxD;MACF;IACF;IACA,IAAI,CAACzB,aAAa,IAAIQ,MAAM,CAACmB,MAAM,CAAC7B,eAAe,CAAC,CAAC8B,IAAI,CAAC,CAAC,CAAC7G,MAAM,GAAG,CAAC,EAAE;MAAA,IAAA8G,iBAAA,EAAAC,eAAA,EAAAC,WAAA;MACtE,MAAMC,KAAK,GAAGxB,MAAM,CAACC,OAAO,CAACX,eAAe,CAAC,CAAC,CAAC,CAAC;MAChDE,aAAa,GAAGgC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAC3B7D,UAAU,GAAG6D,KAAK,CAAC,CAAC,CAAC;MACrB,MAAMb,IAAI,GAAGpB,UAAU,CAACY,IAAI,CAAES,CAAC,IAAKA,CAAC,CAACvH,EAAE,KAAKmI,KAAK,CAAC,CAAC,CAAC,CAAC;MACtD/B,YAAY,GAAG,CAAAkB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAErH,IAAI,KAAI,MAAM;MACnC,MAAMuH,CAAC,IAAAQ,iBAAA,GAAGV,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,UAAU,cAAAO,iBAAA,cAAAA,iBAAA,GAAI,CAAC;MAC/B,MAAMN,EAAE,IAAAO,eAAA,GAAGX,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,QAAQ,cAAAM,eAAA,cAAAA,eAAA,GAAI,CAAC;MAC9B,MAAML,CAAC,IAAAM,WAAA,GAAGZ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEO,IAAI,cAAAK,WAAA,cAAAA,WAAA,GAAI,CAAC;MACzB7B,eAAe,GAAG,GAAGmB,CAAC,YAAYE,EAAE,aAAaE,CAAC,MAAM;IAC1D;IACA,IAAI,CAACtD,UAAU,IAAI4B,UAAU,CAAChF,MAAM,GAAG,CAAC,EAAE;MAAA,IAAAkH,iBAAA,EAAAC,eAAA,EAAAC,WAAA;MACxC,MAAMhB,IAAI,GAAGpB,UAAU,CAAC,CAAC,CAAC;MAC1B5B,UAAU,GAAGgD,IAAI,CAACtH,EAAE;MACpBoG,YAAY,GAAG,CAAAkB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAErH,IAAI,KAAI,MAAM;MACnC,MAAMuH,CAAC,IAAAY,iBAAA,GAAGd,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,UAAU,cAAAW,iBAAA,cAAAA,iBAAA,GAAI,CAAC;MAC/B,MAAMV,EAAE,IAAAW,eAAA,GAAGf,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,QAAQ,cAAAU,eAAA,cAAAA,eAAA,GAAI,CAAC;MAC9B,MAAMT,CAAC,IAAAU,WAAA,GAAGhB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEO,IAAI,cAAAS,WAAA,cAAAA,WAAA,GAAI,CAAC;MACzBjC,eAAe,GAAG,GAAGmB,CAAC,YAAYE,EAAE,aAAaE,CAAC,MAAM;MACxD,MAAMW,YAAY,GAAGtC,eAAe,CAACqB,IAAI,CAACtH,EAAE,CAAC;MAC7C,IAAI,CAAAuI,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAErH,MAAM,IAAG,CAAC,IAAI,CAACiF,aAAa,EAAE;QAC9CA,aAAa,GAAGoC,YAAY,CAAC,CAAC,CAAC;MACjC;IACF;IAEA,MAAMC,SAAS,GAAG,EAAA3C,cAAA,GAAAM,aAAa,cAAAN,cAAA,uBAAbA,cAAA,CAAe5F,IAAI,KAAI,OAAO;IAChD,MAAMwI,KAAK,GAAG,EAAA3C,eAAA,GAAAK,aAAa,cAAAL,eAAA,uBAAbA,eAAA,CAAe4C,YAAY,OAAA3C,eAAA,GAAII,aAAa,cAAAJ,eAAA,uBAAbA,eAAA,CAAe0C,KAAK;IACjE,MAAME,OAAO,GAAG,EAAA3C,eAAA,GAAAG,aAAa,cAAAH,eAAA,uBAAbA,eAAA,CAAehG,EAAE,KAAI,EAAE;IACvC,MAAM4I,cAAc,GAAGH,KAAK,GACxB,kBAAkBD,SAAS,OAAOC,KAAK,EAAE,GACzC,kBAAkBD,SAAS,kEAAkE;IAEjG,MAAMjH,OAAO,GAAG,IAAI,CAACsH,eAAe,CAACjD,UAAU,EAAErF,IAAI,EAAE;MAAEiI,SAAS;MAAEpC;IAAa,CAAC,CAAC;IACnF,MAAM0C,aAAa,GAAGL,KAAK,IAAIrC,YAAY,GACvC,OAAOoC,SAAS,mBAAmBpC,YAAY,KAAK7F,IAAI,CAACL,WAAW,IAAI,oBAAoB,kBAAkB,GAC9G,IAAI;IAER,IAAI6I,WAAW,GAAG,KAAK;IACvB,IAAI;MACF,MAAM5L,kBAAkB,CAAC;QACvB6L,WAAW,EAAE1E,UAAU;QACvB2E,WAAW,EAAEN,OAAO;QACpBzI,WAAW,EAAEK,IAAI,CAACL,WAAW,KAAK0F,UAAU,KAAK,cAAc,GAAG,QAAQ,GAAG,OAAO,CAAC;QACrFzF,MAAM,EAAE,SAAS;QACjB+I,aAAa,EAAE9C,YAAY;QAC3B+C,UAAU,EAAEX,SAAS;QACrBY,WAAW,EAAEX,KAAK,IAAI,EAAE;QACxBY,gBAAgB,EAAEhD;MACpB,CAAC,CAAC;MACF0C,WAAW,GAAG,IAAI;IACpB,CAAC,CAAC,OAAOO,CAAC,EAAE;MACVC,OAAO,CAACC,IAAI,CAAC,gCAAgC,EAAEF,CAAC,CAAC;IACnD;IAEA,OAAO;MACLjI,OAAO,EAAE,IAAI;MACb0H,WAAW;MACXxH,OAAO,EAAE;QACPvB,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACd6C,UAAU;QACV6D,IAAI,EAAElJ,IAAI,CAACkJ,IAAI;QACfjH,OAAO,EAAEjB,OAAO;QAChBuH,aAAa;QACbN,SAAS;QACTC,KAAK;QACLrC,YAAY;QACZhD,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;QAChCjB,MAAM,EAAE;MACV,CAAC;MACDyI;IACF,CAAC;EACH;EAEAC,eAAeA,CAACjD,UAAU,EAAErF,IAAI,EAAEmJ,KAAK,GAAG,CAAC,CAAC,EAAE;IAC5C,MAAM;MAAElB,SAAS;MAAEpC;IAAa,CAAC,GAAGsD,KAAK;IACzC,MAAMC,IAAI,GAAG;MACXC,YAAY,EAAE,qBAAqBrJ,IAAI,CAACkJ,IAAI,OAAOlJ,IAAI,CAACL,WAAW,IAAI,cAAc,4BAA4B;MACjH2J,WAAW,EAAE,wBAAwBtJ,IAAI,CAACkJ,IAAI,OAAOlJ,IAAI,CAACL,WAAW,IAAI,YAAY,kBAAkBK,IAAI,CAACuJ,QAAQ,IAAI,OAAO,EAAE;MACjIC,YAAY,EAAE,iCAAiCxJ,IAAI,CAACkJ,IAAI,KAAKlJ,IAAI,CAACyJ,KAAK,IAAI,EAAE,0BAA0BzJ,IAAI,CAAC0J,YAAY,IAAI,OAAO,EAAE;MACrIC,OAAO,EAAE,qBAAqB3J,IAAI,CAACkJ,IAAI,OAAOlJ,IAAI,CAACL,WAAW,IAAI,WAAW;IAC/E,CAAC;IACD,IAAIiK,GAAG,GAAGR,IAAI,CAAC/D,UAAU,CAAC,IAAI+D,IAAI,CAACO,OAAO;IAC1C,IAAI1B,SAAS,IAAIpC,YAAY,EAAE;MAC7B+D,GAAG,GAAG,OAAO3B,SAAS,mBAAmBpC,YAAY,QAAQ+D,GAAG,EAAE;IACpE;IACA,OAAQ5J,IAAI,CAAC6J,YAAY,GAAGD,GAAG,GAAG5J,IAAI,CAAC6J,YAAY,GAAGD,GAAG;EAC3D;EAEA,MAAMxE,cAAcA,CAACpF,IAAI,EAAE;IACzB,MAAM,IAAIoC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;;IAE7C;IACA,MAAM,IAAI,CAAC8C,gBAAgB,CAAC,cAAc,EAAE;MAC1C+D,IAAI,EAAElJ,IAAI,CAACkJ,IAAI;MACfvJ,WAAW,EAAE,uBAAuB;MACpC4J,QAAQ,EAAE;IACZ,CAAC,CAAC;IAEF,OAAO;MACLzI,OAAO,EAAE,IAAI;MACbgJ,QAAQ,EAAE;QACRZ,IAAI,EAAElJ,IAAI,CAACkJ,IAAI;QACfa,SAAS,EAAE/J,IAAI,CAAC+J,SAAS;QACzBC,WAAW,EAAE,IAAIpJ,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MACtC,CAAC;MACDwH,cAAc,EAAEpL,IAAI,CAACgE,CAAC,CAAC,oCAAoC,EAAE;QAAEiI,IAAI,EAAElJ,IAAI,CAACkJ;MAAK,CAAC;IAClF,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA;AACA,MAAMe,gBAAgB,CAAC;EACrBzK,WAAWA,CAAA,EAAG;IACZ,IAAI,CAAC0K,MAAM,GAAG;MACZ,CAACtL,WAAW,CAACC,OAAO,GAAG,IAAIuB,YAAY,CAAC,CAAC;MACzC,CAACxB,WAAW,CAACE,SAAS,GAAG,IAAI6C,cAAc,CAAC,CAAC;MAC7C,CAAC/C,WAAW,CAACG,QAAQ,GAAG,IAAI+D,aAAa,CAAC,CAAC;MAC3C,CAAClE,WAAW,CAACI,KAAK,GAAG,IAAIiF,UAAU,CAAC,CAAC;MACrC,CAACrF,WAAW,CAACK,UAAU,GAAG,IAAI+F,eAAe,CAAC;IAChD,CAAC;IAED,IAAI,CAACmF,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,YAAY,GAAG,KAAK;IACzB,IAAI,CAACC,YAAY,GAAGlM,kBAAkB;EACxC;;EAEA;AACF;AACA;EACE,MAAMmM,WAAWA,CAACC,SAAS,EAAEvK,IAAI,EAAE;IACjC,MAAMwK,KAAK,GAAG,IAAI,CAACN,MAAM,CAACK,SAAS,CAAC;IAEpC,IAAI,CAACC,KAAK,EAAE;MACV,MAAM,IAAIvK,KAAK,CAAC,SAASsK,SAAS,YAAY,CAAC;IACjD;IAEA,MAAME,UAAU,GAAG;MACjBhL,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;MACd+H,SAAS;MACTvK,IAAI;MACJ0K,SAAS,EAAE,IAAI9J,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACnCjB,MAAM,EAAE;IACV,CAAC;IAED,IAAI,CAACuK,WAAW,CAACQ,IAAI,CAACF,UAAU,CAAC;IAEjC,IAAI;MACF,MAAM3I,MAAM,GAAG,MAAM0I,KAAK,CAACzK,OAAO,CAACC,IAAI,CAAC;MACxCyK,UAAU,CAACG,WAAW,GAAG,IAAIhK,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACjD4J,UAAU,CAAC7K,MAAM,GAAG,WAAW;MAC/B6K,UAAU,CAAC3I,MAAM,GAAGA,MAAM;MAC1B,OAAOA,MAAM;IACf,CAAC,CAAC,OAAO5D,KAAK,EAAE;MACduM,UAAU,CAACG,WAAW,GAAG,IAAIhK,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACjD4J,UAAU,CAAC7K,MAAM,GAAG,QAAQ;MAC5B6K,UAAU,CAACvM,KAAK,GAAGA,KAAK,CAAC8C,OAAO;MAChC,MAAM9C,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACE2M,gBAAgBA,CAAA,EAAG;IACjB,OAAOzE,MAAM,CAACC,OAAO,CAAC,IAAI,CAAC6D,MAAM,CAAC,CAACY,MAAM,CAAC,CAACC,GAAG,EAAE,CAAChJ,IAAI,EAAEyI,KAAK,CAAC,KAAK;MAChEO,GAAG,CAAChJ,IAAI,CAAC,GAAG;QACVnC,MAAM,EAAE4K,KAAK,CAAC5K,MAAM;QACpBF,IAAI,EAAE8K,KAAK,CAAC9K,IAAI;QAChBC,WAAW,EAAE6K,KAAK,CAAC7K;MACrB,CAAC;MACD,OAAOoL,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CAAC;EACR;;EAEA;AACF;AACA;EACE,MAAMC,kBAAkBA,CAAA,EAAG;IACzB,IAAI;MAAA,IAAAC,eAAA;MACF,MAAMC,GAAG,GAAG,MAAMvO,oBAAoB,CAAC,CAAC;MACxC,OAAOuO,GAAG,CAACC,cAAc,KAAAF,eAAA,GAAIC,GAAG,CAACvF,UAAU,cAAAsF,eAAA,eAAdA,eAAA,CAAgBtK,MAAM,GAC/C,qBAAqBuK,GAAG,CAACC,cAAc,IAAI,aAAa,EAAE,GAC1D,EAAE;IACR,CAAC,CAAC,OAAOpC,CAAC,EAAE;MACV,OAAO,EAAE;IACX;EACF;;EAEA;AACF;AACA;EACE,MAAMqC,cAAcA,CAACC,OAAO,EAAE;IAC5B,MAAMC,YAAY,GAAGD,OAAO,CAAC5E,WAAW,CAAC,CAAC;;IAE1C;IACA,MAAM8E,WAAW,GAAG,0FAA0F;IAC9G,MAAMC,WAAW,GAAGH,OAAO,CAACI,KAAK,CAACF,WAAW,CAAC;IAC9C,IAAIC,WAAW,EAAE;MAAA,IAAAE,kBAAA,EAAAC,qBAAA;MACf,MAAMC,QAAQ,GAAG,CAACJ,WAAW,CAAC,CAAC,CAAC,IAAIA,WAAW,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE/E,WAAW,CAAC,CAAC;MACvE,MAAMoF,OAAO,GAAG;QAAEC,IAAI,EAAE,MAAM;QAAEC,IAAI,EAAE,MAAM;QAAEC,GAAG,EAAE;MAAM,CAAC;MAC1D,MAAMC,QAAQ,GAAGJ,OAAO,CAACD,QAAQ,CAAC,IAAIA,QAAQ;MAC9C,MAAMM,QAAQ,IAAAR,kBAAA,GAAG3O,QAAQ,CAACoP,QAAQ,cAAAT,kBAAA,wBAAAC,qBAAA,GAAjBD,kBAAA,CAAAU,IAAA,CAAArP,QAAoB,CAAC,cAAA4O,qBAAA,uBAArBA,qBAAA,CAAuBU,gBAAgB;MACxD,IAAIH,QAAQ,EAAE;QAAA,IAAAI,oBAAA;QACZ,MAAMpB,GAAG,GAAG,MAAMvO,oBAAoB,CAAC,CAAC;QACxC,MAAM4P,QAAQ,GAAG,CAAC,CAAC;QACnB,IAAIrB,GAAG,CAACsB,iBAAiB,EAAE;UACzB,KAAK,MAAMC,IAAI,IAAIrG,MAAM,CAACmB,MAAM,CAAC2D,GAAG,CAACsB,iBAAiB,CAAC,EAAE;YACvD,KAAK,MAAMlG,CAAC,IAAImG,IAAI,EAAE;cACpB,MAAMC,CAAC,GAAG,CAACpG,CAAC,CAAC5G,IAAI,IAAI,EAAE,EAAE+G,WAAW,CAAC,CAAC;cACtC,IAAIiG,CAAC,IAAI,CAACH,QAAQ,CAACG,CAAC,CAAC,EAAEH,QAAQ,CAACG,CAAC,CAAC,GAAGpG,CAAC,CAAC6B,YAAY,IAAI7B,CAAC,CAAC4B,KAAK,IAAI,EAAE;YACtE;UACF;QACF;QACA,MAAMyE,WAAW,GAAGJ,QAAQ,CAACN,QAAQ,CAAC,MAAAK,oBAAA,GAAIlG,MAAM,CAACC,OAAO,CAACkG,QAAQ,CAAC,CAAChG,IAAI,CAAC,CAAC,CAACqG,CAAC,CAAC,KAAKA,CAAC,CAACC,QAAQ,CAACZ,QAAQ,CAAC,IAAIA,QAAQ,CAACY,QAAQ,CAACD,CAAC,CAAC,CAAC,cAAAN,oBAAA,uBAApFA,oBAAA,CAAuF,CAAC,CAAC;QACnI,IAAIK,WAAW,EAAE;UACf,MAAM;YAAEG;UAAgB,CAAC,GAAG,MAAM,MAAM,CAAC,gBAAgB,CAAC;UAC1D,MAAM7K,OAAO,GAAG8K,MAAM,CAACb,QAAQ,CAACvM,WAAW,IAAIuM,QAAQ,CAACc,KAAK,IAAId,QAAQ,CAACjK,OAAO,IAAI,EAAE,CAAC,CAACgL,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC;UACtG,MAAMrD,GAAG,GAAG,qBAAqB3H,OAAO,EAAE;UAC1C,MAAMsB,GAAG,GAAG,iBAAiBuJ,eAAe,CAACH,WAAW,CAAC,SAASO,kBAAkB,CAACtD,GAAG,CAAC,EAAE;UAC3F,IAAI,OAAOuD,MAAM,KAAK,WAAW,EAAEA,MAAM,CAACC,IAAI,CAAC7J,GAAG,EAAE,QAAQ,CAAC;UAC7D,OAAO;YACLzC,OAAO,EAAE,IAAI;YACbE,OAAO,EAAE,uBAAuBiL,QAAQ,EAAE;YAC1C5D,cAAc,EAAE,qBAAqB4D,QAAQ;UAC/C,CAAC;QACH;MACF,CAAC,MAAM;QACL,OAAO;UACLnL,OAAO,EAAE,IAAI;UACbE,OAAO,EAAE,kDAAkD;UAC3DqH,cAAc,EAAE;QAClB,CAAC;MACH;IACF;IAEA,IAAIiD,YAAY,CAACuB,QAAQ,CAAC,iBAAiB,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,qBAAqB,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,aAAa,CAAC,EAAE;MACpI,IAAI;QACF,MAAMQ,KAAK,GAAG,MAAMvQ,gBAAgB,CAAC,CAAC;QACtC,MAAMwQ,gBAAgB,GAAG,CAACD,KAAK,IAAI,EAAE,EAAE3J,GAAG,CAAEzC,CAAC,KAAM;UACjDsM,IAAI,EAAE,CAACtM,CAAC,CAACtB,WAAW,IAAIsB,CAAC,CAAC+L,KAAK,IAAI/L,CAAC,CAACgB,OAAO,IAAI,EAAE,EAAEgL,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC;UACjEO,KAAK,EAAEvM,CAAC,CAAC2H,UAAU,IAAI3H,CAAC,CAACgH,SAAS,IAAI,EAAE;UACxC5E,QAAQ,EAAEpC,CAAC,CAAC0H,aAAa,IAAI1H,CAAC,CAAC4E,YAAY,IAAI,EAAE;UACjDjG,MAAM,EAAEqB,CAAC,CAACrB,MAAM,IAAI;QACtB,CAAC,CAAC,CAAC;QACH,MAAMkC,MAAM,GAAG,MAAMjF,eAAe,CAAC,qBAAqB,EAAEyQ,gBAAgB,CAAC;QAC7E,IAAIxL,MAAM,CAAChB,OAAO,EAAE;UAClB,OAAO;YACLA,OAAO,EAAE,IAAI;YACbE,OAAO,EAAEc,MAAM,CAACd,OAAO;YACvBqH,cAAc,EAAEvG,MAAM,CAACuG,cAAc,IAAIvG,MAAM,CAACd;UAClD,CAAC;QACH;MACF,CAAC,CAAC,OAAO+H,CAAC,EAAE;QACV,OAAO;UACLjI,OAAO,EAAE,IAAI;UACbE,OAAO,EAAE,UAAU,CAAC,MAAMlE,gBAAgB,CAAC,CAAC,EAAE2Q,MAAM,CAAExM,CAAC,IAAK,CAACA,CAAC,CAACrB,MAAM,IAAI,EAAE,EAAE6G,WAAW,CAAC,CAAC,KAAK,MAAM,CAAC,CAAC9F,MAAM,oCAAoC;UACjJ0H,cAAc,EAAE;QAClB,CAAC;MACH;IACF;IAEA,IAAIiD,YAAY,CAACuB,QAAQ,CAAC,cAAc,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,UAAU,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,uBAAuB,CAAC,EAAE;MAChI,IAAI;QACF,MAAM/K,MAAM,GAAG,MAAMjF,eAAe,CAACwO,OAAO,CAAC;QAC7C,IAAIvJ,MAAM,CAAChB,OAAO,IAAIgB,MAAM,CAACd,OAAO,EAAE;UACpC,OAAO;YACLF,OAAO,EAAE,IAAI;YACbE,OAAO,EAAEc,MAAM,CAACd,OAAO;YACvBqH,cAAc,EAAEvG,MAAM,CAACuG,cAAc,IAAIvG,MAAM,CAACd;UAClD,CAAC;QACH;MACF,CAAC,CAAC,OAAO+H,CAAC,EAAE;QACV,MAAMsE,KAAK,GAAG,MAAMvQ,gBAAgB,CAAC,CAAC;QACtC,MAAM4Q,KAAK,GAAG,IAAI9M,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACoM,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;QACnD,MAAMU,SAAS,GAAGN,KAAK,CAACI,MAAM,CAAExM,CAAC,IAAK;UACpC,MAAMqF,CAAC,GAAG,CAACrF,CAAC,CAACrB,MAAM,IAAI,EAAE,EAAE6G,WAAW,CAAC,CAAC;UACxC,MAAMmH,MAAM,GAAGtH,CAAC,KAAK,MAAM,IAAIA,CAAC,KAAK,WAAW;UAChD,MAAMuH,CAAC,GAAG,CAAC5M,CAAC,CAAC6M,UAAU,IAAI7M,CAAC,CAAC8M,UAAU,IAAI,EAAE,EAAEd,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;UAC3D,OAAOW,MAAM,IAAIC,CAAC,KAAKH,KAAK;QAC9B,CAAC,CAAC;QACF,MAAMM,OAAO,GAAGX,KAAK,CAACI,MAAM,CAAExM,CAAC,IAAK,CAACA,CAAC,CAACrB,MAAM,IAAI,EAAE,EAAE6G,WAAW,CAAC,CAAC,KAAK,MAAM,IAAI,CAACxF,CAAC,CAACrB,MAAM,IAAI,EAAE,EAAE6G,WAAW,CAAC,CAAC,KAAK,WAAW,CAAC;QAChI,MAAMwH,OAAO,GAAG,aAAaN,SAAS,CAAChN,MAAM,wBAAwBqN,OAAO,CAACrN,MAAM,WAAW;QAC9F,OAAO;UAAEG,OAAO,EAAE,IAAI;UAAEE,OAAO,EAAEiN,OAAO;UAAE5F,cAAc,EAAE4F;QAAQ,CAAC;MACrE;IACF;IAEA,IAAI3C,YAAY,CAACuB,QAAQ,CAAC,UAAU,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,KAAK,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,QAAQ,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,QAAQ,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,SAAS,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,WAAW,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,UAAU,CAAC,EAAE;MAC9T,MAAM3B,GAAG,GAAG,MAAMvO,oBAAoB,CAAC,CAAC;MACxC,MAAMsR,OAAO,GAAG/C,GAAG,CAACC,cAAc,IAAI,4BAA4B;MAClE,OAAO;QACLrK,OAAO,EAAE,IAAI;QACbE,OAAO,EAAEiN,OAAO;QAChB5F,cAAc,EAAE4F,OAAO;QACvBtI,UAAU,EAAEuF,GAAG,CAACvF;MAClB,CAAC;IACH;IAEA,IAAI2F,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,gBAAgB,CAAC,EAAE;MAC/I,MAAM3B,GAAG,GAAG,MAAMvO,oBAAoB,CAAC,CAAC;MACxC,MAAMuR,KAAK,GAAG,EAAE;MAChB,IAAIhD,GAAG,CAACsB,iBAAiB,EAAE;QACzB,KAAK,MAAM,CAACtG,GAAG,EAAEsH,KAAK,CAAC,IAAIpH,MAAM,CAACC,OAAO,CAAC6E,GAAG,CAACsB,iBAAiB,CAAC,EAAE;UAChE,MAAMzF,IAAI,GAAG,CAACmE,GAAG,CAACvF,UAAU,IAAI,EAAE,EAAEY,IAAI,CAAES,CAAC,IAAKA,CAAC,CAACvH,EAAE,KAAKyG,GAAG,CAAC;UAC7D,MAAMiI,KAAK,GAAG,CAAApH,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAErH,IAAI,KAAIwG,GAAG;UAC/B,MAAMkI,IAAI,GAAGZ,KAAK,CAAC9J,GAAG,CAAE4C,CAAC,IAAK,GAAGA,CAAC,CAAC5G,IAAI,KAAK4G,CAAC,CAACK,IAAI,GAAG,CAAC,CAAC0H,IAAI,CAAC,IAAI,CAAC,IAAI,MAAM;UAC3EH,KAAK,CAACvD,IAAI,CAAC,GAAGwD,KAAK,KAAKC,IAAI,EAAE,CAAC;QACjC;MACF;MACA,MAAMxE,GAAG,GAAGsE,KAAK,CAACvN,MAAM,GAAGuN,KAAK,CAACG,IAAI,CAAC,IAAI,CAAC,GAAG,oBAAoB;MAClE,OAAO;QAAEvN,OAAO,EAAE,IAAI;QAAEE,OAAO,EAAE4I,GAAG;QAAEvB,cAAc,EAAEuB;MAAI,CAAC;IAC7D;IAEA,IAAI0B,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,QAAQ,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,KAAK,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,EAAE;MACvK,OAAO,MAAM,IAAI,CAACvC,WAAW,CAAC1L,WAAW,CAACC,OAAO,EAAE;QAAE4B,SAAS,EAAE,CAAC,QAAQ,EAAE,SAAS;MAAE,CAAC,CAAC;IAC1F;IAEA,IAAI6K,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,WAAW,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,UAAU,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,QAAQ,CAAC,EAAE;MAClN,OAAO,MAAM,IAAI,CAACvC,WAAW,CAAC1L,WAAW,CAACE,SAAS,EAAE;QACnDiD,IAAI,EAAE,aAAa;QACnBE,OAAO,EAAE;UAAEQ,IAAI,EAAE,gBAAgB;UAAEhC,SAAS,EAAE,CAAC,WAAW,EAAE,UAAU;QAAE;MAC1E,CAAC,CAAC;IACJ;IAEA,IAAI6K,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,EAAE;MAC1M,OAAO,MAAM,IAAI,CAACvC,WAAW,CAAC1L,WAAW,CAACG,QAAQ,EAAE;QAClDgD,IAAI,EAAE,gBAAgB;QACtBoB,MAAM,EAAE,CAAC,+BAA+B;MAC1C,CAAC,CAAC;IACJ;IAEA,IAAImI,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,OAAO,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,KAAK,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,IAAIvB,YAAY,CAACuB,QAAQ,CAAC,MAAM,CAAC,EAAE;MACtM,OAAO,MAAM,IAAI,CAACvC,WAAW,CAAC1L,WAAW,CAACI,KAAK,EAAE;QAC/C+C,IAAI,EAAE,WAAW;QACjBsC,IAAI,EAAE;UAAE5E,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;UAAE9C,IAAI,EAAE;QAAW;MAC3C,CAAC,CAAC;IACJ;IAEA,MAAM4O,YAAY,GAAG,gSAAgS;IACrT,IAAIA,YAAY,CAAC5H,IAAI,CAAC2E,OAAO,CAAC,EAAE;MAC9B,IAAI;QACF,MAAMkD,YAAY,GAAG,MAAM1R,eAAe,CAACwO,OAAO,CAAC;QACnD,IAAIkD,YAAY,CAACzN,OAAO,EAAE;UACxB,MAAM0H,WAAW,GAAG+F,YAAY,CAAC/F,WAAW,IAAI+F,YAAY,CAACC,MAAM,KAAK,UAAU,IAAI,CAAC,CAACD,YAAY,CAACvO,IAAI;UACzG,IAAIwI,WAAW,EAAE;YACf2E,MAAM,CAACsB,aAAa,CAAC,IAAIC,WAAW,CAAC,mBAAmB,EAAE;cAAEC,MAAM,EAAE;gBAAE3O,IAAI,EAAEuO,YAAY,CAACvO;cAAK;YAAE,CAAC,CAAC,CAAC;UACrG;UACA,OAAO;YACLc,OAAO,EAAE,IAAI;YACbE,OAAO,EAAEuN,YAAY,CAACvN,OAAO,IAAIuN,YAAY,CAAClG,cAAc;YAC5DA,cAAc,EAAEkG,YAAY,CAAClG,cAAc,IAAIkG,YAAY,CAACvN,OAAO;YACnEwH;UACF,CAAC;QACH;MACF,CAAC,CAAC,OAAOO,CAAC,EAAE;QACV,IAAI,CAAAA,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEnJ,MAAM,MAAK,GAAG,IAAI,CAAC,CAAAmJ,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAE/H,OAAO,KAAI,EAAE,EAAE6L,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA9D,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAE/H,OAAO,KAAI,EAAE,EAAEyF,WAAW,CAAC,CAAC,CAACoG,QAAQ,CAAC,QAAQ,CAAC,EAAE;UACpH,MAAM9D,CAAC;QACT;QACAC,OAAO,CAACC,IAAI,CAAC,yBAAyB,EAAEF,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAE/H,OAAO,CAAC;MACrD;MACA,MAAM4N,SAAS,GAAGvD,OAAO,CAACI,KAAK,CAAC,KAAK,CAAC;MACtC,MAAMvC,IAAI,GAAG0F,SAAS,GAAGA,SAAS,CAAC,CAAC,CAAC,GAAG,KAAK;MAC7C,MAAM1D,GAAG,GAAG,MAAMvO,oBAAoB,CAAC,CAAC;MACxC,MAAMmJ,eAAe,GAAGoF,GAAG,CAACC,cAAc,IAAI,EAAE;MAChD,MAAMhF,SAAS,GAAG+E,GAAG,CAACsB,iBAAiB,GACnCpG,MAAM,CAACmB,MAAM,CAAC2D,GAAG,CAACsB,iBAAiB,CAAC,CAAChF,IAAI,CAAC,CAAC,GAC3C,EAAE;MACN,MAAM9B,eAAe,GAAGwF,GAAG,CAACsB,iBAAiB,IAAI,CAAC,CAAC;MACnD,MAAM7G,UAAU,GAAGuF,GAAG,CAACvF,UAAU,IAAI,EAAE;MACvC,MAAMI,aAAa,GAAG,6BAA6B,CAACW,IAAI,CAAC2E,OAAO,CAAC;MACjE,MAAMwD,UAAU,GAAG,kDAAkD,CAACnI,IAAI,CAAC2E,OAAO,CAAC;MACnF,MAAMyD,QAAQ,GAAG/I,aAAa,GAAG,qBAAqB,GAAG8I,UAAU,GAAG,kBAAkB,GAAG,gBAAgB;MAC3G,OAAO,MAAM,IAAI,CAACvE,WAAW,CAAC1L,WAAW,CAACK,UAAU,EAAE;QACpD8C,IAAI,EAAE+M,QAAQ;QACd5F,IAAI;QACJvJ,WAAW,EAAE0L,OAAO;QACpBvF,eAAe;QACf0H,KAAK,EAAErH,SAAS;QAChBT,eAAe;QACfC;MACF,CAAC,CAAC;IACJ;;IAEA;IACA,OAAO;MACL7E,OAAO,EAAE,IAAI;MACbE,OAAO,EAAE/D,IAAI,CAACgE,CAAC,CAAC,+BAA+B;IACjD,CAAC;EACH;;EAEA;AACF;AACA;EACE8N,cAAcA,CAACC,KAAK,GAAG,EAAE,EAAE;IACzB,OAAO,IAAI,CAAC7E,WAAW,CAAC8C,KAAK,CAAC,CAAC+B,KAAK,CAAC,CAACC,OAAO,CAAC,CAAC;EACjD;;EAEA;AACF;AACA;EACE,MAAMC,mBAAmBA,CAAA,EAAG;IAC1B,MAAM/N,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG1E,YAAY,oBAAoB,EAAE;MAChEsB,OAAO,EAAE;QAAE,GAAGd,cAAc,CAAC;MAAE;IACjC,CAAC,CAAC;IACF,IAAI,CAACiE,QAAQ,CAACK,EAAE,EAAE;MAChB,MAAM,IAAIvB,KAAK,CAAC,2BAA2B,CAAC;IAC9C;IACA,MAAMwB,IAAI,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;IAClC,OAAOD,IAAI,CAAC0N,MAAM,IAAI1N,IAAI;EAC5B;AACF;;AAEA;AACA,OAAO,MAAM2N,IAAI,GAAG,IAAInF,gBAAgB,CAAC,CAAC;AAE1C,eAAemF,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}