{"ast":null,"code":"/**\n * Multi-Agent Orchestration System\n * Maya manages 5 specialized agents for hotel operations\n * Connected to properties DB and staff for guest queries and automation\n */\n\nimport { API_BASE_URL } from '../utils/constants';\nimport { getAIPropertyContext, createPropertyTask } from './api';\nimport { MAYA_AI_RULES } from '../config/mayaRules';\nimport i18n from '../i18n';\nconst getAuthHeaders = () => {\n  try {\n    var _parsed$state, _parsed$state2;\n    const raw = localStorage.getItem('hotel-enterprise-storage');\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    const token = parsed === null || parsed === void 0 ? void 0 : (_parsed$state = parsed.state) === null || _parsed$state === void 0 ? void 0 : _parsed$state.authToken;\n    const tenantId = parsed === null || parsed === void 0 ? void 0 : (_parsed$state2 = parsed.state) === null || _parsed$state2 === void 0 ? void 0 : _parsed$state2.activeTenantId;\n    const headers = {};\n    if (token) headers.Authorization = `Bearer ${token}`;\n    if (tenantId) headers['X-Tenant-Id'] = tenantId;\n    return headers;\n  } catch (error) {\n    return {};\n  }\n};\nconst MAYA_SYSTEM_PROMPT = `\nYou are Maya, the Senior Project Manager for Easy Host AI.\nBe proactive, decisive, and operations-focused. Monitor occupancy, leads,\nand operational status. Suggest actions before being asked and route work\nto the correct agent via function calls.\n\n${MAYA_AI_RULES.IDENTIFICATION.rule}\n${MAYA_AI_RULES.STAFF_ACCESS.rule}\n${MAYA_AI_RULES.ACTION_RULE.rule}\n${MAYA_AI_RULES.DYNAMIC_DETAILS.rule}\n`.trim();\n\n// Agent Types\nexport const AGENT_TYPES = {\n  SCRAPER: 'scraper',\n  MARKETING: 'marketing',\n  CREATIVE: 'creative',\n  SALES: 'sales',\n  OPERATIONS: 'operations'\n};\n\n// Agent Status\nexport const AGENT_STATUS = {\n  ONLINE: 'online',\n  BUSY: 'busy',\n  OFFLINE: 'offline',\n  ERROR: 'error'\n};\n\n/**\n * Base Agent class\n */\nclass BaseAgent {\n  constructor(id, name, description) {\n    this.id = id;\n    this.name = name;\n    this.description = description;\n    this.status = AGENT_STATUS.ONLINE;\n    this.taskQueue = [];\n    this.completedTasks = [];\n  }\n  async execute(task) {\n    throw new Error('Execute method must be implemented');\n  }\n  getStatus() {\n    return this.status;\n  }\n  setStatus(status) {\n    this.status = status;\n  }\n}\n\n/**\n * Scraper Agent - Scans Airbnb/Booking for hot leads\n */\nexport class ScraperAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.SCRAPER, 'Scraper Agent', 'Scans Airbnb and Booking to discover high-intent leads');\n    this.leadsFound = 0;\n    this.lastScan = null;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      const leads = await this.scanPlatforms(task.platforms || ['airbnb', 'booking'], task.location);\n      this.leadsFound += leads.length;\n      this.lastScan = new Date().toISOString();\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return {\n        success: true,\n        leads,\n        timestamp: this.lastScan,\n        message: i18n.t('orchestrator.messages.leadsFound', {\n          count: leads.length\n        })\n      };\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async scanPlatforms(platforms, location = 'Greece') {\n    const response = await fetch(`${API_BASE_URL}/api/agents/scout/scan`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeaders()\n      },\n      body: JSON.stringify({\n        platforms,\n        location\n      })\n    });\n    if (!response.ok) {\n      throw new Error('Failed to scan platforms');\n    }\n    const data = await response.json();\n    return data.leads || [];\n  }\n}\n\n/**\n * Marketing Agent - Creates social media posts and email campaigns\n */\nexport class MarketingAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.MARKETING, 'Marketing Agent', 'Creates social posts and email campaigns');\n    this.postsCreated = 0;\n    this.campaignsSent = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'social_post':\n          result = await this.createSocialPost(task.content);\n          this.postsCreated++;\n          break;\n        case 'email_campaign':\n          result = await this.createEmailCampaign(task.campaign);\n          this.campaignsSent++;\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async createSocialPost(content) {\n    await new Promise(r => setTimeout(r, 1000));\n    return {\n      success: true,\n      post: {\n        id: Date.now(),\n        content: content.text,\n        platforms: content.platforms || ['instagram', 'facebook'],\n        scheduledFor: content.scheduledFor || new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.postCreated')\n    };\n  }\n  async createEmailCampaign(campaign) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      campaign: {\n        id: Date.now(),\n        subject: campaign.subject,\n        recipients: campaign.recipients || 500,\n        sentAt: new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.campaignSent', {\n        count: campaign.recipients || 500\n      })\n    };\n  }\n}\n\n/**\n * Creative Agent - Auto-edits videos/images for property presentation\n */\nexport class CreativeAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.CREATIVE, 'Creative Agent', 'Edits videos and images for property presentation');\n    this.assetsCreated = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'edit_video':\n          result = await this.editVideo(task.video);\n          break;\n        case 'enhance_images':\n          result = await this.enhanceImages(task.images);\n          break;\n        case 'create_virtual_tour':\n          result = await this.createVirtualTour(task.property);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.assetsCreated++;\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async editVideo(video) {\n    await new Promise(r => setTimeout(r, 3000));\n    return {\n      success: true,\n      video: {\n        id: Date.now(),\n        originalUrl: video.url,\n        editedUrl: video.url + '?edited=true',\n        duration: '2:30'\n      },\n      message: i18n.t('orchestrator.messages.videoEdited')\n    };\n  }\n  async enhanceImages(images) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      images: images.map((img, i) => ({\n        id: Date.now() + i,\n        originalUrl: img,\n        enhancedUrl: img + '?enhanced=true'\n      })),\n      message: i18n.t('orchestrator.messages.imagesEnhanced', {\n        count: images.length\n      })\n    };\n  }\n  async createVirtualTour(property) {\n    await new Promise(r => setTimeout(r, 5000));\n    return {\n      success: true,\n      tour: {\n        id: Date.now(),\n        propertyId: property.id,\n        tourUrl: `https://tours.hotel.ai/${property.id}`\n      },\n      message: i18n.t('orchestrator.messages.tourCreated')\n    };\n  }\n}\n\n/**\n * Sales Manager Agent - Manages initial negotiations and sends demos\n */\nexport class SalesAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.SALES, 'Sales Manager Agent', 'Handles early negotiations and sends demos');\n    this.dealsInProgress = 0;\n    this.dealsClosedToday = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'send_demo':\n          result = await this.sendDemo(task.lead);\n          break;\n        case 'negotiate':\n          result = await this.handleNegotiation(task.deal);\n          break;\n        case 'follow_up':\n          result = await this.followUp(task.leadId);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async sendDemo(lead) {\n    await new Promise(r => setTimeout(r, 1500));\n    this.dealsInProgress++;\n    return {\n      success: true,\n      demo: {\n        id: Date.now(),\n        leadId: lead.id,\n        demoUrl: `https://demo.hotel.ai/${lead.id}`,\n        sentAt: new Date().toISOString()\n      },\n      message: i18n.t('orchestrator.messages.demoSent', {\n        name: lead.name || 'Lead'\n      })\n    };\n  }\n  async handleNegotiation(deal) {\n    await new Promise(r => setTimeout(r, 2000));\n    return {\n      success: true,\n      negotiation: {\n        id: Date.now(),\n        dealId: deal.id,\n        stage: 'proposal_sent',\n        nextAction: 'await_response'\n      },\n      message: i18n.t('orchestrator.messages.negotiationStarted')\n    };\n  }\n  async followUp(leadId) {\n    await new Promise(r => setTimeout(r, 1000));\n    return {\n      success: true,\n      followUp: {\n        leadId,\n        sentAt: new Date().toISOString(),\n        type: 'email'\n      },\n      message: i18n.t('orchestrator.messages.followUpSent')\n    };\n  }\n}\n\n/**\n * Operations Agent - Sends WhatsApp messages to staff for cleaning, maintenance, etc.\n */\nexport class OperationsAgent extends BaseAgent {\n  constructor() {\n    super(AGENT_TYPES.OPERATIONS, 'Operations Agent', 'Sends WhatsApp messages to staff for operational requests');\n    this.messagesSent = 0;\n    this.tasksAssigned = 0;\n  }\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    try {\n      let result;\n      switch (task.type) {\n        case 'request_towels':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'request_cleaning':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'maintenance_request':\n          result = await this.sendStaffMessage('maintenance', task);\n          break;\n        case 'room_service':\n          result = await this.sendStaffMessage('room_service', task);\n          break;\n        case 'guest_checkout':\n          result = await this.handleCheckout(task);\n          break;\n        default:\n          result = await this.sendStaffMessage('general', task);\n      }\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n  async sendStaffMessage(department, task) {\n    var _relevantStaff, _relevantStaff2, _relevantStaff3, _relevantStaff4;\n    await new Promise(r => setTimeout(r, 800));\n    this.messagesSent++;\n    this.tasksAssigned++;\n    const staffByProperty = task.staffByProperty || {};\n    const properties = task.properties || [];\n    let relevantStaff = null;\n    let propertyName = '';\n    let propertyId = '';\n    let propertyContext = '';\n    const isMaintenance = department === 'maintenance';\n    const rolePattern = isMaintenance ? /××ª×—×–×§|maintenance/i : /×× ×§×”|cleaner|housekeeping|staff/i;\n    for (const [pid, staffList] of Object.entries(staffByProperty)) {\n      const s = staffList.find(x => rolePattern.test(x.role || ''));\n      if (s) {\n        var _prop$max_guests, _prop$bedrooms, _prop$beds, _prop$bathrooms;\n        relevantStaff = s;\n        propertyId = pid;\n        const prop = properties.find(p => p.id === pid);\n        propertyName = (prop === null || prop === void 0 ? void 0 : prop.name) || '×”× ×›×¡';\n        const g = (_prop$max_guests = prop === null || prop === void 0 ? void 0 : prop.max_guests) !== null && _prop$max_guests !== void 0 ? _prop$max_guests : 2;\n        const br = (_prop$bedrooms = prop === null || prop === void 0 ? void 0 : prop.bedrooms) !== null && _prop$bedrooms !== void 0 ? _prop$bedrooms : 1;\n        const b = (_prop$beds = prop === null || prop === void 0 ? void 0 : prop.beds) !== null && _prop$beds !== void 0 ? _prop$beds : 1;\n        const bath = (_prop$bathrooms = prop === null || prop === void 0 ? void 0 : prop.bathrooms) !== null && _prop$bathrooms !== void 0 ? _prop$bathrooms : 1;\n        propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed, ${bath} Bath`;\n        break;\n      }\n    }\n    if (!relevantStaff && Object.values(staffByProperty).flat().length > 0) {\n      var _prop$max_guests2, _prop$bedrooms2, _prop$beds2, _prop$bathrooms2;\n      const first = Object.entries(staffByProperty)[0];\n      relevantStaff = first[1][0];\n      propertyId = first[0];\n      const prop = properties.find(p => p.id === first[0]);\n      propertyName = (prop === null || prop === void 0 ? void 0 : prop.name) || '×”× ×›×¡';\n      const g = (_prop$max_guests2 = prop === null || prop === void 0 ? void 0 : prop.max_guests) !== null && _prop$max_guests2 !== void 0 ? _prop$max_guests2 : 2;\n      const br = (_prop$bedrooms2 = prop === null || prop === void 0 ? void 0 : prop.bedrooms) !== null && _prop$bedrooms2 !== void 0 ? _prop$bedrooms2 : 1;\n      const b = (_prop$beds2 = prop === null || prop === void 0 ? void 0 : prop.beds) !== null && _prop$beds2 !== void 0 ? _prop$beds2 : 1;\n      const bath = (_prop$bathrooms2 = prop === null || prop === void 0 ? void 0 : prop.bathrooms) !== null && _prop$bathrooms2 !== void 0 ? _prop$bathrooms2 : 1;\n      propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed, ${bath} Bath`;\n    }\n    const staffName = ((_relevantStaff = relevantStaff) === null || _relevantStaff === void 0 ? void 0 : _relevantStaff.name) || 'Staff';\n    const phone = ((_relevantStaff2 = relevantStaff) === null || _relevantStaff2 === void 0 ? void 0 : _relevantStaff2.phone_number) || ((_relevantStaff3 = relevantStaff) === null || _relevantStaff3 === void 0 ? void 0 : _relevantStaff3.phone);\n    const staffId = ((_relevantStaff4 = relevantStaff) === null || _relevantStaff4 === void 0 ? void 0 : _relevantStaff4.id) || '';\n    const displayMessage = phone ? `I am notifying ${staffName} at ${phone}` : `I am notifying ${staffName}. (Add their phone number in Staff settings for direct contact.)`;\n    const message = this.generateMessage(department, task, {\n      staffName,\n      propertyName\n    });\n    const readyToSendHe = phone && propertyName ? `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}. ${task.description || '×‘×§×©×” ×œ× ×™×§×™×•×Ÿ/×©×™×¨×•×ª'}. ×× × ×˜×¤×œ ×‘×”×§×“×.` : null;\n    try {\n      await createPropertyTask({\n        property_id: propertyId,\n        assigned_to: staffId,\n        description: task.description || (department === 'housekeeping' ? '× ×™×§×™×•×Ÿ' : '×©×™×¨×•×ª'),\n        status: 'Pending',\n        property_name: propertyName,\n        staff_name: staffName,\n        staff_phone: phone || '',\n        property_context: propertyContext\n      });\n    } catch (e) {\n      console.warn('[Maya] Could not persist task:', e);\n    }\n    return {\n      success: true,\n      message: {\n        id: Date.now(),\n        department,\n        room: task.room,\n        content: message,\n        readyToSendHe,\n        staffName,\n        phone,\n        propertyName,\n        sentAt: new Date().toISOString(),\n        status: 'delivered'\n      },\n      displayMessage\n    };\n  }\n  generateMessage(department, task, extra = {}) {\n    const {\n      staffName,\n      propertyName\n    } = extra;\n    const base = {\n      housekeeping: `ğŸ¨ ×‘×§×©×” ×—×“×©×” ××—×“×¨ ${task.room}\\n\\n${task.description || '××’×‘×•×ª × ×“×¨×©×•×ª'}\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“× ×”××¤×©×¨×™`,\n      maintenance: `ğŸ”§ ×ª×—×–×•×§×” × ×“×¨×©×ª ×‘×—×“×¨ ${task.room}\\n\\n${task.description || '×‘×¢×™×” ×˜×›× ×™×ª'}\\n\\nâš ï¸ ×“×—×™×¤×•×ª: ${task.priority || '×¨×’×™×œ×”'}`,\n      room_service: `ğŸ½ï¸ ×”×–×× ×ª ×©×™×¨×•×ª ×—×“×¨×™×\\n\\n×—×“×¨: ${task.room}\\n${task.order || ''}\\n\\nâ° ×–××Ÿ ××©×œ×•×— ××‘×•×§×©: ${task.deliveryTime || '×‘×”×§×“×'}`,\n      general: `ğŸ“‹ ×‘×§×©×” ×—×“×©×” ××—×“×¨ ${task.room}\\n\\n${task.description || '×‘×§×©×ª ××•×¨×—'}`\n    };\n    let msg = base[department] || base.general;\n    if (staffName && propertyName) {\n      msg = `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}.\\n\\n${msg}`;\n    }\n    return task.staffContext ? msg + task.staffContext : msg;\n  }\n  async handleCheckout(task) {\n    await new Promise(r => setTimeout(r, 1000));\n\n    // Send multiple messages for checkout process\n    await this.sendStaffMessage('housekeeping', {\n      room: task.room,\n      description: '× ×™×§×™×•×Ÿ ×œ××—×¨ ×¦\\'×§-×××•×˜',\n      priority: '×’×‘×•×”×”'\n    });\n    return {\n      success: true,\n      checkout: {\n        room: task.room,\n        guestName: task.guestName,\n        processedAt: new Date().toISOString()\n      },\n      displayMessage: i18n.t('orchestrator.messages.checkoutDone', {\n        room: task.room\n      })\n    };\n  }\n}\n\n/**\n * Maya - The Master Orchestrator\n * Manages all agents and handles high-level decisions\n */\nclass MayaOrchestrator {\n  constructor() {\n    this.agents = {\n      [AGENT_TYPES.SCRAPER]: new ScraperAgent(),\n      [AGENT_TYPES.MARKETING]: new MarketingAgent(),\n      [AGENT_TYPES.CREATIVE]: new CreativeAgent(),\n      [AGENT_TYPES.SALES]: new SalesAgent(),\n      [AGENT_TYPES.OPERATIONS]: new OperationsAgent()\n    };\n    this.taskHistory = [];\n    this.isProcessing = false;\n    this.systemPrompt = MAYA_SYSTEM_PROMPT;\n  }\n\n  /**\n   * Execute a task using the appropriate agent\n   */\n  async executeTask(agentType, task) {\n    const agent = this.agents[agentType];\n    if (!agent) {\n      throw new Error(`Agent ${agentType} not found`);\n    }\n    const taskRecord = {\n      id: Date.now(),\n      agentType,\n      task,\n      startedAt: new Date().toISOString(),\n      status: 'running'\n    };\n    this.taskHistory.push(taskRecord);\n    try {\n      const result = await agent.execute(task);\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'completed';\n      taskRecord.result = result;\n      return result;\n    } catch (error) {\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'failed';\n      taskRecord.error = error.message;\n      throw error;\n    }\n  }\n\n  /**\n   * Get all agent statuses\n   */\n  getAgentStatuses() {\n    return Object.entries(this.agents).reduce((acc, [type, agent]) => {\n      acc[type] = {\n        status: agent.status,\n        name: agent.name,\n        description: agent.description\n      };\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Fetch property context (details + staff) for AI to answer guest queries\n   */\n  async getPropertyContext() {\n    try {\n      var _ctx$properties;\n      const ctx = await getAIPropertyContext();\n      return ctx.summary_for_ai || (_ctx$properties = ctx.properties) !== null && _ctx$properties !== void 0 && _ctx$properties.length ? `Property context: ${ctx.summary_for_ai || 'No details.'}` : '';\n    } catch (e) {\n      return '';\n    }\n  }\n\n  /**\n   * Process natural language command from Maya chat\n   */\n  async processCommand(command) {\n    const lowerCommand = command.toLowerCase();\n    if (lowerCommand.includes('property') || lowerCommand.includes('villa') || lowerCommand.includes('× ×›×¡') || lowerCommand.includes('×•×•×™×œ×”') || lowerCommand.includes('guests') || lowerCommand.includes('××•×¨×—×™×') || lowerCommand.includes('bedroom') || lowerCommand.includes('×›××” ×—×“×¨×™×') || lowerCommand.includes('how many')) {\n      const ctx = await getAIPropertyContext();\n      const summary = ctx.summary_for_ai || 'No properties in database.';\n      return {\n        success: true,\n        message: summary,\n        displayMessage: summary,\n        properties: ctx.properties\n      };\n    }\n    if (lowerCommand.includes('staff') || lowerCommand.includes('×¢×•×‘×“') || lowerCommand.includes('×× ×§×”') || lowerCommand.includes('who to contact')) {\n      const ctx = await getAIPropertyContext();\n      const lines = [];\n      if (ctx.staff_by_property) {\n        for (const [pid, staff] of Object.entries(ctx.staff_by_property)) {\n          const prop = (ctx.properties || []).find(p => p.id === pid);\n          const pName = (prop === null || prop === void 0 ? void 0 : prop.name) || pid;\n          const sStr = staff.map(s => `${s.name} (${s.role})`).join(', ') || 'None';\n          lines.push(`${pName}: ${sStr}`);\n        }\n      }\n      const msg = lines.length ? lines.join('\\n') : 'No staff assigned.';\n      return {\n        success: true,\n        message: msg,\n        displayMessage: msg\n      };\n    }\n    if (lowerCommand.includes('lead') || lowerCommand.includes('scan') || lowerCommand.includes('airbnb') || lowerCommand.includes('×œ×™×“') || lowerCommand.includes('×¡×¨×™×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SCRAPER, {\n        platforms: ['airbnb', 'booking']\n      });\n    }\n    if (lowerCommand.includes('post') || lowerCommand.includes('marketing') || lowerCommand.includes('campaign') || lowerCommand.includes('×¤×•×¡×˜') || lowerCommand.includes('×©×™×•×•×§') || lowerCommand.includes('×§××¤×™×™×Ÿ')) {\n      return await this.executeTask(AGENT_TYPES.MARKETING, {\n        type: 'social_post',\n        content: {\n          text: 'New hotel post',\n          platforms: ['instagram', 'facebook']\n        }\n      });\n    }\n    if (lowerCommand.includes('video') || lowerCommand.includes('image') || lowerCommand.includes('edit') || lowerCommand.includes('×•×™×“××•') || lowerCommand.includes('×ª××•× ') || lowerCommand.includes('×¢×¨×™×›×”')) {\n      return await this.executeTask(AGENT_TYPES.CREATIVE, {\n        type: 'enhance_images',\n        images: ['https://example.com/room1.jpg']\n      });\n    }\n    if (lowerCommand.includes('demo') || lowerCommand.includes('deal') || lowerCommand.includes('sales') || lowerCommand.includes('×“××•') || lowerCommand.includes('××›×™×¨') || lowerCommand.includes('×¢×¡×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SALES, {\n        type: 'send_demo',\n        lead: {\n          id: Date.now(),\n          name: 'New lead'\n        }\n      });\n    }\n    if (lowerCommand.includes('towel') || lowerCommand.includes('clean') || lowerCommand.includes('maintenance') || lowerCommand.includes('room') || lowerCommand.includes('fix') || lowerCommand.includes('××’×‘×ª') || lowerCommand.includes('× ×™×§×™×•×Ÿ') || lowerCommand.includes('×ª×—×–×•×§×”') || lowerCommand.includes('×—×“×¨') || lowerCommand.includes('dirty') || lowerCommand.includes('××œ×•×›×œ×š') || lowerCommand.includes('×ª×§×Ÿ') || lowerCommand.includes('×”×›×•×‘×¡') || lowerCommand.includes('×× ×§×”')) {\n      const roomMatch = command.match(/\\d+/);\n      const room = roomMatch ? roomMatch[0] : '101';\n      const ctx = await getAIPropertyContext();\n      const propertyContext = ctx.summary_for_ai || '';\n      const staffList = ctx.staff_by_property ? Object.values(ctx.staff_by_property).flat() : [];\n      const staffByProperty = ctx.staff_by_property || {};\n      const properties = ctx.properties || [];\n      const isMaintenance = /maintenance|fix|×ª×—×–×•×§×”|×ª×§×Ÿ/i.test(command);\n      const isCleaning = /clean|towel|dirty|××’×‘×ª|× ×™×§×™×•×Ÿ|××œ×•×›×œ×š|×× ×§×”|×”×›×•×‘×¡/i.test(command);\n      const taskType = isMaintenance ? 'maintenance_request' : isCleaning ? 'request_cleaning' : 'request_towels';\n      return await this.executeTask(AGENT_TYPES.OPERATIONS, {\n        type: taskType,\n        room,\n        description: command,\n        propertyContext,\n        staff: staffList,\n        staffByProperty,\n        properties\n      });\n    }\n\n    // Default response\n    return {\n      success: true,\n      message: i18n.t('orchestrator.messages.unknown')\n    };\n  }\n\n  /**\n   * Get task history\n   */\n  getTaskHistory(limit = 50) {\n    return this.taskHistory.slice(-limit).reverse();\n  }\n\n  /**\n   * Generate daily report\n   */\n  async generateDailyReport() {\n    const response = await fetch(`${API_BASE_URL}/api/reports/daily`, {\n      headers: {\n        ...getAuthHeaders()\n      }\n    });\n    if (!response.ok) {\n      throw new Error('Failed to generate report');\n    }\n    const data = await response.json();\n    return data.report || data;\n  }\n}\n\n// Singleton instance\nexport const maya = new MayaOrchestrator();\nexport default maya;","map":{"version":3,"names":["API_BASE_URL","getAIPropertyContext","createPropertyTask","MAYA_AI_RULES","i18n","getAuthHeaders","_parsed$state","_parsed$state2","raw","localStorage","getItem","parsed","JSON","parse","token","state","authToken","tenantId","activeTenantId","headers","Authorization","error","MAYA_SYSTEM_PROMPT","IDENTIFICATION","rule","STAFF_ACCESS","ACTION_RULE","DYNAMIC_DETAILS","trim","AGENT_TYPES","SCRAPER","MARKETING","CREATIVE","SALES","OPERATIONS","AGENT_STATUS","ONLINE","BUSY","OFFLINE","ERROR","BaseAgent","constructor","id","name","description","status","taskQueue","completedTasks","execute","task","Error","getStatus","setStatus","ScraperAgent","leadsFound","lastScan","leads","scanPlatforms","platforms","location","length","Date","toISOString","success","timestamp","message","t","count","response","fetch","method","body","stringify","ok","data","json","MarketingAgent","postsCreated","campaignsSent","result","type","createSocialPost","content","createEmailCampaign","campaign","Promise","r","setTimeout","post","now","text","scheduledFor","subject","recipients","sentAt","CreativeAgent","assetsCreated","editVideo","video","enhanceImages","images","createVirtualTour","property","originalUrl","url","editedUrl","duration","map","img","i","enhancedUrl","tour","propertyId","tourUrl","SalesAgent","dealsInProgress","dealsClosedToday","sendDemo","lead","handleNegotiation","deal","followUp","leadId","demo","demoUrl","negotiation","dealId","stage","nextAction","OperationsAgent","messagesSent","tasksAssigned","sendStaffMessage","handleCheckout","department","_relevantStaff","_relevantStaff2","_relevantStaff3","_relevantStaff4","staffByProperty","properties","relevantStaff","propertyName","propertyContext","isMaintenance","rolePattern","pid","staffList","Object","entries","s","find","x","test","role","_prop$max_guests","_prop$bedrooms","_prop$beds","_prop$bathrooms","prop","p","g","max_guests","br","bedrooms","b","beds","bath","bathrooms","values","flat","_prop$max_guests2","_prop$bedrooms2","_prop$beds2","_prop$bathrooms2","first","staffName","phone","phone_number","staffId","displayMessage","generateMessage","readyToSendHe","property_id","assigned_to","property_name","staff_name","staff_phone","property_context","e","console","warn","room","extra","base","housekeeping","maintenance","priority","room_service","order","deliveryTime","general","msg","staffContext","checkout","guestName","processedAt","MayaOrchestrator","agents","taskHistory","isProcessing","systemPrompt","executeTask","agentType","agent","taskRecord","startedAt","push","completedAt","getAgentStatuses","reduce","acc","getPropertyContext","_ctx$properties","ctx","summary_for_ai","processCommand","command","lowerCommand","toLowerCase","includes","summary","lines","staff_by_property","staff","pName","sStr","join","roomMatch","match","isCleaning","taskType","getTaskHistory","limit","slice","reverse","generateDailyReport","report","maya"],"sources":["C:/Users/user/Desktop/hotel_ai_assistant/hotel_dashboard/src/services/agentOrchestrator.js"],"sourcesContent":["/**\n * Multi-Agent Orchestration System\n * Maya manages 5 specialized agents for hotel operations\n * Connected to properties DB and staff for guest queries and automation\n */\n\nimport { API_BASE_URL } from '../utils/constants';\nimport { getAIPropertyContext, createPropertyTask } from './api';\nimport { MAYA_AI_RULES } from '../config/mayaRules';\nimport i18n from '../i18n';\n\nconst getAuthHeaders = () => {\n  try {\n    const raw = localStorage.getItem('hotel-enterprise-storage');\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    const token = parsed?.state?.authToken;\n    const tenantId = parsed?.state?.activeTenantId;\n    const headers = {};\n    if (token) headers.Authorization = `Bearer ${token}`;\n    if (tenantId) headers['X-Tenant-Id'] = tenantId;\n    return headers;\n  } catch (error) {\n    return {};\n  }\n};\n\nconst MAYA_SYSTEM_PROMPT = `\nYou are Maya, the Senior Project Manager for Easy Host AI.\nBe proactive, decisive, and operations-focused. Monitor occupancy, leads,\nand operational status. Suggest actions before being asked and route work\nto the correct agent via function calls.\n\n${MAYA_AI_RULES.IDENTIFICATION.rule}\n${MAYA_AI_RULES.STAFF_ACCESS.rule}\n${MAYA_AI_RULES.ACTION_RULE.rule}\n${MAYA_AI_RULES.DYNAMIC_DETAILS.rule}\n`.trim();\n\n// Agent Types\nexport const AGENT_TYPES = {\n  SCRAPER: 'scraper',\n  MARKETING: 'marketing',\n  CREATIVE: 'creative',\n  SALES: 'sales',\n  OPERATIONS: 'operations',\n};\n\n// Agent Status\nexport const AGENT_STATUS = {\n  ONLINE: 'online',\n  BUSY: 'busy',\n  OFFLINE: 'offline',\n  ERROR: 'error',\n};\n\n/**\n * Base Agent class\n */\nclass BaseAgent {\n  constructor(id, name, description) {\n    this.id = id;\n    this.name = name;\n    this.description = description;\n    this.status = AGENT_STATUS.ONLINE;\n    this.taskQueue = [];\n    this.completedTasks = [];\n  }\n\n  async execute(task) {\n    throw new Error('Execute method must be implemented');\n  }\n\n  getStatus() {\n    return this.status;\n  }\n\n  setStatus(status) {\n    this.status = status;\n  }\n}\n\n/**\n * Scraper Agent - Scans Airbnb/Booking for hot leads\n */\nexport class ScraperAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.SCRAPER,\n      'Scraper Agent',\n      'Scans Airbnb and Booking to discover high-intent leads'\n    );\n    this.leadsFound = 0;\n    this.lastScan = null;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      const leads = await this.scanPlatforms(task.platforms || ['airbnb', 'booking'], task.location);\n      \n      this.leadsFound += leads.length;\n      this.lastScan = new Date().toISOString();\n      this.setStatus(AGENT_STATUS.ONLINE);\n      \n      return {\n        success: true,\n        leads,\n        timestamp: this.lastScan,\n        message: i18n.t('orchestrator.messages.leadsFound', { count: leads.length }),\n      };\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async scanPlatforms(platforms, location = 'Greece') {\n    const response = await fetch(`${API_BASE_URL}/api/agents/scout/scan`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json', ...getAuthHeaders() },\n      body: JSON.stringify({ platforms, location }),\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to scan platforms');\n    }\n\n    const data = await response.json();\n    return data.leads || [];\n  }\n}\n\n/**\n * Marketing Agent - Creates social media posts and email campaigns\n */\nexport class MarketingAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.MARKETING,\n      'Marketing Agent',\n      'Creates social posts and email campaigns'\n    );\n    this.postsCreated = 0;\n    this.campaignsSent = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'social_post':\n          result = await this.createSocialPost(task.content);\n          this.postsCreated++;\n          break;\n        case 'email_campaign':\n          result = await this.createEmailCampaign(task.campaign);\n          this.campaignsSent++;\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async createSocialPost(content) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    return {\n      success: true,\n      post: {\n        id: Date.now(),\n        content: content.text,\n        platforms: content.platforms || ['instagram', 'facebook'],\n        scheduledFor: content.scheduledFor || new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.postCreated'),\n    };\n  }\n\n  async createEmailCampaign(campaign) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      campaign: {\n        id: Date.now(),\n        subject: campaign.subject,\n        recipients: campaign.recipients || 500,\n        sentAt: new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.campaignSent', { count: campaign.recipients || 500 }),\n    };\n  }\n}\n\n/**\n * Creative Agent - Auto-edits videos/images for property presentation\n */\nexport class CreativeAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.CREATIVE,\n      'Creative Agent',\n      'Edits videos and images for property presentation'\n    );\n    this.assetsCreated = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'edit_video':\n          result = await this.editVideo(task.video);\n          break;\n        case 'enhance_images':\n          result = await this.enhanceImages(task.images);\n          break;\n        case 'create_virtual_tour':\n          result = await this.createVirtualTour(task.property);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.assetsCreated++;\n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async editVideo(video) {\n    await new Promise((r) => setTimeout(r, 3000));\n    \n    return {\n      success: true,\n      video: {\n        id: Date.now(),\n        originalUrl: video.url,\n        editedUrl: video.url + '?edited=true',\n        duration: '2:30',\n      },\n      message: i18n.t('orchestrator.messages.videoEdited'),\n    };\n  }\n\n  async enhanceImages(images) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      images: images.map((img, i) => ({\n        id: Date.now() + i,\n        originalUrl: img,\n        enhancedUrl: img + '?enhanced=true',\n      })),\n      message: i18n.t('orchestrator.messages.imagesEnhanced', { count: images.length }),\n    };\n  }\n\n  async createVirtualTour(property) {\n    await new Promise((r) => setTimeout(r, 5000));\n    \n    return {\n      success: true,\n      tour: {\n        id: Date.now(),\n        propertyId: property.id,\n        tourUrl: `https://tours.hotel.ai/${property.id}`,\n      },\n      message: i18n.t('orchestrator.messages.tourCreated'),\n    };\n  }\n}\n\n/**\n * Sales Manager Agent - Manages initial negotiations and sends demos\n */\nexport class SalesAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.SALES,\n      'Sales Manager Agent',\n      'Handles early negotiations and sends demos'\n    );\n    this.dealsInProgress = 0;\n    this.dealsClosedToday = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'send_demo':\n          result = await this.sendDemo(task.lead);\n          break;\n        case 'negotiate':\n          result = await this.handleNegotiation(task.deal);\n          break;\n        case 'follow_up':\n          result = await this.followUp(task.leadId);\n          break;\n        default:\n          throw new Error(`Unknown task type: ${task.type}`);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async sendDemo(lead) {\n    await new Promise((r) => setTimeout(r, 1500));\n    \n    this.dealsInProgress++;\n    \n    return {\n      success: true,\n      demo: {\n        id: Date.now(),\n        leadId: lead.id,\n        demoUrl: `https://demo.hotel.ai/${lead.id}`,\n        sentAt: new Date().toISOString(),\n      },\n      message: i18n.t('orchestrator.messages.demoSent', { name: lead.name || 'Lead' }),\n    };\n  }\n\n  async handleNegotiation(deal) {\n    await new Promise((r) => setTimeout(r, 2000));\n    \n    return {\n      success: true,\n      negotiation: {\n        id: Date.now(),\n        dealId: deal.id,\n        stage: 'proposal_sent',\n        nextAction: 'await_response',\n      },\n      message: i18n.t('orchestrator.messages.negotiationStarted'),\n    };\n  }\n\n  async followUp(leadId) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    return {\n      success: true,\n      followUp: {\n        leadId,\n        sentAt: new Date().toISOString(),\n        type: 'email',\n      },\n      message: i18n.t('orchestrator.messages.followUpSent'),\n    };\n  }\n}\n\n/**\n * Operations Agent - Sends WhatsApp messages to staff for cleaning, maintenance, etc.\n */\nexport class OperationsAgent extends BaseAgent {\n  constructor() {\n    super(\n      AGENT_TYPES.OPERATIONS,\n      'Operations Agent',\n      'Sends WhatsApp messages to staff for operational requests'\n    );\n    this.messagesSent = 0;\n    this.tasksAssigned = 0;\n  }\n\n  async execute(task) {\n    this.setStatus(AGENT_STATUS.BUSY);\n    \n    try {\n      let result;\n      \n      switch (task.type) {\n        case 'request_towels':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'request_cleaning':\n          result = await this.sendStaffMessage('housekeeping', task);\n          break;\n        case 'maintenance_request':\n          result = await this.sendStaffMessage('maintenance', task);\n          break;\n        case 'room_service':\n          result = await this.sendStaffMessage('room_service', task);\n          break;\n        case 'guest_checkout':\n          result = await this.handleCheckout(task);\n          break;\n        default:\n          result = await this.sendStaffMessage('general', task);\n      }\n      \n      this.setStatus(AGENT_STATUS.ONLINE);\n      return result;\n    } catch (error) {\n      this.setStatus(AGENT_STATUS.ERROR);\n      throw error;\n    }\n  }\n\n  async sendStaffMessage(department, task) {\n    await new Promise((r) => setTimeout(r, 800));\n    \n    this.messagesSent++;\n    this.tasksAssigned++;\n    \n    const staffByProperty = task.staffByProperty || {};\n    const properties = task.properties || [];\n    let relevantStaff = null;\n    let propertyName = '';\n    let propertyId = '';\n    let propertyContext = '';\n    const isMaintenance = department === 'maintenance';\n    const rolePattern = isMaintenance\n      ? /××ª×—×–×§|maintenance/i\n      : /×× ×§×”|cleaner|housekeeping|staff/i;\n    \n    for (const [pid, staffList] of Object.entries(staffByProperty)) {\n      const s = staffList.find((x) => rolePattern.test(x.role || ''));\n      if (s) {\n        relevantStaff = s;\n        propertyId = pid;\n        const prop = properties.find((p) => p.id === pid);\n        propertyName = prop?.name || '×”× ×›×¡';\n        const g = prop?.max_guests ?? 2;\n        const br = prop?.bedrooms ?? 1;\n        const b = prop?.beds ?? 1;\n        const bath = prop?.bathrooms ?? 1;\n        propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed, ${bath} Bath`;\n        break;\n      }\n    }\n    if (!relevantStaff && Object.values(staffByProperty).flat().length > 0) {\n      const first = Object.entries(staffByProperty)[0];\n      relevantStaff = first[1][0];\n      propertyId = first[0];\n      const prop = properties.find((p) => p.id === first[0]);\n      propertyName = prop?.name || '×”× ×›×¡';\n      const g = prop?.max_guests ?? 2;\n      const br = prop?.bedrooms ?? 1;\n      const b = prop?.beds ?? 1;\n      const bath = prop?.bathrooms ?? 1;\n      propertyContext = `${g} Guests, ${br} Bedroom, ${b} Bed, ${bath} Bath`;\n    }\n    \n    const staffName = relevantStaff?.name || 'Staff';\n    const phone = relevantStaff?.phone_number || relevantStaff?.phone;\n    const staffId = relevantStaff?.id || '';\n    const displayMessage = phone\n      ? `I am notifying ${staffName} at ${phone}`\n      : `I am notifying ${staffName}. (Add their phone number in Staff settings for direct contact.)`;\n    \n    const message = this.generateMessage(department, task, { staffName, propertyName });\n    const readyToSendHe = phone && propertyName\n      ? `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}. ${task.description || '×‘×§×©×” ×œ× ×™×§×™×•×Ÿ/×©×™×¨×•×ª'}. ×× × ×˜×¤×œ ×‘×”×§×“×.`\n      : null;\n    \n    try {\n      await createPropertyTask({\n        property_id: propertyId,\n        assigned_to: staffId,\n        description: task.description || (department === 'housekeeping' ? '× ×™×§×™×•×Ÿ' : '×©×™×¨×•×ª'),\n        status: 'Pending',\n        property_name: propertyName,\n        staff_name: staffName,\n        staff_phone: phone || '',\n        property_context: propertyContext,\n      });\n    } catch (e) {\n      console.warn('[Maya] Could not persist task:', e);\n    }\n    \n    return {\n      success: true,\n      message: {\n        id: Date.now(),\n        department,\n        room: task.room,\n        content: message,\n        readyToSendHe,\n        staffName,\n        phone,\n        propertyName,\n        sentAt: new Date().toISOString(),\n        status: 'delivered',\n      },\n      displayMessage,\n    };\n  }\n\n  generateMessage(department, task, extra = {}) {\n    const { staffName, propertyName } = extra;\n    const base = {\n      housekeeping: `ğŸ¨ ×‘×§×©×” ×—×“×©×” ××—×“×¨ ${task.room}\\n\\n${task.description || '××’×‘×•×ª × ×“×¨×©×•×ª'}\\n\\nâ° ×× × ×˜×¤×œ ×‘×”×§×“× ×”××¤×©×¨×™`,\n      maintenance: `ğŸ”§ ×ª×—×–×•×§×” × ×“×¨×©×ª ×‘×—×“×¨ ${task.room}\\n\\n${task.description || '×‘×¢×™×” ×˜×›× ×™×ª'}\\n\\nâš ï¸ ×“×—×™×¤×•×ª: ${task.priority || '×¨×’×™×œ×”'}`,\n      room_service: `ğŸ½ï¸ ×”×–×× ×ª ×©×™×¨×•×ª ×—×“×¨×™×\\n\\n×—×“×¨: ${task.room}\\n${task.order || ''}\\n\\nâ° ×–××Ÿ ××©×œ×•×— ××‘×•×§×©: ${task.deliveryTime || '×‘×”×§×“×'}`,\n      general: `ğŸ“‹ ×‘×§×©×” ×—×“×©×” ××—×“×¨ ${task.room}\\n\\n${task.description || '×‘×§×©×ª ××•×¨×—'}`,\n    };\n    let msg = base[department] || base.general;\n    if (staffName && propertyName) {\n      msg = `×”×™×™ ${staffName}, ×™×© ×§×¨×™××” ×‘× ×›×¡ ${propertyName}.\\n\\n${msg}`;\n    }\n    return (task.staffContext ? msg + task.staffContext : msg);\n  }\n\n  async handleCheckout(task) {\n    await new Promise((r) => setTimeout(r, 1000));\n    \n    // Send multiple messages for checkout process\n    await this.sendStaffMessage('housekeeping', {\n      room: task.room,\n      description: '× ×™×§×™×•×Ÿ ×œ××—×¨ ×¦\\'×§-×××•×˜',\n      priority: '×’×‘×•×”×”',\n    });\n    \n    return {\n      success: true,\n      checkout: {\n        room: task.room,\n        guestName: task.guestName,\n        processedAt: new Date().toISOString(),\n      },\n      displayMessage: i18n.t('orchestrator.messages.checkoutDone', { room: task.room }),\n    };\n  }\n}\n\n/**\n * Maya - The Master Orchestrator\n * Manages all agents and handles high-level decisions\n */\nclass MayaOrchestrator {\n  constructor() {\n    this.agents = {\n      [AGENT_TYPES.SCRAPER]: new ScraperAgent(),\n      [AGENT_TYPES.MARKETING]: new MarketingAgent(),\n      [AGENT_TYPES.CREATIVE]: new CreativeAgent(),\n      [AGENT_TYPES.SALES]: new SalesAgent(),\n      [AGENT_TYPES.OPERATIONS]: new OperationsAgent(),\n    };\n    \n    this.taskHistory = [];\n    this.isProcessing = false;\n    this.systemPrompt = MAYA_SYSTEM_PROMPT;\n  }\n\n  /**\n   * Execute a task using the appropriate agent\n   */\n  async executeTask(agentType, task) {\n    const agent = this.agents[agentType];\n    \n    if (!agent) {\n      throw new Error(`Agent ${agentType} not found`);\n    }\n    \n    const taskRecord = {\n      id: Date.now(),\n      agentType,\n      task,\n      startedAt: new Date().toISOString(),\n      status: 'running',\n    };\n    \n    this.taskHistory.push(taskRecord);\n    \n    try {\n      const result = await agent.execute(task);\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'completed';\n      taskRecord.result = result;\n      return result;\n    } catch (error) {\n      taskRecord.completedAt = new Date().toISOString();\n      taskRecord.status = 'failed';\n      taskRecord.error = error.message;\n      throw error;\n    }\n  }\n\n  /**\n   * Get all agent statuses\n   */\n  getAgentStatuses() {\n    return Object.entries(this.agents).reduce((acc, [type, agent]) => {\n      acc[type] = {\n        status: agent.status,\n        name: agent.name,\n        description: agent.description,\n      };\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Fetch property context (details + staff) for AI to answer guest queries\n   */\n  async getPropertyContext() {\n    try {\n      const ctx = await getAIPropertyContext();\n      return ctx.summary_for_ai || ctx.properties?.length\n        ? `Property context: ${ctx.summary_for_ai || 'No details.'}`\n        : '';\n    } catch (e) {\n      return '';\n    }\n  }\n\n  /**\n   * Process natural language command from Maya chat\n   */\n  async processCommand(command) {\n    const lowerCommand = command.toLowerCase();\n    \n    if (lowerCommand.includes('property') || lowerCommand.includes('villa') || lowerCommand.includes('× ×›×¡') || lowerCommand.includes('×•×•×™×œ×”') || lowerCommand.includes('guests') || lowerCommand.includes('××•×¨×—×™×') || lowerCommand.includes('bedroom') || lowerCommand.includes('×›××” ×—×“×¨×™×') || lowerCommand.includes('how many')) {\n      const ctx = await getAIPropertyContext();\n      const summary = ctx.summary_for_ai || 'No properties in database.';\n      return {\n        success: true,\n        message: summary,\n        displayMessage: summary,\n        properties: ctx.properties,\n      };\n    }\n    \n    if (lowerCommand.includes('staff') || lowerCommand.includes('×¢×•×‘×“') || lowerCommand.includes('×× ×§×”') || lowerCommand.includes('who to contact')) {\n      const ctx = await getAIPropertyContext();\n      const lines = [];\n      if (ctx.staff_by_property) {\n        for (const [pid, staff] of Object.entries(ctx.staff_by_property)) {\n          const prop = (ctx.properties || []).find((p) => p.id === pid);\n          const pName = prop?.name || pid;\n          const sStr = staff.map((s) => `${s.name} (${s.role})`).join(', ') || 'None';\n          lines.push(`${pName}: ${sStr}`);\n        }\n      }\n      const msg = lines.length ? lines.join('\\n') : 'No staff assigned.';\n      return { success: true, message: msg, displayMessage: msg };\n    }\n    \n    if (lowerCommand.includes('lead') || lowerCommand.includes('scan') || lowerCommand.includes('airbnb') || lowerCommand.includes('×œ×™×“') || lowerCommand.includes('×¡×¨×™×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SCRAPER, { platforms: ['airbnb', 'booking'] });\n    }\n    \n    if (lowerCommand.includes('post') || lowerCommand.includes('marketing') || lowerCommand.includes('campaign') || lowerCommand.includes('×¤×•×¡×˜') || lowerCommand.includes('×©×™×•×•×§') || lowerCommand.includes('×§××¤×™×™×Ÿ')) {\n      return await this.executeTask(AGENT_TYPES.MARKETING, {\n        type: 'social_post',\n        content: { text: 'New hotel post', platforms: ['instagram', 'facebook'] },\n      });\n    }\n    \n    if (lowerCommand.includes('video') || lowerCommand.includes('image') || lowerCommand.includes('edit') || lowerCommand.includes('×•×™×“××•') || lowerCommand.includes('×ª××•× ') || lowerCommand.includes('×¢×¨×™×›×”')) {\n      return await this.executeTask(AGENT_TYPES.CREATIVE, {\n        type: 'enhance_images',\n        images: ['https://example.com/room1.jpg'],\n      });\n    }\n    \n    if (lowerCommand.includes('demo') || lowerCommand.includes('deal') || lowerCommand.includes('sales') || lowerCommand.includes('×“××•') || lowerCommand.includes('××›×™×¨') || lowerCommand.includes('×¢×¡×§×”')) {\n      return await this.executeTask(AGENT_TYPES.SALES, {\n        type: 'send_demo',\n        lead: { id: Date.now(), name: 'New lead' },\n      });\n    }\n    \n    if (lowerCommand.includes('towel') || lowerCommand.includes('clean') || lowerCommand.includes('maintenance') || lowerCommand.includes('room') || lowerCommand.includes('fix') || lowerCommand.includes('××’×‘×ª') || lowerCommand.includes('× ×™×§×™×•×Ÿ') || lowerCommand.includes('×ª×—×–×•×§×”') || lowerCommand.includes('×—×“×¨') || lowerCommand.includes('dirty') || lowerCommand.includes('××œ×•×›×œ×š') || lowerCommand.includes('×ª×§×Ÿ') || lowerCommand.includes('×”×›×•×‘×¡') || lowerCommand.includes('×× ×§×”')) {\n      const roomMatch = command.match(/\\d+/);\n      const room = roomMatch ? roomMatch[0] : '101';\n      const ctx = await getAIPropertyContext();\n      const propertyContext = ctx.summary_for_ai || '';\n      const staffList = ctx.staff_by_property\n        ? Object.values(ctx.staff_by_property).flat()\n        : [];\n      const staffByProperty = ctx.staff_by_property || {};\n      const properties = ctx.properties || [];\n      \n      const isMaintenance = /maintenance|fix|×ª×—×–×•×§×”|×ª×§×Ÿ/i.test(command);\n      const isCleaning = /clean|towel|dirty|××’×‘×ª|× ×™×§×™×•×Ÿ|××œ×•×›×œ×š|×× ×§×”|×”×›×•×‘×¡/i.test(command);\n      const taskType = isMaintenance ? 'maintenance_request' : isCleaning ? 'request_cleaning' : 'request_towels';\n      return await this.executeTask(AGENT_TYPES.OPERATIONS, {\n        type: taskType,\n        room,\n        description: command,\n        propertyContext,\n        staff: staffList,\n        staffByProperty,\n        properties,\n      });\n    }\n    \n    // Default response\n    return {\n      success: true,\n      message: i18n.t('orchestrator.messages.unknown'),\n    };\n  }\n\n  /**\n   * Get task history\n   */\n  getTaskHistory(limit = 50) {\n    return this.taskHistory.slice(-limit).reverse();\n  }\n\n  /**\n   * Generate daily report\n   */\n  async generateDailyReport() {\n    const response = await fetch(`${API_BASE_URL}/api/reports/daily`, {\n      headers: { ...getAuthHeaders() },\n    });\n    if (!response.ok) {\n      throw new Error('Failed to generate report');\n    }\n    const data = await response.json();\n    return data.report || data;\n  }\n}\n\n// Singleton instance\nexport const maya = new MayaOrchestrator();\n\nexport default maya;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,SAASA,YAAY,QAAQ,oBAAoB;AACjD,SAASC,oBAAoB,EAAEC,kBAAkB,QAAQ,OAAO;AAChE,SAASC,aAAa,QAAQ,qBAAqB;AACnD,OAAOC,IAAI,MAAM,SAAS;AAE1B,MAAMC,cAAc,GAAGA,CAAA,KAAM;EAC3B,IAAI;IAAA,IAAAC,aAAA,EAAAC,cAAA;IACF,MAAMC,GAAG,GAAGC,YAAY,CAACC,OAAO,CAAC,0BAA0B,CAAC;IAC5D,IAAI,CAACF,GAAG,EAAE,OAAO,CAAC,CAAC;IACnB,MAAMG,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACL,GAAG,CAAC;IAC9B,MAAMM,KAAK,GAAGH,MAAM,aAANA,MAAM,wBAAAL,aAAA,GAANK,MAAM,CAAEI,KAAK,cAAAT,aAAA,uBAAbA,aAAA,CAAeU,SAAS;IACtC,MAAMC,QAAQ,GAAGN,MAAM,aAANA,MAAM,wBAAAJ,cAAA,GAANI,MAAM,CAAEI,KAAK,cAAAR,cAAA,uBAAbA,cAAA,CAAeW,cAAc;IAC9C,MAAMC,OAAO,GAAG,CAAC,CAAC;IAClB,IAAIL,KAAK,EAAEK,OAAO,CAACC,aAAa,GAAG,UAAUN,KAAK,EAAE;IACpD,IAAIG,QAAQ,EAAEE,OAAO,CAAC,aAAa,CAAC,GAAGF,QAAQ;IAC/C,OAAOE,OAAO;EAChB,CAAC,CAAC,OAAOE,KAAK,EAAE;IACd,OAAO,CAAC,CAAC;EACX;AACF,CAAC;AAED,MAAMC,kBAAkB,GAAG;AAC3B;AACA;AACA;AACA;AACA;AACA,EAAEnB,aAAa,CAACoB,cAAc,CAACC,IAAI;AACnC,EAAErB,aAAa,CAACsB,YAAY,CAACD,IAAI;AACjC,EAAErB,aAAa,CAACuB,WAAW,CAACF,IAAI;AAChC,EAAErB,aAAa,CAACwB,eAAe,CAACH,IAAI;AACpC,CAAC,CAACI,IAAI,CAAC,CAAC;;AAER;AACA,OAAO,MAAMC,WAAW,GAAG;EACzBC,OAAO,EAAE,SAAS;EAClBC,SAAS,EAAE,WAAW;EACtBC,QAAQ,EAAE,UAAU;EACpBC,KAAK,EAAE,OAAO;EACdC,UAAU,EAAE;AACd,CAAC;;AAED;AACA,OAAO,MAAMC,YAAY,GAAG;EAC1BC,MAAM,EAAE,QAAQ;EAChBC,IAAI,EAAE,MAAM;EACZC,OAAO,EAAE,SAAS;EAClBC,KAAK,EAAE;AACT,CAAC;;AAED;AACA;AACA;AACA,MAAMC,SAAS,CAAC;EACdC,WAAWA,CAACC,EAAE,EAAEC,IAAI,EAAEC,WAAW,EAAE;IACjC,IAAI,CAACF,EAAE,GAAGA,EAAE;IACZ,IAAI,CAACC,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACC,WAAW,GAAGA,WAAW;IAC9B,IAAI,CAACC,MAAM,GAAGV,YAAY,CAACC,MAAM;IACjC,IAAI,CAACU,SAAS,GAAG,EAAE;IACnB,IAAI,CAACC,cAAc,GAAG,EAAE;EAC1B;EAEA,MAAMC,OAAOA,CAACC,IAAI,EAAE;IAClB,MAAM,IAAIC,KAAK,CAAC,oCAAoC,CAAC;EACvD;EAEAC,SAASA,CAAA,EAAG;IACV,OAAO,IAAI,CAACN,MAAM;EACpB;EAEAO,SAASA,CAACP,MAAM,EAAE;IAChB,IAAI,CAACA,MAAM,GAAGA,MAAM;EACtB;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAMQ,YAAY,SAASb,SAAS,CAAC;EAC1CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACC,OAAO,EACnB,eAAe,EACf,wDACF,CAAC;IACD,IAAI,CAACwB,UAAU,GAAG,CAAC;IACnB,IAAI,CAACC,QAAQ,GAAG,IAAI;EACtB;EAEA,MAAMP,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,MAAMmB,KAAK,GAAG,MAAM,IAAI,CAACC,aAAa,CAACR,IAAI,CAACS,SAAS,IAAI,CAAC,QAAQ,EAAE,SAAS,CAAC,EAAET,IAAI,CAACU,QAAQ,CAAC;MAE9F,IAAI,CAACL,UAAU,IAAIE,KAAK,CAACI,MAAM;MAC/B,IAAI,CAACL,QAAQ,GAAG,IAAIM,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACxC,IAAI,CAACV,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MAEnC,OAAO;QACL2B,OAAO,EAAE,IAAI;QACbP,KAAK;QACLQ,SAAS,EAAE,IAAI,CAACT,QAAQ;QACxBU,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,kCAAkC,EAAE;UAAEC,KAAK,EAAEX,KAAK,CAACI;QAAO,CAAC;MAC7E,CAAC;IACH,CAAC,CAAC,OAAOvC,KAAK,EAAE;MACd,IAAI,CAAC+B,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMlB,KAAK;IACb;EACF;EAEA,MAAMoC,aAAaA,CAACC,SAAS,EAAEC,QAAQ,GAAG,QAAQ,EAAE;IAClD,MAAMS,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGrE,YAAY,wBAAwB,EAAE;MACpEsE,MAAM,EAAE,MAAM;MACdnD,OAAO,EAAE;QAAE,cAAc,EAAE,kBAAkB;QAAE,GAAGd,cAAc,CAAC;MAAE,CAAC;MACpEkE,IAAI,EAAE3D,IAAI,CAAC4D,SAAS,CAAC;QAAEd,SAAS;QAAEC;MAAS,CAAC;IAC9C,CAAC,CAAC;IAEF,IAAI,CAACS,QAAQ,CAACK,EAAE,EAAE;MAChB,MAAM,IAAIvB,KAAK,CAAC,0BAA0B,CAAC;IAC7C;IAEA,MAAMwB,IAAI,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;IAClC,OAAOD,IAAI,CAAClB,KAAK,IAAI,EAAE;EACzB;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAMoB,cAAc,SAASpC,SAAS,CAAC;EAC5CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACE,SAAS,EACrB,iBAAiB,EACjB,0CACF,CAAC;IACD,IAAI,CAAC8C,YAAY,GAAG,CAAC;IACrB,IAAI,CAACC,aAAa,GAAG,CAAC;EACxB;EAEA,MAAM9B,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,aAAa;UAChBD,MAAM,GAAG,MAAM,IAAI,CAACE,gBAAgB,CAAChC,IAAI,CAACiC,OAAO,CAAC;UAClD,IAAI,CAACL,YAAY,EAAE;UACnB;QACF,KAAK,gBAAgB;UACnBE,MAAM,GAAG,MAAM,IAAI,CAACI,mBAAmB,CAAClC,IAAI,CAACmC,QAAQ,CAAC;UACtD,IAAI,CAACN,aAAa,EAAE;UACpB;QACF;UACE,MAAM,IAAI5B,KAAK,CAAC,sBAAsBD,IAAI,CAAC+B,IAAI,EAAE,CAAC;MACtD;MAEA,IAAI,CAAC5B,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO1D,KAAK,EAAE;MACd,IAAI,CAAC+B,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMlB,KAAK;IACb;EACF;EAEA,MAAM4D,gBAAgBA,CAACC,OAAO,EAAE;IAC9B,MAAM,IAAIG,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbyB,IAAI,EAAE;QACJ9C,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdP,OAAO,EAAEA,OAAO,CAACQ,IAAI;QACrBhC,SAAS,EAAEwB,OAAO,CAACxB,SAAS,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC;QACzDiC,YAAY,EAAET,OAAO,CAACS,YAAY,IAAI,IAAI9B,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MAC/D,CAAC;MACDG,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,mCAAmC;IACrD,CAAC;EACH;EAEA,MAAMiB,mBAAmBA,CAACC,QAAQ,EAAE;IAClC,MAAM,IAAIC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbqB,QAAQ,EAAE;QACR1C,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdG,OAAO,EAAER,QAAQ,CAACQ,OAAO;QACzBC,UAAU,EAAET,QAAQ,CAACS,UAAU,IAAI,GAAG;QACtCC,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MACjC,CAAC;MACDG,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,oCAAoC,EAAE;QAAEC,KAAK,EAAEiB,QAAQ,CAACS,UAAU,IAAI;MAAI,CAAC;IAC7F,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAME,aAAa,SAASvD,SAAS,CAAC;EAC3CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACG,QAAQ,EACpB,gBAAgB,EAChB,mDACF,CAAC;IACD,IAAI,CAACgE,aAAa,GAAG,CAAC;EACxB;EAEA,MAAMhD,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,YAAY;UACfD,MAAM,GAAG,MAAM,IAAI,CAACkB,SAAS,CAAChD,IAAI,CAACiD,KAAK,CAAC;UACzC;QACF,KAAK,gBAAgB;UACnBnB,MAAM,GAAG,MAAM,IAAI,CAACoB,aAAa,CAAClD,IAAI,CAACmD,MAAM,CAAC;UAC9C;QACF,KAAK,qBAAqB;UACxBrB,MAAM,GAAG,MAAM,IAAI,CAACsB,iBAAiB,CAACpD,IAAI,CAACqD,QAAQ,CAAC;UACpD;QACF;UACE,MAAM,IAAIpD,KAAK,CAAC,sBAAsBD,IAAI,CAAC+B,IAAI,EAAE,CAAC;MACtD;MAEA,IAAI,CAACgB,aAAa,EAAE;MACpB,IAAI,CAAC5C,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO1D,KAAK,EAAE;MACd,IAAI,CAAC+B,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMlB,KAAK;IACb;EACF;EAEA,MAAM4E,SAASA,CAACC,KAAK,EAAE;IACrB,MAAM,IAAIb,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbmC,KAAK,EAAE;QACLxD,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdc,WAAW,EAAEL,KAAK,CAACM,GAAG;QACtBC,SAAS,EAAEP,KAAK,CAACM,GAAG,GAAG,cAAc;QACrCE,QAAQ,EAAE;MACZ,CAAC;MACDzC,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,mCAAmC;IACrD,CAAC;EACH;EAEA,MAAMiC,aAAaA,CAACC,MAAM,EAAE;IAC1B,MAAM,IAAIf,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbqC,MAAM,EAAEA,MAAM,CAACO,GAAG,CAAC,CAACC,GAAG,EAAEC,CAAC,MAAM;QAC9BnE,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC,GAAGoB,CAAC;QAClBN,WAAW,EAAEK,GAAG;QAChBE,WAAW,EAAEF,GAAG,GAAG;MACrB,CAAC,CAAC,CAAC;MACH3C,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,sCAAsC,EAAE;QAAEC,KAAK,EAAEiC,MAAM,CAACxC;MAAO,CAAC;IAClF,CAAC;EACH;EAEA,MAAMyC,iBAAiBA,CAACC,QAAQ,EAAE;IAChC,MAAM,IAAIjB,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACbgD,IAAI,EAAE;QACJrE,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACduB,UAAU,EAAEV,QAAQ,CAAC5D,EAAE;QACvBuE,OAAO,EAAE,0BAA0BX,QAAQ,CAAC5D,EAAE;MAChD,CAAC;MACDuB,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,mCAAmC;IACrD,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAMgD,UAAU,SAAS1E,SAAS,CAAC;EACxCC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACI,KAAK,EACjB,qBAAqB,EACrB,4CACF,CAAC;IACD,IAAI,CAACkF,eAAe,GAAG,CAAC;IACxB,IAAI,CAACC,gBAAgB,GAAG,CAAC;EAC3B;EAEA,MAAMpE,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,WAAW;UACdD,MAAM,GAAG,MAAM,IAAI,CAACsC,QAAQ,CAACpE,IAAI,CAACqE,IAAI,CAAC;UACvC;QACF,KAAK,WAAW;UACdvC,MAAM,GAAG,MAAM,IAAI,CAACwC,iBAAiB,CAACtE,IAAI,CAACuE,IAAI,CAAC;UAChD;QACF,KAAK,WAAW;UACdzC,MAAM,GAAG,MAAM,IAAI,CAAC0C,QAAQ,CAACxE,IAAI,CAACyE,MAAM,CAAC;UACzC;QACF;UACE,MAAM,IAAIxE,KAAK,CAAC,sBAAsBD,IAAI,CAAC+B,IAAI,EAAE,CAAC;MACtD;MAEA,IAAI,CAAC5B,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO1D,KAAK,EAAE;MACd,IAAI,CAAC+B,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMlB,KAAK;IACb;EACF;EAEA,MAAMgG,QAAQA,CAACC,IAAI,EAAE;IACnB,MAAM,IAAIjC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,IAAI,CAAC6B,eAAe,EAAE;IAEtB,OAAO;MACLpD,OAAO,EAAE,IAAI;MACb4D,IAAI,EAAE;QACJjF,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdiC,MAAM,EAAEJ,IAAI,CAAC5E,EAAE;QACfkF,OAAO,EAAE,yBAAyBN,IAAI,CAAC5E,EAAE,EAAE;QAC3CoD,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MACjC,CAAC;MACDG,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,gCAAgC,EAAE;QAAEvB,IAAI,EAAE2E,IAAI,CAAC3E,IAAI,IAAI;MAAO,CAAC;IACjF,CAAC;EACH;EAEA,MAAM4E,iBAAiBA,CAACC,IAAI,EAAE;IAC5B,MAAM,IAAInC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACb8D,WAAW,EAAE;QACXnF,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACdqC,MAAM,EAAEN,IAAI,CAAC9E,EAAE;QACfqF,KAAK,EAAE,eAAe;QACtBC,UAAU,EAAE;MACd,CAAC;MACD/D,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,0CAA0C;IAC5D,CAAC;EACH;EAEA,MAAMuD,QAAQA,CAACC,MAAM,EAAE;IACrB,MAAM,IAAIrC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAE7C,OAAO;MACLvB,OAAO,EAAE,IAAI;MACb0D,QAAQ,EAAE;QACRC,MAAM;QACN5B,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;QAChCkB,IAAI,EAAE;MACR,CAAC;MACDf,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,oCAAoC;IACtD,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA,OAAO,MAAM+D,eAAe,SAASzF,SAAS,CAAC;EAC7CC,WAAWA,CAAA,EAAG;IACZ,KAAK,CACHZ,WAAW,CAACK,UAAU,EACtB,kBAAkB,EAClB,2DACF,CAAC;IACD,IAAI,CAACgG,YAAY,GAAG,CAAC;IACrB,IAAI,CAACC,aAAa,GAAG,CAAC;EACxB;EAEA,MAAMnF,OAAOA,CAACC,IAAI,EAAE;IAClB,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACE,IAAI,CAAC;IAEjC,IAAI;MACF,IAAI0C,MAAM;MAEV,QAAQ9B,IAAI,CAAC+B,IAAI;QACf,KAAK,gBAAgB;UACnBD,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,cAAc,EAAEnF,IAAI,CAAC;UAC1D;QACF,KAAK,kBAAkB;UACrB8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,cAAc,EAAEnF,IAAI,CAAC;UAC1D;QACF,KAAK,qBAAqB;UACxB8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,aAAa,EAAEnF,IAAI,CAAC;UACzD;QACF,KAAK,cAAc;UACjB8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,cAAc,EAAEnF,IAAI,CAAC;UAC1D;QACF,KAAK,gBAAgB;UACnB8B,MAAM,GAAG,MAAM,IAAI,CAACsD,cAAc,CAACpF,IAAI,CAAC;UACxC;QACF;UACE8B,MAAM,GAAG,MAAM,IAAI,CAACqD,gBAAgB,CAAC,SAAS,EAAEnF,IAAI,CAAC;MACzD;MAEA,IAAI,CAACG,SAAS,CAACjB,YAAY,CAACC,MAAM,CAAC;MACnC,OAAO2C,MAAM;IACf,CAAC,CAAC,OAAO1D,KAAK,EAAE;MACd,IAAI,CAAC+B,SAAS,CAACjB,YAAY,CAACI,KAAK,CAAC;MAClC,MAAMlB,KAAK;IACb;EACF;EAEA,MAAM+G,gBAAgBA,CAACE,UAAU,EAAErF,IAAI,EAAE;IAAA,IAAAsF,cAAA,EAAAC,eAAA,EAAAC,eAAA,EAAAC,eAAA;IACvC,MAAM,IAAIrD,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,GAAG,CAAC,CAAC;IAE5C,IAAI,CAAC4C,YAAY,EAAE;IACnB,IAAI,CAACC,aAAa,EAAE;IAEpB,MAAMQ,eAAe,GAAG1F,IAAI,CAAC0F,eAAe,IAAI,CAAC,CAAC;IAClD,MAAMC,UAAU,GAAG3F,IAAI,CAAC2F,UAAU,IAAI,EAAE;IACxC,IAAIC,aAAa,GAAG,IAAI;IACxB,IAAIC,YAAY,GAAG,EAAE;IACrB,IAAI9B,UAAU,GAAG,EAAE;IACnB,IAAI+B,eAAe,GAAG,EAAE;IACxB,MAAMC,aAAa,GAAGV,UAAU,KAAK,aAAa;IAClD,MAAMW,WAAW,GAAGD,aAAa,GAC7B,oBAAoB,GACpB,kCAAkC;IAEtC,KAAK,MAAM,CAACE,GAAG,EAAEC,SAAS,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACV,eAAe,CAAC,EAAE;MAC9D,MAAMW,CAAC,GAAGH,SAAS,CAACI,IAAI,CAAEC,CAAC,IAAKP,WAAW,CAACQ,IAAI,CAACD,CAAC,CAACE,IAAI,IAAI,EAAE,CAAC,CAAC;MAC/D,IAAIJ,CAAC,EAAE;QAAA,IAAAK,gBAAA,EAAAC,cAAA,EAAAC,UAAA,EAAAC,eAAA;QACLjB,aAAa,GAAGS,CAAC;QACjBtC,UAAU,GAAGkC,GAAG;QAChB,MAAMa,IAAI,GAAGnB,UAAU,CAACW,IAAI,CAAES,CAAC,IAAKA,CAAC,CAACtH,EAAE,KAAKwG,GAAG,CAAC;QACjDJ,YAAY,GAAG,CAAAiB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEpH,IAAI,KAAI,MAAM;QACnC,MAAMsH,CAAC,IAAAN,gBAAA,GAAGI,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,UAAU,cAAAP,gBAAA,cAAAA,gBAAA,GAAI,CAAC;QAC/B,MAAMQ,EAAE,IAAAP,cAAA,GAAGG,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,QAAQ,cAAAR,cAAA,cAAAA,cAAA,GAAI,CAAC;QAC9B,MAAMS,CAAC,IAAAR,UAAA,GAAGE,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEO,IAAI,cAAAT,UAAA,cAAAA,UAAA,GAAI,CAAC;QACzB,MAAMU,IAAI,IAAAT,eAAA,GAAGC,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAES,SAAS,cAAAV,eAAA,cAAAA,eAAA,GAAI,CAAC;QACjCf,eAAe,GAAG,GAAGkB,CAAC,YAAYE,EAAE,aAAaE,CAAC,SAASE,IAAI,OAAO;QACtE;MACF;IACF;IACA,IAAI,CAAC1B,aAAa,IAAIO,MAAM,CAACqB,MAAM,CAAC9B,eAAe,CAAC,CAAC+B,IAAI,CAAC,CAAC,CAAC9G,MAAM,GAAG,CAAC,EAAE;MAAA,IAAA+G,iBAAA,EAAAC,eAAA,EAAAC,WAAA,EAAAC,gBAAA;MACtE,MAAMC,KAAK,GAAG3B,MAAM,CAACC,OAAO,CAACV,eAAe,CAAC,CAAC,CAAC,CAAC;MAChDE,aAAa,GAAGkC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAC3B/D,UAAU,GAAG+D,KAAK,CAAC,CAAC,CAAC;MACrB,MAAMhB,IAAI,GAAGnB,UAAU,CAACW,IAAI,CAAES,CAAC,IAAKA,CAAC,CAACtH,EAAE,KAAKqI,KAAK,CAAC,CAAC,CAAC,CAAC;MACtDjC,YAAY,GAAG,CAAAiB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEpH,IAAI,KAAI,MAAM;MACnC,MAAMsH,CAAC,IAAAU,iBAAA,GAAGZ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,UAAU,cAAAS,iBAAA,cAAAA,iBAAA,GAAI,CAAC;MAC/B,MAAMR,EAAE,IAAAS,eAAA,GAAGb,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,QAAQ,cAAAQ,eAAA,cAAAA,eAAA,GAAI,CAAC;MAC9B,MAAMP,CAAC,IAAAQ,WAAA,GAAGd,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEO,IAAI,cAAAO,WAAA,cAAAA,WAAA,GAAI,CAAC;MACzB,MAAMN,IAAI,IAAAO,gBAAA,GAAGf,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAES,SAAS,cAAAM,gBAAA,cAAAA,gBAAA,GAAI,CAAC;MACjC/B,eAAe,GAAG,GAAGkB,CAAC,YAAYE,EAAE,aAAaE,CAAC,SAASE,IAAI,OAAO;IACxE;IAEA,MAAMS,SAAS,GAAG,EAAAzC,cAAA,GAAAM,aAAa,cAAAN,cAAA,uBAAbA,cAAA,CAAe5F,IAAI,KAAI,OAAO;IAChD,MAAMsI,KAAK,GAAG,EAAAzC,eAAA,GAAAK,aAAa,cAAAL,eAAA,uBAAbA,eAAA,CAAe0C,YAAY,OAAAzC,eAAA,GAAII,aAAa,cAAAJ,eAAA,uBAAbA,eAAA,CAAewC,KAAK;IACjE,MAAME,OAAO,GAAG,EAAAzC,eAAA,GAAAG,aAAa,cAAAH,eAAA,uBAAbA,eAAA,CAAehG,EAAE,KAAI,EAAE;IACvC,MAAM0I,cAAc,GAAGH,KAAK,GACxB,kBAAkBD,SAAS,OAAOC,KAAK,EAAE,GACzC,kBAAkBD,SAAS,kEAAkE;IAEjG,MAAM/G,OAAO,GAAG,IAAI,CAACoH,eAAe,CAAC/C,UAAU,EAAErF,IAAI,EAAE;MAAE+H,SAAS;MAAElC;IAAa,CAAC,CAAC;IACnF,MAAMwC,aAAa,GAAGL,KAAK,IAAInC,YAAY,GACvC,OAAOkC,SAAS,mBAAmBlC,YAAY,KAAK7F,IAAI,CAACL,WAAW,IAAI,oBAAoB,kBAAkB,GAC9G,IAAI;IAER,IAAI;MACF,MAAM1C,kBAAkB,CAAC;QACvBqL,WAAW,EAAEvE,UAAU;QACvBwE,WAAW,EAAEL,OAAO;QACpBvI,WAAW,EAAEK,IAAI,CAACL,WAAW,KAAK0F,UAAU,KAAK,cAAc,GAAG,QAAQ,GAAG,OAAO,CAAC;QACrFzF,MAAM,EAAE,SAAS;QACjB4I,aAAa,EAAE3C,YAAY;QAC3B4C,UAAU,EAAEV,SAAS;QACrBW,WAAW,EAAEV,KAAK,IAAI,EAAE;QACxBW,gBAAgB,EAAE7C;MACpB,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO8C,CAAC,EAAE;MACVC,OAAO,CAACC,IAAI,CAAC,gCAAgC,EAAEF,CAAC,CAAC;IACnD;IAEA,OAAO;MACL9H,OAAO,EAAE,IAAI;MACbE,OAAO,EAAE;QACPvB,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;QACd6C,UAAU;QACV0D,IAAI,EAAE/I,IAAI,CAAC+I,IAAI;QACf9G,OAAO,EAAEjB,OAAO;QAChBqH,aAAa;QACbN,SAAS;QACTC,KAAK;QACLnC,YAAY;QACZhD,MAAM,EAAE,IAAIjC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;QAChCjB,MAAM,EAAE;MACV,CAAC;MACDuI;IACF,CAAC;EACH;EAEAC,eAAeA,CAAC/C,UAAU,EAAErF,IAAI,EAAEgJ,KAAK,GAAG,CAAC,CAAC,EAAE;IAC5C,MAAM;MAAEjB,SAAS;MAAElC;IAAa,CAAC,GAAGmD,KAAK;IACzC,MAAMC,IAAI,GAAG;MACXC,YAAY,EAAE,qBAAqBlJ,IAAI,CAAC+I,IAAI,OAAO/I,IAAI,CAACL,WAAW,IAAI,cAAc,4BAA4B;MACjHwJ,WAAW,EAAE,wBAAwBnJ,IAAI,CAAC+I,IAAI,OAAO/I,IAAI,CAACL,WAAW,IAAI,YAAY,kBAAkBK,IAAI,CAACoJ,QAAQ,IAAI,OAAO,EAAE;MACjIC,YAAY,EAAE,iCAAiCrJ,IAAI,CAAC+I,IAAI,KAAK/I,IAAI,CAACsJ,KAAK,IAAI,EAAE,0BAA0BtJ,IAAI,CAACuJ,YAAY,IAAI,OAAO,EAAE;MACrIC,OAAO,EAAE,qBAAqBxJ,IAAI,CAAC+I,IAAI,OAAO/I,IAAI,CAACL,WAAW,IAAI,WAAW;IAC/E,CAAC;IACD,IAAI8J,GAAG,GAAGR,IAAI,CAAC5D,UAAU,CAAC,IAAI4D,IAAI,CAACO,OAAO;IAC1C,IAAIzB,SAAS,IAAIlC,YAAY,EAAE;MAC7B4D,GAAG,GAAG,OAAO1B,SAAS,mBAAmBlC,YAAY,QAAQ4D,GAAG,EAAE;IACpE;IACA,OAAQzJ,IAAI,CAAC0J,YAAY,GAAGD,GAAG,GAAGzJ,IAAI,CAAC0J,YAAY,GAAGD,GAAG;EAC3D;EAEA,MAAMrE,cAAcA,CAACpF,IAAI,EAAE;IACzB,MAAM,IAAIoC,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;;IAE7C;IACA,MAAM,IAAI,CAAC8C,gBAAgB,CAAC,cAAc,EAAE;MAC1C4D,IAAI,EAAE/I,IAAI,CAAC+I,IAAI;MACfpJ,WAAW,EAAE,uBAAuB;MACpCyJ,QAAQ,EAAE;IACZ,CAAC,CAAC;IAEF,OAAO;MACLtI,OAAO,EAAE,IAAI;MACb6I,QAAQ,EAAE;QACRZ,IAAI,EAAE/I,IAAI,CAAC+I,IAAI;QACfa,SAAS,EAAE5J,IAAI,CAAC4J,SAAS;QACzBC,WAAW,EAAE,IAAIjJ,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC;MACtC,CAAC;MACDsH,cAAc,EAAEhL,IAAI,CAAC8D,CAAC,CAAC,oCAAoC,EAAE;QAAE8H,IAAI,EAAE/I,IAAI,CAAC+I;MAAK,CAAC;IAClF,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA;AACA,MAAMe,gBAAgB,CAAC;EACrBtK,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACuK,MAAM,GAAG;MACZ,CAACnL,WAAW,CAACC,OAAO,GAAG,IAAIuB,YAAY,CAAC,CAAC;MACzC,CAACxB,WAAW,CAACE,SAAS,GAAG,IAAI6C,cAAc,CAAC,CAAC;MAC7C,CAAC/C,WAAW,CAACG,QAAQ,GAAG,IAAI+D,aAAa,CAAC,CAAC;MAC3C,CAAClE,WAAW,CAACI,KAAK,GAAG,IAAIiF,UAAU,CAAC,CAAC;MACrC,CAACrF,WAAW,CAACK,UAAU,GAAG,IAAI+F,eAAe,CAAC;IAChD,CAAC;IAED,IAAI,CAACgF,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,YAAY,GAAG,KAAK;IACzB,IAAI,CAACC,YAAY,GAAG7L,kBAAkB;EACxC;;EAEA;AACF;AACA;EACE,MAAM8L,WAAWA,CAACC,SAAS,EAAEpK,IAAI,EAAE;IACjC,MAAMqK,KAAK,GAAG,IAAI,CAACN,MAAM,CAACK,SAAS,CAAC;IAEpC,IAAI,CAACC,KAAK,EAAE;MACV,MAAM,IAAIpK,KAAK,CAAC,SAASmK,SAAS,YAAY,CAAC;IACjD;IAEA,MAAME,UAAU,GAAG;MACjB7K,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;MACd4H,SAAS;MACTpK,IAAI;MACJuK,SAAS,EAAE,IAAI3J,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACnCjB,MAAM,EAAE;IACV,CAAC;IAED,IAAI,CAACoK,WAAW,CAACQ,IAAI,CAACF,UAAU,CAAC;IAEjC,IAAI;MACF,MAAMxI,MAAM,GAAG,MAAMuI,KAAK,CAACtK,OAAO,CAACC,IAAI,CAAC;MACxCsK,UAAU,CAACG,WAAW,GAAG,IAAI7J,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACjDyJ,UAAU,CAAC1K,MAAM,GAAG,WAAW;MAC/B0K,UAAU,CAACxI,MAAM,GAAGA,MAAM;MAC1B,OAAOA,MAAM;IACf,CAAC,CAAC,OAAO1D,KAAK,EAAE;MACdkM,UAAU,CAACG,WAAW,GAAG,IAAI7J,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;MACjDyJ,UAAU,CAAC1K,MAAM,GAAG,QAAQ;MAC5B0K,UAAU,CAAClM,KAAK,GAAGA,KAAK,CAAC4C,OAAO;MAChC,MAAM5C,KAAK;IACb;EACF;;EAEA;AACF;AACA;EACEsM,gBAAgBA,CAAA,EAAG;IACjB,OAAOvE,MAAM,CAACC,OAAO,CAAC,IAAI,CAAC2D,MAAM,CAAC,CAACY,MAAM,CAAC,CAACC,GAAG,EAAE,CAAC7I,IAAI,EAAEsI,KAAK,CAAC,KAAK;MAChEO,GAAG,CAAC7I,IAAI,CAAC,GAAG;QACVnC,MAAM,EAAEyK,KAAK,CAACzK,MAAM;QACpBF,IAAI,EAAE2K,KAAK,CAAC3K,IAAI;QAChBC,WAAW,EAAE0K,KAAK,CAAC1K;MACrB,CAAC;MACD,OAAOiL,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CAAC;EACR;;EAEA;AACF;AACA;EACE,MAAMC,kBAAkBA,CAAA,EAAG;IACzB,IAAI;MAAA,IAAAC,eAAA;MACF,MAAMC,GAAG,GAAG,MAAM/N,oBAAoB,CAAC,CAAC;MACxC,OAAO+N,GAAG,CAACC,cAAc,KAAAF,eAAA,GAAIC,GAAG,CAACpF,UAAU,cAAAmF,eAAA,eAAdA,eAAA,CAAgBnK,MAAM,GAC/C,qBAAqBoK,GAAG,CAACC,cAAc,IAAI,aAAa,EAAE,GAC1D,EAAE;IACR,CAAC,CAAC,OAAOpC,CAAC,EAAE;MACV,OAAO,EAAE;IACX;EACF;;EAEA;AACF;AACA;EACE,MAAMqC,cAAcA,CAACC,OAAO,EAAE;IAC5B,MAAMC,YAAY,GAAGD,OAAO,CAACE,WAAW,CAAC,CAAC;IAE1C,IAAID,YAAY,CAACE,QAAQ,CAAC,UAAU,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,KAAK,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,QAAQ,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,QAAQ,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,SAAS,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,WAAW,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,UAAU,CAAC,EAAE;MAC9T,MAAMN,GAAG,GAAG,MAAM/N,oBAAoB,CAAC,CAAC;MACxC,MAAMsO,OAAO,GAAGP,GAAG,CAACC,cAAc,IAAI,4BAA4B;MAClE,OAAO;QACLlK,OAAO,EAAE,IAAI;QACbE,OAAO,EAAEsK,OAAO;QAChBnD,cAAc,EAAEmD,OAAO;QACvB3F,UAAU,EAAEoF,GAAG,CAACpF;MAClB,CAAC;IACH;IAEA,IAAIwF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,gBAAgB,CAAC,EAAE;MAC/I,MAAMN,GAAG,GAAG,MAAM/N,oBAAoB,CAAC,CAAC;MACxC,MAAMuO,KAAK,GAAG,EAAE;MAChB,IAAIR,GAAG,CAACS,iBAAiB,EAAE;QACzB,KAAK,MAAM,CAACvF,GAAG,EAAEwF,KAAK,CAAC,IAAItF,MAAM,CAACC,OAAO,CAAC2E,GAAG,CAACS,iBAAiB,CAAC,EAAE;UAChE,MAAM1E,IAAI,GAAG,CAACiE,GAAG,CAACpF,UAAU,IAAI,EAAE,EAAEW,IAAI,CAAES,CAAC,IAAKA,CAAC,CAACtH,EAAE,KAAKwG,GAAG,CAAC;UAC7D,MAAMyF,KAAK,GAAG,CAAA5E,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEpH,IAAI,KAAIuG,GAAG;UAC/B,MAAM0F,IAAI,GAAGF,KAAK,CAAC/H,GAAG,CAAE2C,CAAC,IAAK,GAAGA,CAAC,CAAC3G,IAAI,KAAK2G,CAAC,CAACI,IAAI,GAAG,CAAC,CAACmF,IAAI,CAAC,IAAI,CAAC,IAAI,MAAM;UAC3EL,KAAK,CAACf,IAAI,CAAC,GAAGkB,KAAK,KAAKC,IAAI,EAAE,CAAC;QACjC;MACF;MACA,MAAMlC,GAAG,GAAG8B,KAAK,CAAC5K,MAAM,GAAG4K,KAAK,CAACK,IAAI,CAAC,IAAI,CAAC,GAAG,oBAAoB;MAClE,OAAO;QAAE9K,OAAO,EAAE,IAAI;QAAEE,OAAO,EAAEyI,GAAG;QAAEtB,cAAc,EAAEsB;MAAI,CAAC;IAC7D;IAEA,IAAI0B,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,QAAQ,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,KAAK,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,EAAE;MACvK,OAAO,MAAM,IAAI,CAAClB,WAAW,CAACvL,WAAW,CAACC,OAAO,EAAE;QAAE4B,SAAS,EAAE,CAAC,QAAQ,EAAE,SAAS;MAAE,CAAC,CAAC;IAC1F;IAEA,IAAI0K,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,WAAW,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,UAAU,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,QAAQ,CAAC,EAAE;MAClN,OAAO,MAAM,IAAI,CAAClB,WAAW,CAACvL,WAAW,CAACE,SAAS,EAAE;QACnDiD,IAAI,EAAE,aAAa;QACnBE,OAAO,EAAE;UAAEQ,IAAI,EAAE,gBAAgB;UAAEhC,SAAS,EAAE,CAAC,WAAW,EAAE,UAAU;QAAE;MAC1E,CAAC,CAAC;IACJ;IAEA,IAAI0K,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,EAAE;MAC1M,OAAO,MAAM,IAAI,CAAClB,WAAW,CAACvL,WAAW,CAACG,QAAQ,EAAE;QAClDgD,IAAI,EAAE,gBAAgB;QACtBoB,MAAM,EAAE,CAAC,+BAA+B;MAC1C,CAAC,CAAC;IACJ;IAEA,IAAIgI,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,KAAK,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,EAAE;MACtM,OAAO,MAAM,IAAI,CAAClB,WAAW,CAACvL,WAAW,CAACI,KAAK,EAAE;QAC/C+C,IAAI,EAAE,WAAW;QACjBsC,IAAI,EAAE;UAAE5E,EAAE,EAAEmB,IAAI,CAAC4B,GAAG,CAAC,CAAC;UAAE9C,IAAI,EAAE;QAAW;MAC3C,CAAC,CAAC;IACJ;IAEA,IAAIyL,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,aAAa,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,KAAK,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,QAAQ,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,QAAQ,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,KAAK,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,QAAQ,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,KAAK,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,EAAE;MAC5d,MAAMQ,SAAS,GAAGX,OAAO,CAACY,KAAK,CAAC,KAAK,CAAC;MACtC,MAAM/C,IAAI,GAAG8C,SAAS,GAAGA,SAAS,CAAC,CAAC,CAAC,GAAG,KAAK;MAC7C,MAAMd,GAAG,GAAG,MAAM/N,oBAAoB,CAAC,CAAC;MACxC,MAAM8I,eAAe,GAAGiF,GAAG,CAACC,cAAc,IAAI,EAAE;MAChD,MAAM9E,SAAS,GAAG6E,GAAG,CAACS,iBAAiB,GACnCrF,MAAM,CAACqB,MAAM,CAACuD,GAAG,CAACS,iBAAiB,CAAC,CAAC/D,IAAI,CAAC,CAAC,GAC3C,EAAE;MACN,MAAM/B,eAAe,GAAGqF,GAAG,CAACS,iBAAiB,IAAI,CAAC,CAAC;MACnD,MAAM7F,UAAU,GAAGoF,GAAG,CAACpF,UAAU,IAAI,EAAE;MAEvC,MAAMI,aAAa,GAAG,6BAA6B,CAACS,IAAI,CAAC0E,OAAO,CAAC;MACjE,MAAMa,UAAU,GAAG,kDAAkD,CAACvF,IAAI,CAAC0E,OAAO,CAAC;MACnF,MAAMc,QAAQ,GAAGjG,aAAa,GAAG,qBAAqB,GAAGgG,UAAU,GAAG,kBAAkB,GAAG,gBAAgB;MAC3G,OAAO,MAAM,IAAI,CAAC5B,WAAW,CAACvL,WAAW,CAACK,UAAU,EAAE;QACpD8C,IAAI,EAAEiK,QAAQ;QACdjD,IAAI;QACJpJ,WAAW,EAAEuL,OAAO;QACpBpF,eAAe;QACf2F,KAAK,EAAEvF,SAAS;QAChBR,eAAe;QACfC;MACF,CAAC,CAAC;IACJ;;IAEA;IACA,OAAO;MACL7E,OAAO,EAAE,IAAI;MACbE,OAAO,EAAE7D,IAAI,CAAC8D,CAAC,CAAC,+BAA+B;IACjD,CAAC;EACH;;EAEA;AACF;AACA;EACEgL,cAAcA,CAACC,KAAK,GAAG,EAAE,EAAE;IACzB,OAAO,IAAI,CAAClC,WAAW,CAACmC,KAAK,CAAC,CAACD,KAAK,CAAC,CAACE,OAAO,CAAC,CAAC;EACjD;;EAEA;AACF;AACA;EACE,MAAMC,mBAAmBA,CAAA,EAAG;IAC1B,MAAMlL,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGrE,YAAY,oBAAoB,EAAE;MAChEmB,OAAO,EAAE;QAAE,GAAGd,cAAc,CAAC;MAAE;IACjC,CAAC,CAAC;IACF,IAAI,CAAC+D,QAAQ,CAACK,EAAE,EAAE;MAChB,MAAM,IAAIvB,KAAK,CAAC,2BAA2B,CAAC;IAC9C;IACA,MAAMwB,IAAI,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;IAClC,OAAOD,IAAI,CAAC6K,MAAM,IAAI7K,IAAI;EAC5B;AACF;;AAEA;AACA,OAAO,MAAM8K,IAAI,GAAG,IAAIzC,gBAAgB,CAAC,CAAC;AAE1C,eAAeyC,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}